cost function:
  cost type: 3D-Var
  jb evaluation: false
  analysis variables: &anavars [ua,va,t,ps,q,qi,ql,o3ppmv,ts,phis,frocean,frlake,frseaice]
  window begin: $JEDI_ISO_DATE_001
  window length: PT6H
  geometry:
    fms initialization:
      namelist filename: Data/fv3files/input_geos_c180.nml
      field table filename: Data/fv3files/field_table_gmao
    akbk: Data/fv3files/akbk72.nc4
    layout: [6,6]
    npx: 181
    npy: 181
    npz: 72
    field metadata override: Data/fieldmetadata/geos.yaml
  background:
    datetime: $JEDI_ISO_DATE_004
    filetype: cube sphere history
    provider: geos
    datapath: Data/bkg
    filenames: [bkg.${AYYYYMMDD_HH}00z.nc4, geos.crtmsrf.181.nc4]
    state variables: [u,v,ua,va,t,ps,delp,q,qi,ql,qr,qs,phis,o3ppmv,ts,frocean,frland,frlake,frseaice,
                      vtype,stype,vfrac,sheleg,soilt,soilm,u10m,v10m,co2]
#   state variables: [    ua,va,t,ps,delp,q,qi,ql,qr,qs,phis,o3ppmv,ts,frocean,frland,frlake,frseaice,
#                     vtype,stype,vfrac,sheleg,soilt,soilm,u10m,v10m,co2]
#   state variables: [ qls , qcn , cfcn , varflt , ustar , bstar , zpbl , cm , ct , cq , kcbl , tsm , khl , khu , 
#---------------------------------
  background error:
    covariance model: SABER
    saber central block:
      saber block name: gsi covariance
      read:
        gsi akbk: Data/fv3files/akbk72.nc4
        gsi error covariance file: Data/inputs/nmcbalance/gsi-coeffs-gmao-global-l72x288y181.nc4
        gsi berror namelist file: Config/3dvar_gsibec_configuration_c181.nml
        processor layout x direction: 18
        processor layout y direction: 12
#       debugging bypass gsi: true
        debugging mode: false
    saber outer blocks:
    - saber block name: gsi interpolation to model grid
      state variables to inverse: &bvars [eastward_wind,northward_wind,air_temperature,surface_pressure,
                                          specific_humidity,cloud_liquid_ice,cloud_liquid_water,
                                          mole_fraction_of_ozone_in_air,
                                          skin_temperature,
                                          fraction_of_ocean,fraction_of_lake,fraction_of_ice,
                                          sfc_geopotential_height_times_grav]
      gsi akbk: Data/fv3files/akbk72.nc4
      gsi error covariance file: Data/inputs/nmcbalance/gsi-coeffs-gmao-global-l72x288y181.nc4
      gsi berror namelist file: Config/3dvar_gsibec_configuration_c181.nml
      processor layout x direction: 18
      processor layout y direction: 12
#     debugging bypass gsi: true
      debugging mode: false
    linear variable change:
      linear variable change name: Control2Analysis
      input variables: *bvars
      output variables: *anavars

#---------------------------------
  observations:
    observers:

####################################################
##  OBSYS-ON: Aircraft
####################################################
    - obs space:
        name: Aircraft
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/aircraft.$BYYYYYMMDDTHH0000Z.nc4
          obsgrouping:
            group variables: ["stationIdentification", "releaseTime"]
            sort variable: "pressure"
            sort order: "descending"
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/aircraft.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [airTemperature, windEastward, windNorthward]
      
      obs operator:
        name: VertInterp
        observation alias file: 'Config/obsop_name_map.yaml'
#       apply near surface wind scaling: true
      
      obs filters:
      
      # airTemperature
      # --------------
      
      # Reject all obs with PreQC mark already set above 3 - checked, GMAO has noiqc=false so QC limit=4
      # Input prepbufr without OIQC would not have QC marks 4-7 though ("global" assignment of obs error)
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: assign error
            error parameter: 2.0
        
        # Assign the initial observation error, based on pressure (for AIREP/ACARS; itype=130)
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: assign error
            error function:
              name: ObsFunction/ObsErrorModelStepwiseLinear
              options:
                xvar:
                  name: MetaData/pressure
                xvals: [100000, 95000, 90000, 85000, 80000]
                errors: [2.5, 2.3, 2.1, 1.9, 1.7]
          where:
          - variable:
              name: ObsType/airTemperature
            is_in: 130
        
        # Assign the initial observation error, based on pressure (for AMDAR and MDCRS; itype=131,133)
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: assign error
            error function:
              name: ObsFunction/ObsErrorModelStepwiseLinear
              options:
                xvar:
                  name: MetaData/pressure
                xvals: [100000, 95000, 90000, 85000, 80000]
                errors: [1.4706, 1.3529, 1.2353, 1.1176, 1.0]
          where:
          - variable:
              name: ObsType/airTemperature
            is_in: 131,133
        
        # Assign the initial observation error, based on pressure (for RECON aircraft; itype=132)
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: assign error
            error function:
              name: ObsFunction/ObsErrorModelStepwiseLinear
              options:
                xvar:
                  name: MetaData/pressure
                xvals: [105000, 100000, 95000, 90000, 85000, 70000, 65000, 60000, 40000, 35000, 30000, 25000, 20000, 5000]
                errors: [1.5,  1.3,    1.1,   0.9,   0.8,   0.8,   0.75,  0.7,   0.7,   0.75,  0.85,  1.3,   1.5,   1.5]
          where:
          - variable:
              name: ObsType/airTemperature
            is_in: 132
        
        # Assign the initial observation error, based on pressure (for TAMDAR itype=134)
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: assign error
            error function:
              name: ObsFunction/ObsErrorModelStepwiseLinear
              options:
                xvar:
                  name: MetaData/pressure
                xvals: [100000, 95000, 90000, 85000, 80000, 60000, 40000]
                errors: [1.5,   1.35,  1.25,  1.10,  1.0,   1.3,   1.7]
          where:
          - variable:
              name: ObsType/airTemperature
            is_in: 134
  
        # Assign the initial observation error, based on pressure (for Canadian AMDAR itype=135)
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: assign error
            error function:
              name: ObsFunction/ObsErrorModelStepwiseLinear
              options:
                xvar:
                  name: MetaData/pressure
                xvals: [100000, 95000, 90000, 85000, 80000]
                errors: [1.4706, 1.3529, 1.2353, 1.1176, 1000000000.0 ]
          where:
          - variable:
              name: ObsType/airTemperature
            is_in: 135
        
        # When multiple obs exist within a single vertical model level, inflate ObsError
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorConventional
              options:
                test QCflag: PreQC
                inflate variables: [airTemperature]
                pressure: MetaData/pressure
                distance threshold: 60000.0
          defer to post: true
        
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          where:
          - variable: PreQC/airTemperature
            is_in: 4-15
          action:
            name: passivate
          defer to post: true
        
        # TAMDAR and Canadian AMDAR are passive in GSI
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          where:
          - variable:
              name: ObsType/airTemperature
            is_in: 134, 135
          action:
            name: passivate
          defer to post: true
        
        # Inflate kx130 error for obs below 500 if (aircraft_t_bc .and. kx==130 .and. ppb>=500.0_r_kind)
        # toe=toe*r10
        - filter: Perform Action
          action:
            name: inflate error
            inflation factor: 10.
          filter variables:
          - name: airTemperature
          where:
          - variable:
              name: MetaData/pressure
            maxvalue: 110000
            minvalue: 50000
          - variable:
              name: ObsType/airTemperature
            is_in: 130
          defer to post: true
        
        # A temporary solution: Replace error by GsiAdjustObsError overwrite above error assignments and
        # inflation.
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: assign error
            error function: GsiAdjustObsError/airTemperature
          where:
          - variable:
              name: GsiAdjustObsError/airTemperature
            is_defined:
          defer to post: true
        
        # error inflation based on pressure check
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorPressureCheck
              options:
                variable: airTemperature
                inflation factor: 8.0
                surface_obs: false
                adjusted_error_name: GsiAdjustObsError
                geovar_sfc_geomz: surface_geometric_height
          defer to post: true
        
        # assign TempObsErrorData/airTemperature  <--- ObsErrorData before changing its Min and Max
        - filter: Variable Assignment
          assignments:
          - name: TempObsErrorData/airTemperature
            type: float
            function:
              name: ObsFunction/Arithmetic
              options:
                variables:
                - name: ObsErrorData/airTemperature
          defer to post: true
        
        # set ObsErrorData 1.3 K if it < 1.3 K
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: assign error
            error parameter: 1.3
          where:
          - variable:
              name: TempObsErrorData/airTemperature
            maxvalue: 1.3
          - variable:
              name: TempObsErrorData/airTemperature
            is_defined:
          defer to post: true
        
        # set ObsErrorData 5.6 K if it > 5.6 K.
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: assign error
            error parameter: 5.6
          where:
          - variable:
              name: TempObsErrorData/airTemperature
            minvalue: 5.6
          - variable:
              name: TempObsErrorData/airTemperature
            is_defined:
          defer to post: true
        
        # Screen data by PreUseFlag. PreUseFlag is assigned in reading programs in GSI.
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          where:
          - variable: PreUseFlag/airTemperature
            # PreUseFlag should =< ijter ( # of outloop(0,1,2) + 1) in GSI
            minvalue: 1
          action:
            name: reject
        
        # Background  check
        # ratio threshold 7.0
        - filter: Background Check
          filter variables:
          - name: airTemperature
          threshold: 7.0
          action:
            name: reject
          where:
          - variable: PreQC/airTemperature
            is_not_in: [3]
          defer to post: true
        
        # ratio threshold * 0.7 if PreQC=3
        - filter: Background Check
          filter variables:
          - name: airTemperature
          threshold: 4.9
          action:
            name: reject
          where:
          - variable: PreQC/airTemperature
            is_in: [3]
          defer to post: true

        # Re-assign error ObsErrorData/airTemperature <--- TempObsErrorData/airTemperature
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: assign error
            error function: TempObsErrorData/airTemperature
          where:
          - variable:
              name: TempObsErrorData/airTemperature
            is_defined:
          defer to post: true
        ## Duplicate factor
        - filter: Perform Action
          filter variables:
          - name: airTemperature
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorDuplicateCheck
              options:
                use_air_pressure: true
                variable: airTemperature
          defer to post: true
        
        # Note: have not implemented error inflation for new tail. One tail 'RPXTOZBA' had uninitialized
        # errors and its error was inflated by a factor of 1.2
        
        
        # Eastward and northward wind
        # ---------------------------
        # Reject all obs with PreQC mark already set above 3 - checked, GMAO has noiqc=false so QC limit=4
        # Input prepbufr without OIQC would not have QC marks 4-7 though
        - filter: Perform Action
          filter variables:
          - name: windEastward
          - name: windNorthward
          where:
          - variable: PreQC/windEastward
            is_in: 4-15
          action:
            name: passivate
          defer to post: true
        
        - filter: Perform Action
          filter variables:
          - name: windEastward
          - name: windNorthward
          where:
          - variable:
              name: ObsType/windEastward
            is_in: 234, 235
          action:
            name: passivate
          defer to post: true
        
        # Begin by assigning all ObsError as a function of pressure. These will get overwritten (as needed)
        # for specific types. (this is a little strange, but whatever?)
        - filter: Perform Action
          filter variables:
          - name: windEastward
          - name: windNorthward
          action:
            name: assign error
            error function:
              name: ObsFunction/ObsErrorModelStepwiseLinear
              options:
                xvar:
                  name: MetaData/pressure
                xvals: [100000, 95000, 80000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
                errors: [1.4, 1.5, 1.6, 1.8, 1.9, 2.0, 2.1, 2.3, 2.6, 2.8, 3.0, 3.2, 2.7, 2.4, 2.1]
        
        # Assign intial ObsError specific to AIREP/ACARS
        - filter: Perform Action
          filter variables:
          - name: windEastward
          - name: windNorthward
          action:
            name: assign error
            error parameter: 3.6
          where:
          - variable:
              name: ObsType/windEastward
            is_in: 230
        
        # Assign intial ObsError specific to AMDAR
        - filter: Perform Action
          filter variables:
          - name: windEastward
          - name: windNorthward
          action:
            name: assign error
            error parameter: 3.0
          where:
          - variable:
              name: ObsType/windEastward
            is_in: 231
        
        # Assign intial ObsError specific to MDCRS
        - filter: Perform Action
          filter variables:
          - name: windEastward
          - name: windNorthward
          action:
            name: assign error
            error parameter: 2.5
          where:
          - variable:
              name: ObsType/windEastward
            is_in: 233
        
        # Assign intial ObsError specific to TAMDAR, Canadian AMDAR
        - filter: Perform Action
          filter variables:
          - name: windEastward
          - name: windNorthward
          action:
            name: assign error
            error parameter: 3.0
          where:
          - variable:
              name: ObsType/windEastward
            is_in: 234, 235
        
        # Assign the initial ObsError, based on height/pressure for RECON aircraft
        - filter: Perform Action
          filter variables:
          - name: windEastward
          - name: windNorthward
          action:
            name: assign error
            error function:
              name: ObsErrorModelStepwiseLinear@ObsFunction
              options:
                xvar:
                  name: MetaData/pressure
                xvals: [80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 4000, 3000, 2000, 1000, 500]
                errors: [1.5,  1.6,   1.7,   1.8,   1.9,   2.0,   2.1,   2.2,   2.2,   2.3,   2.3,   2.4,   2.4,  2.5,  2.7,  2.9,  3.1]
          where:
          - variable:
              name: ObsType/windEastward
            is_in: 232
        
        # When multiple obs exist within a single vertical model level, inflate ObsError
        - filter: Perform Action
          filter variables:
          - name: windEastward
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorConventional
              options:
                test QCflag: PreQC
                inflate variables: [windEastward]
                pressure: MetaData/pressure
                distance threshold: 60000.0
          defer to post: true
        
        - filter: Perform Action
          filter variables:
          - name: windNorthward
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorConventional
              options:
                test QCflag: PreQC
                inflate variables: [windNorthward]
                pressure: MetaData/pressure
                distance threshold: 60000.0
          defer to post: true
        
        # A temporary solution: Replace error by GsiAdjustObsError overwrite above error assignments and
        # inflation.
        - filter: Perform Action
          filter variables:
          - name: windEastward
          action:
            name: assign error
            error function: GsiAdjustObsError/windEastward
          where:
          - variable:
              name: GsiAdjustObsError/windEastward
            is_defined:
          defer to post: true
        
        - filter: Perform Action
          filter variables:
          - name: windNorthward
          action:
            name: assign error
            error function: GsiAdjustObsError/windNorthward
          where:
          - variable:
              name: GsiAdjustObsError/windNorthward
            is_defined:
          defer to post: true
        
        # Error inflation based on pressure check
        - filter: Perform Action
          filter variables:
          - name: windEastward
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorPressureCheck
              options:
                variable: windEastward
                inflation factor: 4.0
                surface_obs: false
                adjusted_error_name: GsiAdjustObsError
                geovar_sfc_geomz: surface_geometric_height
          defer to post: true
        
        # Error inflation based on pressure check
        - filter: Perform Action
          filter variables:
          - name: windNorthward
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorPressureCheck
              options:
                variable: windNorthward
                inflation factor: 4.0
                surface_obs: false
                adjusted_error_name: GsiAdjustObsError
                geovar_sfc_geomz: surface_geometric_height
          defer to post: true
        
          # Gross Check
        - filter: Background Check
          filter variables:
          - name: windEastward
          function absolute threshold:
          - name: ObsFunction/WindsSPDBCheck
            options:
              wndtype:    [ 230, 231, 232, 233, 234, 235 ]
              cgross:     [ 6.0, 6.5, 7.0, 7.5, 7.5, 7.5 ]
              error_min:  [ 1.4, 1.4, 1.4, 1.4, 1.4, 1.4 ]
              error_max:  [ 6.1, 6.1, 6.1, 6.1, 6.1, 6.1 ]
              variable: windEastward
          action:
            name: reject
          defer to post: true
        
          # Gross Check
        - filter: Background Check
          filter variables:
          - name: windNorthward
          function absolute threshold:
          - name: ObsFunction/WindsSPDBCheck
            options:
              wndtype:    [ 230, 231, 232, 233, 234, 235 ]
              cgross:     [ 6.0, 6.5, 7.0, 7.5, 7.5, 7.5 ]
              error_min:  [ 1.4, 1.4, 1.4, 1.4, 1.4, 1.4 ]
              error_max:  [ 6.1, 6.1, 6.1, 6.1, 6.1, 6.1 ]
              variable: windNorthward
          action:
            name: reject
          defer to post: true
        
        # Duplicate factor
        - filter: Perform Action
          filter variables:
          - name: windEastward
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorDuplicateCheck
              options:
                use_air_pressure: true
                variable: windEastward
          defer to post: true
        
        - filter: Perform Action
          filter variables:
          - name: windNorthward
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorDuplicateCheck
              options:
                use_air_pressure: true
                variable: windNorthward
          defer to post: true

####################################################
##  OBSYS-ON: AIRS-Aqua
####################################################
    - obs space:
        name: &Sensor_ID airs_aqua
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/airs_aqua.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/airs_aqua.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &airs_aqua_channels
                  1, 6, 7, 10, 11, 15, 16, 17, 20, 21, 22, 24,
                  27, 28, 30, 36, 39, 40, 42, 51, 52, 54, 55, 56, 59, 62, 63, 68, 69, 71,
                  72, 73, 74, 75, 76, 77, 78, 79, 80, 82, 83, 84, 86, 92, 93, 98, 99, 101,
                  104, 105, 108, 110, 111, 113, 116, 117, 123, 124, 128, 129, 138, 139,
                  144, 145, 150, 151, 156, 157, 159, 162, 165, 168, 169, 170, 172, 173,
                  174, 175, 177, 179, 180, 182, 185, 186, 190, 192, 198, 201, 204, 207,
                  210, 215, 216, 221, 226, 227, 232, 252, 253, 256, 257, 261, 262, 267,
                  272, 295, 299, 300, 305, 310, 321, 325, 333, 338, 355, 362, 375, 453,
                  475, 484, 497, 528, 587, 672, 787, 791, 843, 870, 914, 950, 1003, 1012,
                  1019, 1024, 1030, 1038, 1048, 1069, 1079, 1082, 1083, 1088, 1090, 1092,
                  1095, 1104, 1111, 1115, 1116, 1119, 1120, 1123, 1130, 1138, 1142, 1178,
                  1199, 1206, 1221, 1237, 1252, 1260, 1263, 1266, 1285, 1301, 1304, 1329,
                  1371, 1382, 1415, 1424, 1449, 1455, 1466, 1477, 1500, 1519, 1538, 1545,
                  1565, 1574, 1583, 1593, 1614, 1627, 1636, 1644, 1652, 1669, 1674, 1681,
                  1694, 1708, 1717, 1723, 1740, 1748, 1751, 1756, 1763, 1766, 1771, 1777,
                  1780, 1783, 1794, 1800, 1803, 1806, 1812, 1826, 1843, 1852, 1865, 1866,
                  1868, 1869, 1872, 1873, 1876, 1881, 1882, 1883, 1911, 1917, 1918, 1924,
                  1928, 1937, 1941, 2099, 2100, 2101, 2103, 2104, 2106, 2107, 2108, 2109,
                  2110, 2111, 2112, 2113, 2114, 2115, 2116, 2117, 2118, 2119, 2120, 2121,
                  2122, 2123, 2128, 2134, 2141, 2145, 2149, 2153, 2164, 2189, 2197, 2209,
                  2226, 2234, 2280, 2318, 2321, 2325, 2328, 2333, 2339, 2348, 2353, 2355,
                  2357, 2363, 2370, 2371, 2377
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
    #     Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
    #    SurfaceWindGeoVars: uv
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &airs_aqua_satbias Data/obs/airs_aqua.$PYYYYYMMDDTHH0000Z.satbias.nc4
        output file: Data/vbc/airs_aqua.$PYYYYYMMDDTHH0000Z.satbias.nc4
        variational bc:
          predictors:
          - name: constant
          - name: lapse_rate
            order: 2
            tlapse: &airs_aqua_tlapse Data/obs/airs_aqua.$PYYYYYMMDDTHH0000Z.tlapse.txt
          - name: lapse_rate
            tlapse: *airs_aqua_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *airs_aqua_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/airs_aqua.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      - filter: Perform Action
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        action:
          name: assign error
          error parameter vector: [ 1.2000, 1.2000, 1.3136, 1.4000, 1.4000, 1.2639, 1.4000, 1.4000, 1.1802, 1.2517,
                        1.1719, 1.2000, 1.1728, 1.1442, 1.2000, 1.2000, 1.1500, 1.0801, 1.1500, 1.1500,
                        1.0396, 1.1500, 1.1500, 1.1500, 1.1500, 1.1500, 1.1500, 1.1500, 0.9946, 1.0500,
                        0.9217, 2.0000, 2.0000, 2.0000, 2.0000, 2.0000, 2.0000, 2.0000, 2.0000, 2.0000,
                        2.0000, 2.0000, 2.0000, 0.9591, 0.9465, 0.9593, 0.9337, 1.0000, 0.9861, 1.0017,
                        1.1000, 1.0083, 1.0024, 1.1000, 0.9967, 1.0094, 0.9412, 1.1000, 0.9980, 0.9807,
                        0.8570, 0.8727, 0.8114, 0.8790, 0.8710, 0.8853, 0.7937, 0.8243, 0.8000, 0.8016,
                        0.8000, 0.7781, 0.7475, 0.8500, 0.7405, 0.7150, 0.7416, 0.7465, 0.9000, 0.7198,
                        0.7157, 0.9000, 0.7270, 0.7246, 0.7040, 0.7039, 0.6600, 0.6694, 0.6669, 0.7031,
                        0.6977, 0.6488, 0.6653, 0.9000, 0.6265, 0.6220, 0.6308, 0.6297, 0.6210, 0.6225,
                        0.6229, 0.6234, 0.6238, 0.6332, 0.6425, 0.7028, 0.6152, 0.9000, 0.7257, 0.7288,
                        1.1500, 0.9000, 0.6673, 0.7473, 0.6767, 0.7056, 0.9000, 0.9500, 0.7271, 0.9500,
                        0.7250, 0.7601, 0.6973, 0.7573, 0.6011, 0.6060, 0.9000, 0.6635, 0.5860, 0.5766,
                        0.7500, 2.0386, 0.7500, 1.0000, 0.9000, 0.9000, 0.9000, 0.9000, 0.9000, 0.9000,
                        1.0000, 1.3386, 1.0000, 1.0000, 0.8500, 0.9500, 1.7386, 0.9500, 0.9000, 0.8000,
                        1.7386, 0.7500, 0.7500, 0.7500, 0.8000, 0.7500, 0.8000, 0.9000, 0.7500, 0.8000,
                        0.8000, 1.1000, 0.7500, 1.1000, 0.7500, 0.5991, 0.5348, 0.6541, 0.7421, 0.6192,
                        0.8186, 1.0616, 0.8848, 1.0240, 2.5000, 1.0249, 1.0795, 1.2199, 2.5000, 2.5000,
                        1.3103, 1.3603, 2.5000, 2.5000, 2.5000, 1.3230, 2.5000, 2.5000, 2.5000, 1.4406,
                        2.5000, 2.5000, 1.3965, 2.5000, 2.5000, 2.5000, 2.5000, 2.5000, 2.5000, 2.5000,
                        2.5000, 1.6997, 2.5000, 2.5000, 2.5000, 2.5000, 2.5000, 1.6264, 2.5000, 2.5000,
                        2.5000, 1.3436, 2.5000, 2.5000, 0.5727, 0.6838, 0.5994, 0.5178, 0.5145, 0.5470,
                        0.5572, 0.5002, 0.4974, 0.5500, 0.4953, 0.4883, 0.4948, 0.5446, 0.5777, 1.5000,
                        1.5000, 3.0000, 3.0000, 2.5000, 2.5000, 2.0000, 1.0000, 1.5000, 1.5000, 1.8000,
                        0.6000, 0.7000, 0.6500, 0.6750, 0.7000, 0.7500, 0.7750, 0.8000, 0.8000, 0.8500,
                        0.8500, 0.8500, 0.7000, 0.7000, 0.7000, 0.7000, 0.7000, 0.7000, 0.7000, 0.7250,
                        0.7500, 0.7750, 0.8000, 0.8250, 0.8000, 0.8000, 0.8000, 0.7500, 0.8000, 0.8000,
                        0.8000, 0.8000, 0.8000, 0.8500, 0.8000, 0.8000, 2.5000, 0.7500, 0.7500, 0.7500,
                        0.7500 ]
    # assign ObsError <---- ObsErrorData (Assigned in Yaml)
      - filter: Variable Assignment
        assignments:
        - name: ObsError/brightnessTemperature
          channels: *airs_aqua_channels
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature
                channels: *airs_aqua_channels
    #  Wavenumber Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: 2122, 2123, 2128, 2134, 2141, 2145, 2149, 2153, 2164, 2189, 2197, 2209,
                    2226, 2234, 2280, 2318, 2321, 2325, 2328, 2333, 2339, 2348, 2353, 2355,
                    2357, 2363, 2370, 2371, 2377
        where:
        - variable:
            name: MetaData/solarZenithAngle
          maxvalue: 88.9999
        - variable:
            name: water_area_fraction@GeoVaLs
          minvalue: 1.0e-12
        action:
          name: reject
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorWavenumIR
            channels: *airs_aqua_channels
            options:
              channels: *airs_aqua_channels
    #  Observation Range Sanity Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        minvalue: 50.00001
        maxvalue: 549.99999
        action:
          name: reject
    #  Topography Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTopoRad
            channels: *airs_aqua_channels
            options:
              channels: *airs_aqua_channels
              sensor: *Sensor_ID
    #  Transmittance Top Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTransmitTopRad
            channels: *airs_aqua_channels
            options:
              channels: *airs_aqua_channels
    #  Cloud Detection Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        test variables:
        - name: ObsFunction/CloudDetectMinResidualIR
          channels: *airs_aqua_channels
          options:
            channels: *airs_aqua_channels
            use_flag: &useflag_airs_aqua [ -1, -1,  1, -1, -1,  1, -1, -1,  1,  1,
                         1, -1,  1,  1, -1, -1, -1,  1, -1, -1,
                         1, -1, -1, -1, -1, -1, -1, -1,  1, -1,
                         1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                        -1, -1, -1,  1,  1,  1,  1, -1,  1,  1,
                        -1,  1,  1, -1,  1,  1,  1, -1,  1,  1,
                         1,  1,  1,  1,  1,  1,  1,  1, -1,  1,
                        -1,  1,  1, -1,  1,  1,  1,  1, -1,  1,
                         1, -1,  1,  1,  1,  1,  1,  1,  1,  1,
                         1,  1,  1, -1,  1,  1,  1,  1,  1,  1,
                         1,  1,  1,  1,  1,  1,  1, -1,  1,  1,
                        -1, -1,  1,  1,  1,  1, -1, -1,  1, -1,
                         1,  1,  1,  1,  1,  1, -1,  1,  1,  1,
                        -1,  1, -1, -1, -1, -1, -1, -1, -1, -1,
                        -1,  1, -1, -1, -1, -1,  1, -1, -1, -1,
                         1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                        -1, -1, -1, -1, -1,  1,  1,  1,  1,  1,
                         1,  1,  1,  1, -1,  1,  1,  1, -1, -1,
                         1,  1, -1, -1, -1,  1, -1, -1, -1,  1,
                        -1, -1,  1, -1, -1, -1, -1, -1, -1, -1,
                        -1,  1, -1, -1, -1, -1, -1,  1, -1, -1,
                        -1,  1, -1, -1,  1,  1,  1,  1,  1,  1,
                         1,  1,  1, -1,  1,  1,  1,  1,  1, -1,
                        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                        -1 ]
            use_flag_clddet: &clddet_airs_aqua [ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1,31, 1,31, 1, 1, 1, 1, 1, 1,
                               1,31, 1, 1, 1, 1,31, 1, 1, 1,
                              31, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                               1 ]
            obserr_dtempf: [0.50, 2.00, 4.00, 2.00, 4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
    #  NSST Retrieval Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        test variables:
        - name: ObsFunction/NearSSTRetCheckIR
          channels: *airs_aqua_channels
          options:
            channels: *airs_aqua_channels
            use_flag: *useflag_airs_aqua
            obserr_demisf: [0.01, 0.02, 0.03, 0.02, 0.03]
            obserr_dtempf: [0.50, 2.00, 4.00, 2.00, 4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
    #  Surface Jacobians Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorSurfJacobianRad
            channels: *airs_aqua_channels
            options:
              channels: *airs_aqua_channels
              sensor: *Sensor_ID
              obserr_demisf: [0.01, 0.02, 0.03, 0.02, 0.03]
              obserr_dtempf: [0.50, 2.00, 4.00, 2.00, 4.00]
    #  Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        function absolute threshold:
        - name: ObsFunction/ObsErrorBoundIR
          channels: *airs_aqua_channels
          options:
            channels: *airs_aqua_channels
            obserr_bound_latitude:
              name: ObsFunction/ObsErrorFactorLatRad
              options:
                latitude_parameters: [25.0, 0.5, 0.04, 1.0]
            obserr_bound_transmittop:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *airs_aqua_channels
              options:
                channels: *airs_aqua_channels
            obserr_bound_max: [3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50,
                               3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50,
                               3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50,
                               3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50,
                               3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50,
                               3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50,
                               3.50, 3.50, 3.00, 3.00, 3.00, 3.00, 1.00, 1.00, 3.00, 1.00,
                               3.00, 1.00, 1.00, 3.00, 1.00, 1.00, 1.00, 1.00, 3.00, 1.00,
                               1.00, 3.00, 1.00, 1.00, 1.00, 1.00, 1.00, 1.00, 3.00, 3.00,
                               3.50, 3.00, 3.50, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00,
                               3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00,
                               3.50, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00,
                               3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00,
                               3.00, 1.70, 3.00, 1.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00,
                               3.50, 1.25, 3.50, 3.50, 3.00, 3.00, 1.50, 3.00, 3.00, 3.00,
                               1.50, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00,
                               3.00, 3.50, 3.00, 3.50, 3.00, 3.00, 3.00, 3.00, 3.50, 3.00,
                               4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50,
                               4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50,
                               4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50,
                               4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50, 4.50,
                               4.50, 4.50, 4.50, 4.50, 2.50, 2.50, 2.50, 2.50, 2.50, 2.50,
                               2.50, 2.50, 2.50, 2.50, 2.50, 2.50, 2.50, 2.50, 2.50, 3.50,
                               3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50, 3.50,
                               3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00,
                               3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00,
                               3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00,
                               3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00, 3.00,
                               3.00 ]
        action:
          name: reject
    #  Surface Type Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        test variables:
        - name: ObsFunction/SurfTypeCheckRad
          channels: *airs_aqua_channels
          options:
            channels: *airs_aqua_channels
            use_flag: *useflag_airs_aqua
            use_flag_clddet: *clddet_airs_aqua
        maxvalue: 1.0e-12
        defer to post: true
        action:
          name: reject
    #  Useflag Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *airs_aqua_channels
        test variables:
        - name: ObsFunction/ChannelUseflagCheckRad
          channels: *airs_aqua_channels
          options:
            channels: *airs_aqua_channels
#           use passive_bc: true
            use_flag: *useflag_airs_aqua
        minvalue: 1.0e-12
        action:
          name: reject
    # passedBenchmark: 5420  #(m_qc)
    # passedBenchmark: 797414   #(m_unittest)

####################################################
##  OBSYS-ON: AMSUA-Metop-B
####################################################
    - obs space:
        name: &Sensor_ID amsua_metop-b
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/amsua_metop-b.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/amsua_metop-b.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &amsua_metop-b_available_channels 1-15
      
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        obs options:
          Sensor_ID: &Sensor_ID amsua_metop-b
          EndianType: little_endian
#         CoefficientPath: '$JEDI_CRTM_COEFFS'
#         Some bug in the coeffs or how things are handle in JEDI make JEDI incapable of reading the FP coeffs for this
          CoefficientPath: '/discover/nobackup/drholdaw/SwellStaticFiles/jedi/crtm_coefficients/2.4/'
        linear obs operator:
          Absorbers: [H2O,O3]
      
      obs bias:
        input file: &amsua_metop-b_satbias 'Data/obs/amsua_metop-b.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/amsua_metop-b.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variables without bc: [brightnessTemperature]
        channels: 14
        variational bc:
          predictors:
          - name: constant
          - name: cloud_liquid_water
            sensor: AMSUA
            clwdif_ch238: 1
            clwdif_ch314: 2
          - name: lapse_rate
            order: 2
            tlapse: &amsua_metop-b_tlapse 'Data/obs/amsua_metop-b.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *amsua_metop-b_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *amsua_metop-b_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/amsua_metop-b.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      # Window and surface-sensitive channels check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: 1-6,15
          test variables:
          - name: ObsValue/brightnessTemperature
            channels: 1-6,15
          treat missing as out of bounds: true
          minvalue: 100.0
          maxvalue: 500.0
          flag all filter variables if any test variable is out of bounds: true
      # passedBenchmark: 1500
      # All channels unreasonable values check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-b_available_channels
          minvalue: 100.0
          maxvalue: 500.0
      #  Hydrometeor Check (cloud/precipitation affected chanels)
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-b_available_channels
          test variables:
          - name: ObsFunction/HydrometeorCheckAMSUAclr
            channels: *amsua_metop-b_available_channels
            options:
              sensor: *Sensor_ID
              channels: *amsua_metop-b_available_channels
              test_biaspredictor: cloud_liquid_waterPredictor
          maxvalue: 0.0
          action:
            name: reject
      # Assign obs error
        - filter: Perform Action
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-b_available_channels
          action:
            name: assign error
            error parameter vector:
                        [2.500,  2.000,  2.000,  0.550,  0.300,
                         0.230,  0.230,  0.250,  0.250,  0.350,
                         0.400,  0.550,  0.800,  5.000,  2.500]
      # Topography check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-b_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorTopoRad
              channels: *amsua_metop-b_available_channels
              options:
                sensor: *Sensor_ID
                channels: *amsua_metop-b_available_channels
      # Transmittance Top Check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-b_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *amsua_metop-b_available_channels
              options:
                channels: *amsua_metop-b_available_channels
      # Surface Jacobian check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-b_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorSurfJacobianRad
              channels: *amsua_metop-b_available_channels
              options:
                channels: *amsua_metop-b_available_channels
                sensor: *Sensor_ID
                use_biasterm: true
                test_biasterm: ObsBiasTerm
                obserr_demisf: [0.010, 0.020, 0.015, 0.020, 0.200]
                obserr_dtempf: [0.500, 2.000, 1.000, 2.000, 4.500]
      # Gross check
        - filter: Background Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-b_available_channels
          function absolute threshold:
          - name: ObsFunction/ObsErrorBoundMW
            channels: *amsua_metop-b_available_channels
            options:
              sensor: *Sensor_ID
              channels: *amsua_metop-b_available_channels
              obserr_bound_latitude:
                name: ObsFunction/ObsErrorFactorLatRad
                options:
                  latitude_parameters: [25.0, 0.25, 0.04, 3.0]
              obserr_bound_transmittop:
                name: ObsFunction/ObsErrorFactorTransmitTopRad
                channels: *amsua_metop-b_available_channels
                options:
                  channels: *amsua_metop-b_available_channels
              obserr_bound_topo:
                name: ObsFunction/ObsErrorFactorTopoRad
                channels: *amsua_metop-b_available_channels
                options:
                  channels: *amsua_metop-b_available_channels
                  sensor: *Sensor_ID
              error parameter vector:
                        [2.500,  2.000,  2.000,  0.550,  0.300,
                         0.230,  0.230,  0.250,  0.250,  0.350,
                         0.400,  0.550,  0.800,  5.000,  2.500]
              obserr_bound_max: [4.5, 4.5, 4.5, 2.5, 2.0,
                                 2.0, 2.0, 2.0, 2.0, 2.0,
                                 2.5, 3.5, 4.5, 4.5, 4.5]
          action:
            name: reject
      # Inter-channel check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-b_available_channels
          test variables:
          - name: ObsFunction/InterChannelConsistencyCheck
            channels: *amsua_metop-b_available_channels
            options:
              channels: *amsua_metop-b_available_channels
              use passive_bc: true
              sensor: *Sensor_ID
              use_flag: [-1, -1, -1, -1, -1,
                         -1,  1,  1,  1,  1,
                          1,  1,  1,  1, -1]
          maxvalue: 1.0e-12
          action:
            name: reject
      #  Useflag check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-b_available_channels
          test variables:
          - name: ObsFunction/ChannelUseflagCheckRad
            channels: *amsua_metop-b_available_channels
            options:
              channels: *amsua_metop-b_available_channels
      #       use passive_bc: true
              use_flag: [-1, -1, -1, -1, -1,
                         -1,  1,  1,  1,  1,
                          1,  1,  1,  1, -1]
          minvalue: 1.0e-12
          action:
            name: reject
 

####################################################
##  OBSYS-ON: AMSUA-Metop-C
####################################################
    - obs space:
        name: &Sensor_ID amsua_metop-c
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/amsua_metop-c.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/amsua_metop-c.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &amsua_metop-c_available_channels 1-15
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &amsua_metop-c_satbias 'Data/obs/amsua_metop-c.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/amsua_metop-c.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variables without bc: [brightnessTemperature]
        channels: 14
        variational bc:
          predictors:
          - name: constant
          - name: cloud_liquid_water
            sensor: AMSUA
            clwdif_ch238: 1
            clwdif_ch314: 2
          - name: lapse_rate
            order: 2
            tlapse: &amsua_metop-c_tlapse 'Data/obs/amsua_metop-c.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *amsua_metop-c_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *amsua_metop-c_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/amsua_metop-c.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      # Assign GSI-style QC
#       - filter: PreQC
#         maxvalue: 4
      # Window and surface-sensitive channels check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: 1-6,15
          test variables:
          - name: ObsValue/brightnessTemperature
            channels: 1-6,15
          treat missing as out of bounds: true
          minvalue: 100.0
          maxvalue: 500.0
          flag all filter variables if any test variable is out of bounds: true
      # passedBenchmark: 1500
      # All channels unreasonable values check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-c_available_channels
          minvalue: 100.0
          maxvalue: 500.0
      #  Hydrometeor Check (cloud/precipitation affected chanels)
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-c_available_channels
          test variables:
          - name: ObsFunction/HydrometeorCheckAMSUAclr
            channels: *amsua_metop-c_available_channels
            options:
              sensor: *Sensor_ID
              channels: *amsua_metop-c_available_channels
              test_biaspredictor: cloud_liquid_waterPredictor
          maxvalue: 0.0
          action:
            name: reject
      # Assign obs error
        - filter: Perform Action
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-c_available_channels
          action:
            name: assign error
            error parameter vector:
                        [2.500,  2.000,  2.000,  0.550,  0.300,
                         0.230,  0.230,  0.250,  0.250,  0.350,
                         0.400,  0.550,  0.800,  5.000,  2.500]
      # Topography check
#       - filter: BlackList
#         filter variables:
#         - name: brightnessTemperature
#           channels: *amsua_metop-c_available_channels
#         action:
#           name: inflate error
#           inflation variable:
#           name: ObsFunction/ObsErrorFactorTopoRad
#           channels: *amsua_metop-c_available_channels
#           options:
#             sensor: *Sensor_ID
#             channels: *amsua_metop-c_available_channels
      # Transmittance Top Check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-c_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *amsua_metop-c_available_channels
              options:
                channels: *amsua_metop-c_available_channels
      # Surface Jacobian check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-c_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorSurfJacobianRad
              channels: *amsua_metop-c_available_channels
              options:
                channels: *amsua_metop-c_available_channels
                sensor: *Sensor_ID
                use_biasterm: true
                test_biasterm: ObsBiasTerm
                obserr_demisf: [0.010, 0.020, 0.015, 0.020, 0.200]
                obserr_dtempf: [0.500, 2.000, 1.000, 2.000, 4.500]
      # Gross check
        - filter: Background Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-c_available_channels
          function absolute threshold:
          - name: ObsFunction/ObsErrorBoundMW
            channels: *amsua_metop-c_available_channels
            options:
              sensor: *Sensor_ID
              channels: *amsua_metop-c_available_channels
              obserr_bound_latitude:
                name: ObsFunction/ObsErrorFactorLatRad
                options:
                  latitude_parameters: [25.0, 0.25, 0.04, 3.0]
              obserr_bound_transmittop:
                name: ObsFunction/ObsErrorFactorTransmitTopRad
                channels: *amsua_metop-c_available_channels
                options:
                  channels: *amsua_metop-c_available_channels
              obserr_bound_topo:
                name: ObsFunction/ObsErrorFactorTopoRad
                channels: *amsua_metop-c_available_channels
                options:
                  channels: *amsua_metop-c_available_channels
                  sensor: *Sensor_ID
              error parameter vector:
                          [2.500,  2.000,  2.000,  0.550,  0.300,
                           0.230,  0.230,  0.250,  0.250,  0.350,
                           0.400,  0.550,  0.800,  5.000,  2.500]
              obserr_bound_max: [4.5, 4.5, 4.5, 2.5, 2.0,
                                 2.0, 2.0, 2.0, 2.0, 2.0,
                                 2.5, 3.5, 4.5, 4.5, 4.5]
          action:
            name: reject
      # Inter-channel check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-c_available_channels
          test variables:
          - name: ObsFunction/InterChannelConsistencyCheck
            channels: *amsua_metop-c_available_channels
            options:
              channels: *amsua_metop-c_available_channels
              use passive_bc: true
              sensor: *Sensor_ID
              use_flag: &use_flag_amsua_metop-c [-1, -1, -1,  1,  1,
                                                  1,  1,  1,  1,  1,
                                                  1,  1,  1,  1, -1]
          maxvalue: 1.0e-12
          action:
            name: reject
      #  Useflag check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_metop-c_available_channels
          test variables:
          - name: ObsFunction/ChannelUseflagCheckRad
            channels: *amsua_metop-c_available_channels
            options:
              channels: *amsua_metop-c_available_channels
#             use passive_bc: true
              use_flag: *use_flag_amsua_metop-c
          minvalue: 1.0e-12
          action:
            name: reject

####################################################
##  OBSYS-ON: AMSUA-N15
####################################################
    - obs space:
        name: &Sensor_ID amsua_n15
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/amsua_n15.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/amsua_n15.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &amsua_n15_available_channels 1-15
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &amsua_n15_satbias 'Data/obs/amsua_n15.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/amsua_n15.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variables without bc: [brightnessTemperature]
        channels: 14
        variational bc:
          predictors:
          - name: constant
          - name: cloud_liquid_water
            sensor: AMSUA
            clwdif_ch238: 1
            clwdif_ch314: 2
          - name: lapse_rate
            order: 2
            tlapse: &amsua_n15_tlapse 'Data/obs/amsua_n15.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *amsua_n15_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *amsua_n15_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/amsua_n15.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      # Assign GSI-style QC
#       - filter: PreQC
#         maxvalue: 4
      # Window and surface-sensitive channels check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: 1-6,15
          test variables:
          - name: ObsValue/brightnessTemperature
            channels: 1-6,15
          treat missing as out of bounds: true
          minvalue: 100.0
          maxvalue: 500.0
          flag all filter variables if any test variable is out of bounds: true
      # passedBenchmark: 1500
      # All channels unreasonable values check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n15_available_channels
          minvalue: 100.0
          maxvalue: 500.0
      #  Hydrometeor Check (cloud/precipitation affected chanels)
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n15_available_channels
          test variables:
          - name: ObsFunction/HydrometeorCheckAMSUAclr
            channels: *amsua_n15_available_channels
            options:
              sensor: *Sensor_ID
              channels: *amsua_n15_available_channels
              test_biaspredictor: cloud_liquid_waterPredictor
          maxvalue: 0.0
          action:
            name: reject
      # Assign obs error
        - filter: Perform Action
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n15_available_channels
          action:
            name: assign error
            error parameter vector:
                        [3.000,  2.000,  2.000,  0.600,  0.300,
                         0.230,  0.250,  0.275,  0.340,  0.400,
                         0.600,  1.000,  1.500,  5.000,  3.000]
      # Topography check
#       - filter: BlackList
#         filter variables:
#         - name: brightnessTemperature
#           channels: *amsua_n15_available_channels
#         action:
#           name: inflate error
#           inflation variable:
#           name: ObsFunction/ObsErrorFactorTopoRad
#           channels: *amsua_n15_available_channels
#           options:
#             sensor: *Sensor_ID
#             channels: *amsua_n15_available_channels
      # Transmittance Top Check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n15_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *amsua_n15_available_channels
              options:
                channels: *amsua_n15_available_channels
      # Surface Jacobian check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n15_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorSurfJacobianRad
              channels: *amsua_n15_available_channels
              options:
                channels: *amsua_n15_available_channels
                sensor: *Sensor_ID
                use_biasterm: true
                test_biasterm: ObsBiasTerm
                obserr_demisf: [0.010, 0.020, 0.015, 0.020, 0.200]
                obserr_dtempf: [0.500, 2.000, 1.000, 2.000, 4.500]
      # Gross check
        - filter: Background Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n15_available_channels
          function absolute threshold:
          - name: ObsFunction/ObsErrorBoundMW
            channels: *amsua_n15_available_channels
            options:
              sensor: *Sensor_ID
              channels: *amsua_n15_available_channels
              obserr_bound_latitude:
                name: ObsFunction/ObsErrorFactorLatRad
                options:
                  latitude_parameters: [25.0, 0.25, 0.04, 3.0]
              obserr_bound_transmittop:
                name: ObsFunction/ObsErrorFactorTransmitTopRad
                channels: *amsua_n15_available_channels
                options:
                  channels: *amsua_n15_available_channels
              obserr_bound_topo:
                name: ObsFunction/ObsErrorFactorTopoRad
                channels: *amsua_n15_available_channels
                options:
                  channels: *amsua_n15_available_channels
                  sensor: *Sensor_ID
              error parameter vector:
                        [3.000,  2.000,  2.000,  0.600,  0.300,
                         0.230,  0.250,  0.275,  0.340,  0.400,
                         0.600,  1.000,  1.500,  5.000,  3.000]
              obserr_bound_max: [4.5, 4.5, 4.5, 2.5, 2.0,
                                 2.0, 2.0, 2.0, 2.0, 2.0,
                                 2.5, 3.5, 4.5, 4.5, 4.5]
          action:
            name: reject
      # Inter-channel check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n15_available_channels
          test variables:
          - name: ObsFunction/InterChannelConsistencyCheck
            channels: *amsua_n15_available_channels
            options:
              channels: *amsua_n15_available_channels
              use passive_bc: true
              sensor: *Sensor_ID
              use_flag: [-1, -1, -1,  1,  1,
                         -1,  1,  1,  1,  1,
                         -1,  1,  1, -1, -1]
          maxvalue: 1.0e-12
          action:
            name: reject
      #  Useflag check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n15_available_channels
          test variables:
          - name: ObsFunction/ChannelUseflagCheckRad
            channels: *amsua_n15_available_channels
            options:
              channels: *amsua_n15_available_channels
#             use passive_bc: true
              use_flag: [-1, -1, -1,  1,  1,
                         -1,  1,  1,  1,  1,
                         -1,  1,  1, -1, -1]
          minvalue: 1.0e-12
          action:
            name: reject

####################################################
##  OBSYS-ON: AMSUA-N18
####################################################
    - obs space:
        name: &Sensor_ID amsua_n18
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/amsua_n18.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/amsua_n18.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &amsua_n18_available_channels 1-15
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &amsua_n18_satbias 'Data/obs/amsua_n18.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/amsua_n18.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variables without bc: [brightnessTemperature]
        channels: 14
        variational bc:
          predictors:
          - name: constant
          - name: cloud_liquid_water
            sensor: AMSUA
            clwdif_ch238: 1
            clwdif_ch314: 2
          - name: lapse_rate
            order: 2
            tlapse: &amsua_n18_tlapse 'Data/obs/amsua_n18.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *amsua_n18_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *amsua_n18_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/amsua_n18.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      # Assign GSI-style QC
#       - filter: PreQC
#         maxvalue: 4
      # Window and surface-sensitive channels check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: 1-6,15
          test variables:
          - name: ObsValue/brightnessTemperature
            channels: 1-6,15
          treat missing as out of bounds: true
          minvalue: 100.0
          maxvalue: 500.0
          flag all filter variables if any test variable is out of bounds: true
      # passedBenchmark: 1500
      # All channels unreasonable values check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n18_available_channels
          minvalue: 100.0
          maxvalue: 500.0
      #  Hydrometeor Check (cloud/precipitation affected chanels)
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n18_available_channels
          test variables:
          - name: ObsFunction/HydrometeorCheckAMSUAclr
            channels: *amsua_n18_available_channels
            options:
              sensor: *Sensor_ID
              channels: *amsua_n18_available_channels
              test_biaspredictor: cloud_liquid_waterPredictor
          maxvalue: 0.0
          action:
            name: reject
      # Assign obs error
        - filter: Perform Action
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n18_available_channels
          action:
            name: assign error
            error parameter vector:
                        [2.500,  2.000,  2.000,  0.550,  0.300,
                         0.230,  0.230,  0.250,  0.250,  0.350,
                         0.400,  0.550,  0.800,  5.000,  2.500]
      # Topography check
#       - filter: BlackList
#         filter variables:
#         - name: brightnessTemperature
#           channels: *amsua_n18_available_channels
#         action:
#           name: inflate error
#           inflation variable:
#           name: ObsFunction/ObsErrorFactorTopoRad
#           channels: *amsua_n18_available_channels
#           options:
#             sensor: *Sensor_ID
#             channels: *amsua_n18_available_channels
      # Transmittance Top Check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n18_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *amsua_n18_available_channels
              options:
                channels: *amsua_n18_available_channels
      # Surface Jacobian check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n18_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorSurfJacobianRad
              channels: *amsua_n18_available_channels
              options:
                channels: *amsua_n18_available_channels
                sensor: *Sensor_ID
                use_biasterm: true
                test_biasterm: ObsBiasTerm
                obserr_demisf: [0.010, 0.020, 0.015, 0.020, 0.200]
                obserr_dtempf: [0.500, 2.000, 1.000, 2.000, 4.500]
      # Gross check
        - filter: Background Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n18_available_channels
          function absolute threshold:
          - name: ObsFunction/ObsErrorBoundMW
            channels: *amsua_n18_available_channels
            options:
              sensor: *Sensor_ID
              channels: *amsua_n18_available_channels
              obserr_bound_latitude:
                name: ObsFunction/ObsErrorFactorLatRad
                options:
                  latitude_parameters: [25.0, 0.25, 0.04, 3.0]
              obserr_bound_transmittop:
                name: ObsFunction/ObsErrorFactorTransmitTopRad
                channels: *amsua_n18_available_channels
                options:
                  channels: *amsua_n18_available_channels
              obserr_bound_topo:
                name: ObsFunction/ObsErrorFactorTopoRad
                channels: *amsua_n18_available_channels
                options:
                  channels: *amsua_n18_available_channels
                  sensor: *Sensor_ID
              error parameter vector:
                        [2.500,  2.000,  2.000,  0.550,  0.300,
                         0.230,  0.230,  0.250,  0.250,  0.350,
                         0.400,  0.550,  0.800,  5.000,  2.500]
              obserr_bound_max: [4.5, 4.5, 4.5, 2.5, 2.0,
                                 2.0, 2.0, 2.0, 2.0, 2.0,
                                 2.5, 3.5, 4.5, 4.5, 4.5]
          action:
            name: reject
      # Inter-channel check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n18_available_channels
          test variables:
          - name: ObsFunction/InterChannelConsistencyCheck
            channels: *amsua_n18_available_channels
            options:
              channels: *amsua_n18_available_channels
              use passive_bc: true
              sensor: *Sensor_ID
              use_flag: [-1, -1, -1,  1, -1,
                          1,  1, -1, -1,  1,
                          1,  1,  1,  1, -1]
          maxvalue: 1.0e-12
          action:
            name: reject
      #  Useflag check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n18_available_channels
          test variables:
          - name: ObsFunction/ChannelUseflagCheckRad
            channels: *amsua_n18_available_channels
            options:
              channels: *amsua_n18_available_channels
#             use passive_bc: true
              use_flag: [-1, -1, -1,  1, -1,
                          1,  1, -1, -1,  1,
                          1,  1,  1,  1, -1]
          minvalue: 1.0e-12
          action:
            name: reject

####################################################
##  OBSYS-ON: AMSUA-N19
####################################################
    - obs space:
        name: &Sensor_ID amsua_n19
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/amsua_n19.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/amsua_n19.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &amsua_n19_available_channels 1-15
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &amsua_n19_satbias 'Data/obs/amsua_n19.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/amsua_n19.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variables without bc: [brightnessTemperature]
        channels: 14
        variational bc:
          predictors:
          - name: constant
          - name: cloud_liquid_water
            sensor: AMSUA
            clwdif_ch238: 1
            clwdif_ch314: 2
          - name: lapse_rate
            order: 2
            tlapse: &amsua_n19_tlapse 'Data/obs/amsua_n19.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *amsua_n19_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *amsua_n19_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/amsua_n19.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      # Assign GSI-style QC
#       - filter: PreQC
#         maxvalue: 4
      # Window and surface-sensitive channels check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: 1-6,15
          test variables:
          - name: ObsValue/brightnessTemperature
            channels: 1-6,15
          treat missing as out of bounds: true
          minvalue: 100.0
          maxvalue: 500.0
          flag all filter variables if any test variable is out of bounds: true
      # passedBenchmark: 1500
      # All channels unreasonable values check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n19_available_channels
          minvalue: 100.0
          maxvalue: 500.0
      #  Hydrometeor Check (cloud/precipitation affected chanels)
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n19_available_channels
          test variables:
          - name: ObsFunction/HydrometeorCheckAMSUAclr
            channels: *amsua_n19_available_channels
            options:
              sensor: *Sensor_ID
              channels: *amsua_n19_available_channels
              test_biaspredictor: cloud_liquid_waterPredictor
          maxvalue: 0.0
          action:
            name: reject
      # Assign obs error
        - filter: Perform Action
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n19_available_channels
          action:
            name: assign error
            error parameter vector:
                        [2.500,  2.000,  2.000,  0.550,  0.300,
                               0.230,  0.230,  0.250,  0.250,  0.350,
                         0.400,  0.550,  0.800,  5.000,  2.500]
      # Topography check
#       - filter: BlackList
#         filter variables:
#         - name: brightnessTemperature
#           channels: *amsua_n19_available_channels
#         action:
#           name: inflate error
#           inflation variable:
#           name: ObsFunction/ObsErrorFactorTopoRad
#           channels: *amsua_n19_available_channels
#           options:
#             sensor: *Sensor_ID
#             channels: *amsua_n19_available_channels
      # Transmittance Top Check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n19_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *amsua_n19_available_channels
              options:
                channels: *amsua_n19_available_channels
      # Surface Jacobian check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n19_available_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorSurfJacobianRad
              channels: *amsua_n19_available_channels
              options:
                channels: *amsua_n19_available_channels
                sensor: *Sensor_ID
                use_biasterm: true
                test_biasterm: ObsBiasTerm
                obserr_demisf: [0.010, 0.020, 0.015, 0.020, 0.200]
                obserr_dtempf: [0.500, 2.000, 1.000, 2.000, 4.500]
      # Gross check
        - filter: Background Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n19_available_channels
          function absolute threshold:
          - name: ObsFunction/ObsErrorBoundMW
            channels: *amsua_n19_available_channels
            options:
              sensor: *Sensor_ID
              channels: *amsua_n19_available_channels
              obserr_bound_latitude:
                name: ObsFunction/ObsErrorFactorLatRad
                options:
                  latitude_parameters: [25.0, 0.25, 0.04, 3.0]
              obserr_bound_transmittop:
                name: ObsFunction/ObsErrorFactorTransmitTopRad
                channels: *amsua_n19_available_channels
                options:
                  channels: *amsua_n19_available_channels
              obserr_bound_topo:
                name: ObsFunction/ObsErrorFactorTopoRad
                channels: *amsua_n19_available_channels
                options:
                  channels: *amsua_n19_available_channels
                  sensor: *Sensor_ID
              error parameter vector:
                          [2.500,  2.000,  2.000,  0.550,  0.300,
                           0.230,  0.230,  0.250,  0.250,  0.350,
                           0.400,  0.550,  0.800,  5.000,  2.500]
              obserr_bound_max: [4.5, 4.5, 4.5, 2.5, 2.0,
                                 2.0, 2.0, 2.0, 2.0, 2.0,
                                 2.5, 3.5, 4.5, 4.5, 4.5]
          action:
            name: reject
      # Inter-channel check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n19_available_channels
          test variables:
          - name: ObsFunction/InterChannelConsistencyCheck
            channels: *amsua_n19_available_channels
            options:
              channels: *amsua_n19_available_channels
              use passive_bc: true
              sensor: *Sensor_ID
              use_flag: [-1, -1, -1,  1,  1,
                          1, -1, -1,  1,  1,
                          1,  1,  1,  1, -1]
          maxvalue: 1.0e-12
          action:
            name: reject
      #  Useflag check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *amsua_n19_available_channels
          test variables:
          - name: ObsFunction/ChannelUseflagCheckRad
            channels: *amsua_n19_available_channels
            options:
              channels: *amsua_n19_available_channels
#             use passive_bc: true
              use_flag: [-1, -1, -1,  1,  1,
                          1, -1, -1,  1,  1,
                          1,  1,  1,  1, -1]
          minvalue: 1.0e-12
          action:
            name: reject


####################################################
##  OBSYS-ON: ATMS-N20
####################################################
    - obs space:
        name: &Sensor_ID atms_n20
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/atms_n20.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/atms_n20.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &atms_n20_channels 1-22
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &atms_n20_satbias 'Data/obs/atms_n20.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/atms_n20.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variables without bc: [brightnessTemperature]
        channels: 15
        variational bc:
          predictors:
          - name: constant
          - name: cloud_liquid_water
            sensor: ATMS
            clwdif_ch238: 1
            clwdif_ch314: 2
          - name: lapse_rate
            order: 2
            tlapse: &atms_n20_tlapse 'Data/obs/atms_n20.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *atms_n20_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *atms_n20_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/atms_n20.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      # Assign GSI-style QC
#       - filter: PreQC
#         maxvalue: 4
      # Window and surface-sensitive channels check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: 1-7,16-22
          test variables:
          - name: ObsValue/brightnessTemperature
            channels: 1-7,16
          treat missing as out of bounds: true
          minvalue: 100.0
          maxvalue: 500.0
          flag all filter variables if any test variable is out of bounds: true
      # passedBenchmark: 1500
      # All channels unreasonable values check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *atms_n20_channels
          minvalue: 100.0
          maxvalue: 500.0
      #  Hydrometeor Check (cloud/precipitation affected chanels)
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *atms_n20_channels
          test variables:
          - name: ObsFunction/HydrometeorCheckAMSUAclr
            channels: *atms_n20_channels
            options:
              sensor: *Sensor_ID
              channels: *atms_n20_channels
              test_biaspredictor: cloud_liquid_waterPredictor
          maxvalue: 0.0
          action:
            name: reject
      # Assign obs error
        - filter: Perform Action
          filter variables:
          - name: brightnessTemperature
            channels: *atms_n20_channels
          action:
            name: assign error
            error parameter vector: 
                        [5.000,  5.000,  5.000,  3.000,  0.550,
                         0.300,  0.300,  0.300,  0.300,  0.300,
                         0.350,  0.400,  0.550,  0.800,  5.000,
                         5.000,  2.500,  2.500,  2.500,  2.500,
                         2.500,  2.500]
      # Topography check
#       - filter: BlackList
#         filter variables:
#         - name: brightnessTemperature
#           channels: *atms_n20_channels
#         action:
#           name: inflate error
#           inflation variable:
#           name: ObsFunction/ObsErrorFactorTopoRad
#           channels: *atms_n20_channels
#           options:
#             sensor: *Sensor_ID
#             channels: *atms_n20_channels
      # Transmittance Top Check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *atms_n20_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *atms_n20_channels
              options:
                channels: *atms_n20_channels
      # Surface Jacobian check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *atms_n20_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorSurfJacobianRad
              channels: *atms_n20_channels
              options:
                channels: *atms_n20_channels
                use_biasterm: true
                test_biasterm: ObsBiasTerm
                sensor: *Sensor_ID
                obserr_demisf: [0.010, 0.020, 0.015, 0.020, 0.200]
                obserr_dtempf: [0.500, 2.000, 1.000, 2.000, 4.500]
      # Gross check
        - filter: Background Check
          filter variables:
          - name: brightnessTemperature
            channels: *atms_n20_channels
          function absolute threshold:
          - name: ObsFunction/ObsErrorBoundMW
            channels: *atms_n20_channels
            options:
              sensor: *Sensor_ID
              channels: *atms_n20_channels
              obserr_bound_latitude:
                name: ObsFunction/ObsErrorFactorLatRad
                options:
                  latitude_parameters: [25.0, 0.25, 0.04, 3.0]
              obserr_bound_transmittop:
                name: ObsFunction/ObsErrorFactorTransmitTopRad
                channels: *atms_n20_channels
                options:
                  channels: *atms_n20_channels
              obserr_bound_topo:
                name: ObsFunction/ObsErrorFactorTopoRad
                channels: *atms_n20_channels
                options:
                  channels: *atms_n20_channels
                  sensor: *Sensor_ID
              error parameter vector:
                        [5.000,  5.000,  5.000,  3.000,  0.550,
                         0.300,  0.300,  0.300,  0.300,  0.300,
                         0.350,  0.400,  0.550,  0.800,  5.000,
                         5.000,  2.500,  2.500,  2.500,  2.500,
                         2.500,  2.500]
              obserr_bound_max: [4.5, 4.5, 3.0, 3.0, 1.0,
                                 1.0, 1.0, 1.0, 1.0, 1.0,
                                 1.0, 1.0, 1.0, 2.0, 4.5,
                                 4.5, 2.0, 2.0, 2.0, 2.0,
                                 2.0, 2.0]
          action:
            name: reject
      # Inter-channel check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *atms_n20_channels
          test variables:
          - name: ObsFunction/InterChannelConsistencyCheck
            channels: *atms_n20_channels
            options:
              channels: *atms_n20_channels
              use passive_bc: true
              sensor: *Sensor_ID
              use_flag: &use_flag_atms_n20 [-1, -1, -1, -1,  1,
                                             1,  1,  1,  1,  1,
                                             1,  1,  1,  1,  1,
                                            -1,  1,  1,  1,  1,
                                             1,  1]
          maxvalue: 1.0e-12
          action:
            name: reject
      #  Useflag check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *atms_n20_channels
          test variables:
          - name: ObsFunction/ChannelUseflagCheckRad
            channels: *atms_n20_channels
            options:
              channels: *atms_n20_channels
#             use passive_bc: true
              use_flag: *use_flag_atms_n20
          minvalue: 1.0e-12
          action:
            name: reject

####################################################
##  OBSYS-ON: ATMS-NPP
####################################################
    - obs space:
        name: &Sensor_ID atms_npp
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/atms_npp.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/atms_npp.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &atms_npp_channels 1-22
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &atms_npp_satbias 'Data/obs/atms_npp.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/atms_npp.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variables without bc: [brightnessTemperature]
        channels: 15
        variational bc:
          predictors:
          - name: constant
          - name: cloud_liquid_water
            sensor: ATMS
            clwdif_ch238: 1
            clwdif_ch314: 2
          - name: lapse_rate
            order: 2
            tlapse: &atms_npp_tlapse 'Data/obs/atms_npp.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *atms_npp_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *atms_npp_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/atms_npp.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      # Assign GSI-style QC
#       - filter: PreQC
#         maxvalue: 4
      # Window and surface-sensitive channels check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: 1-7,16-22
          test variables:
          - name: ObsValue/brightnessTemperature
            channels: 1-7,16
          treat missing as out of bounds: true
          minvalue: 100.0
          maxvalue: 500.0
          flag all filter variables if any test variable is out of bounds: true
      # passedBenchmark: 1500
      # All channels unreasonable values check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *atms_npp_channels
          minvalue: 100.0
          maxvalue: 500.0
      #  Hydrometeor Check (cloud/precipitation affected chanels)
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *atms_npp_channels
          test variables:
          - name: ObsFunction/HydrometeorCheckAMSUAclr
            channels: *atms_npp_channels
            options:
              sensor: *Sensor_ID
              channels: *atms_npp_channels
              test_biaspredictor: cloud_liquid_waterPredictor
          maxvalue: 0.0
          action:
            name: reject
      # Assign obs error
        - filter: Perform Action
          filter variables:
          - name: brightnessTemperature
            channels: *atms_npp_channels
          action:
            name: assign error
            error parameter vector: 
                        [5.000,  5.000,  5.000,  3.000,  0.550,
                         0.300,  0.300,  0.300,  0.300,  0.300,
                         0.350,  0.400,  0.550,  0.800,  5.000,
                         5.000,  2.500,  2.500,  2.500,  2.500,
                         2.500,  2.500]
      # Topography check
#       - filter: BlackList
#         filter variables:
#         - name: brightnessTemperature
#           channels: *atms_npp_channels
#         action:
#           name: inflate error
#           inflation variable:
#           name: ObsFunction/ObsErrorFactorTopoRad
#           channels: *atms_npp_channels
#           options:
#             sensor: *Sensor_ID
#             channels: *atms_npp_channels
      # Transmittance Top Check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *atms_npp_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *atms_npp_channels
              options:
                channels: *atms_npp_channels
      # Surface Jacobian check
        - filter: BlackList
          filter variables:
          - name: brightnessTemperature
            channels: *atms_npp_channels
          action:
            name: inflate error
            inflation variable:
              name: ObsFunction/ObsErrorFactorSurfJacobianRad
              channels: *atms_npp_channels
              options:
                channels: *atms_npp_channels
                use_biasterm: true
                test_biasterm: ObsBiasTerm
                sensor: *Sensor_ID
                obserr_demisf: [0.010, 0.020, 0.015, 0.020, 0.200]
                obserr_dtempf: [0.500, 2.000, 1.000, 2.000, 4.500]
      # Gross check
        - filter: Background Check
          filter variables:
          - name: brightnessTemperature
            channels: *atms_npp_channels
          function absolute threshold:
          - name: ObsFunction/ObsErrorBoundMW
            channels: *atms_npp_channels
            options:
              sensor: *Sensor_ID
              channels: *atms_npp_channels
              obserr_bound_latitude:
                name: ObsFunction/ObsErrorFactorLatRad
                options:
                  latitude_parameters: [25.0, 0.25, 0.04, 3.0]
              obserr_bound_transmittop:
                name: ObsFunction/ObsErrorFactorTransmitTopRad
                channels: *atms_npp_channels
                options:
                  channels: *atms_npp_channels
              obserr_bound_topo:
                name: ObsFunction/ObsErrorFactorTopoRad
                channels: *atms_npp_channels
                options:
                  channels: *atms_npp_channels
                  sensor: *Sensor_ID
              error parameter vector:
                        [5.000,  5.000,  5.000,  3.000,  0.550,
                         0.300,  0.300,  0.300,  0.300,  0.300,
                         0.350,  0.400,  0.550,  0.800,  5.000,
                         5.000,  2.500,  2.500,  2.500,  2.500,
                         2.500,  2.500]
              obserr_bound_max: [4.5, 4.5, 3.0, 3.0, 1.0,
                                 1.0, 1.0, 1.0, 1.0, 1.0,
                                 1.0, 1.0, 1.0, 2.0, 4.5,
                                 4.5, 2.0, 2.0, 2.0, 2.0,
                                 2.0, 2.0]
          action:
            name: reject
      # Inter-channel check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *atms_npp_channels
          test variables:
          - name: ObsFunction/InterChannelConsistencyCheck
            channels: *atms_npp_channels
            options:
              channels: *atms_npp_channels
              use passive_bc: true
              sensor: *Sensor_ID
              use_flag: &use_flag_atms_npp [-1, -1, -1, -1,  1,
                                             1,  1,  1,  1,  1,
                                             1,  1,  1,  1,  1,
                                            -1,  1,  1,  1,  1,
                                             1,  1]
          maxvalue: 1.0e-12
          action:
            name: reject
      #  Useflag check
        - filter: Bounds Check
          filter variables:
          - name: brightnessTemperature
            channels: *atms_npp_channels
          test variables:
          - name: ObsFunction/ChannelUseflagCheckRad
            channels: *atms_npp_channels
            options:
              channels: *atms_npp_channels
#             use passive_bc: true
              use_flag: *use_flag_atms_npp
          minvalue: 1.0e-12
          action:
            name: reject

####################################################
##  OBSYS-ON: AVHRR-Metop-B
####################################################
    - obs space:
        name: &Sensor_ID avhrr3_metop-b
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/avhrr3_metop-b.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/avhrr3_metop-b.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &avhrr3_metop-b_channels 3,4,5
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &avhrr3_metop-b_satbias Data/obs/avhrr3_metop-b.$PYYYYYMMDDTHH0000Z.satbias.nc4
        output file: Data/vbc/avhrr3_metop-b.$PYYYYYMMDDTHH0000Z.satbias.nc4
        variational bc:
          predictors:
          - name: constant
          - name: lapse_rate
            order: 2
            tlapse: &avhrr3_metop-b_tlapse Data/obs/avhrr3_metop-b.$PYYYYYMMDDTHH0000Z.tlapse.txt
          - name: lapse_rate
            tlapse: *avhrr3_metop-b_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *avhrr3_metop-b_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/avhrr3_metop-b.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      - filter: Perform Action
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_metop-b_channels
        action:
          name: assign error
          error parameter vector: [ 0.6, 0.68, 0.72 ]
      # assign ObsError <---- ObsErrorData (Assigned in Yaml)
      - filter: Variable Assignment
        assignments:
        - name: ObsError/brightnessTemperature
          channels: *avhrr3_metop-b_channels
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature
                channels: *avhrr3_metop-b_channels
      #  Wavenumber Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: 3
        where:
        - variable:
            name: MetaData/solarZenithAngle
          maxvalue: 88.9999
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 1.0e-12
        action:
          name: reject
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_metop-b_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorWavenumIR
            channels: *avhrr3_metop-b_channels
            options:
              channels: *avhrr3_metop-b_channels
      # Observation Range Sanity Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_metop-b_channels
        minvalue: 0.00001
        maxvalue: 1000.0
        action:
          name: reject
      #  Topography Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_metop-b_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTopoRad
            channels: *avhrr3_metop-b_channels
            options:
              channels: *avhrr3_metop-b_channels
              sensor: *Sensor_ID
      #  Transmittance Top Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_metop-b_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTransmitTopRad
            channels: *avhrr3_metop-b_channels
            options:
              channels: *avhrr3_metop-b_channels
      #  Cloud Detection Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_metop-b_channels
        test variables:
        - name: ObsFunction/CloudDetectMinResidualAVHRR
          channels: *avhrr3_metop-b_channels
          options:
            channels: *avhrr3_metop-b_channels
            use_flag: &avhrr3_metop-b_useflag [ -1,  1,  1 ]
            use_flag_clddet: [ 1,  1,  1 ]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
      #  NSST Retrieval Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_metop-b_channels
        test variables:
        - name: ObsFunction/NearSSTRetCheckIR
          channels: *avhrr3_metop-b_channels
          options:
            channels: *avhrr3_metop-b_channels
            use_flag: *avhrr3_metop-b_useflag
            obserr_demisf: [0.01,0.02,0.03,0.02,0.03]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
      #  Surface Jacobians Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_metop-b_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorSurfJacobianRad
            channels: *avhrr3_metop-b_channels
            options:
              channels: *avhrr3_metop-b_channels
              sensor: *Sensor_ID
              obserr_demisf: [0.01, 0.02, 0.03, 0.02, 0.03]
              obserr_dtempf: [0.50, 2.00, 4.00, 2.00, 4.00]
      #  Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_metop-b_channels
        function absolute threshold:
        - name: ObsFunction/ObsErrorBoundIR
          channels: *avhrr3_metop-b_channels
          options:
            channels: *avhrr3_metop-b_channels
            obserr_bound_latitude:
              name: ObsFunction/ObsErrorFactorLatRad
              options:
                latitude_parameters: [25.0, 0.5, 0.04, 1.0]
            obserr_bound_transmittop:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *avhrr3_metop-b_channels
              options:
                channels: *avhrr3_metop-b_channels
            obserr_bound_max: [ 3.0, 3.0, 3.0 ]
        action:
          name: reject
      #  Useflag Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_metop-b_channels
        test variables:
        - name: ObsFunction/ChannelUseflagCheckRad
          channels: *avhrr3_metop-b_channels
          options:
            channels: *avhrr3_metop-b_channels
            use_flag: *avhrr3_metop-b_useflag
        minvalue: 1.0e-12
        action:
          name: reject

####################################################
##  OBSYS-ON: AVHRR-N18
####################################################
    - obs space:
        name: &Sensor_ID avhrr3_n18
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/avhrr3_n18.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/avhrr3_n18.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &avhrr3_n18_channels 3,4,5
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &avhrr3_n18_satbias Data/obs/avhrr3_n18.$PYYYYYMMDDTHH0000Z.satbias.nc4
        output file: Data/vbc/avhrr3_n18.$PYYYYYMMDDTHH0000Z.satbias.nc4
        variational bc:
          predictors:
          - name: constant
          - name: lapse_rate
            order: 2
            tlapse: &avhrr3_n18_tlapse Data/obs/avhrr3_n18.$PYYYYYMMDDTHH0000Z.tlapse.txt
          - name: lapse_rate
            tlapse: *avhrr3_n18_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *avhrr3_n18_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/avhrr3_n18.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      - filter: Perform Action
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n18_channels
        action:
          name: assign error
          error parameter vector: [ 0.6, 0.68, 0.72 ]
      # assign ObsError <---- ObsErrorData (Assigned in Yaml)
      - filter: Variable Assignment
        assignments:
        - name: ObsError/brightnessTemperature
          channels: *avhrr3_n18_channels
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature
                channels: *avhrr3_n18_channels
      #  Wavenumber Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: 3
        where:
        - variable:
            name: MetaData/solarZenithAngle
          maxvalue: 88.9999
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 1.0e-12
        action:
          name: reject
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n18_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorWavenumIR
            channels: *avhrr3_n18_channels
            options:
              channels: *avhrr3_n18_channels
      # Observation Range Sanity Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n18_channels
        minvalue: 0.00001
        maxvalue: 1000.0
        action:
          name: reject
      #  Topography Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n18_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTopoRad
            channels: *avhrr3_n18_channels
            options:
              channels: *avhrr3_n18_channels
              sensor: *Sensor_ID
      #  Transmittance Top Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n18_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTransmitTopRad
            channels: *avhrr3_n18_channels
            options:
              channels: *avhrr3_n18_channels
      #  Cloud Detection Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n18_channels
        test variables:
        - name: ObsFunction/CloudDetectMinResidualAVHRR
          channels: *avhrr3_n18_channels
          options:
            channels: *avhrr3_n18_channels
            use_flag: &avhrr3_n18_useflag [ -1,  1,  1 ]
            use_flag_clddet: [ 1,  1,  1 ]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
      #  NSST Retrieval Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n18_channels
        test variables:
        - name: ObsFunction/NearSSTRetCheckIR
          channels: *avhrr3_n18_channels
          options:
            channels: *avhrr3_n18_channels
            use_flag: *avhrr3_n18_useflag
            obserr_demisf: [0.01,0.02,0.03,0.02,0.03]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
      #  Surface Jacobians Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n18_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorSurfJacobianRad
            channels: *avhrr3_n18_channels
            options:
              channels: *avhrr3_n18_channels
              sensor: *Sensor_ID
              obserr_demisf: [0.01, 0.02, 0.03, 0.02, 0.03]
              obserr_dtempf: [0.50, 2.00, 4.00, 2.00, 4.00]
      #  Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n18_channels
        function absolute threshold:
        - name: ObsFunction/ObsErrorBoundIR
          channels: *avhrr3_n18_channels
          options:
            channels: *avhrr3_n18_channels
            obserr_bound_latitude:
              name: ObsFunction/ObsErrorFactorLatRad
              options:
                latitude_parameters: [25.0, 0.5, 0.04, 1.0]
            obserr_bound_transmittop:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *avhrr3_n18_channels
              options:
                channels: *avhrr3_n18_channels
            obserr_bound_max: [ 3.0, 3.0, 3.0 ]
        action:
          name: reject
      #  Useflag Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n18_channels
        test variables:
        - name: ObsFunction/ChannelUseflagCheckRad
          channels: *avhrr3_n18_channels
          options:
            channels: *avhrr3_n18_channels
            use_flag: *avhrr3_n18_useflag
        minvalue: 1.0e-12
        action:
          name: reject

####################################################
##  OBSYS-ON: AVHRR-N19
####################################################
    - obs space:
        name: &Sensor_ID avhrr3_n19
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/avhrr3_n19.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/avhrr3_n19.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &avhrr3_n19_channels 3,4,5
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &avhrr3_n19_satbias Data/obs/avhrr3_n19.$PYYYYYMMDDTHH0000Z.satbias.nc4
        output file: Data/vbc/avhrr3_n19.$PYYYYYMMDDTHH0000Z.satbias.nc4
        variational bc:
          predictors:
          - name: constant
          - name: lapse_rate
            order: 2
            tlapse: &avhrr3_n19_tlapse Data/obs/avhrr3_n19.$PYYYYYMMDDTHH0000Z.tlapse.txt
          - name: lapse_rate
            tlapse: *avhrr3_n19_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *avhrr3_n19_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/avhrr3_n19.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      - filter: Perform Action
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n19_channels
        action:
          name: assign error
          error parameter vector: [ 0.6, 0.68, 0.72 ]
      # assign ObsError <---- ObsErrorData (Assigned in Yaml)
      - filter: Variable Assignment
        assignments:
        - name: ObsError/brightnessTemperature
          channels: *avhrr3_n19_channels
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature
                channels: *avhrr3_n19_channels
      #  Wavenumber Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: 3
        where:
        - variable:
            name: MetaData/solarZenithAngle
          maxvalue: 88.9999
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 1.0e-12
        action:
          name: reject
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n19_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorWavenumIR
            channels: *avhrr3_n19_channels
            options:
              channels: *avhrr3_n19_channels
      # Observation Range Sanity Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n19_channels
        minvalue: 0.00001
        maxvalue: 1000.0
        action:
          name: reject
      #  Topography Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n19_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTopoRad
            channels: *avhrr3_n19_channels
            options:
              channels: *avhrr3_n19_channels
              sensor: *Sensor_ID
      #  Transmittance Top Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n19_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTransmitTopRad
            channels: *avhrr3_n19_channels
            options:
              channels: *avhrr3_n19_channels
      #  Cloud Detection Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n19_channels
        test variables:
        - name: ObsFunction/CloudDetectMinResidualAVHRR
          channels: *avhrr3_n19_channels
          options:
            channels: *avhrr3_n19_channels
            use_flag: &avhrr3_n19_useflag [ -1,  1,  1 ]
            use_flag_clddet: [ 1,  1,  1 ]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
      #  NSST Retrieval Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n19_channels
        test variables:
        - name: ObsFunction/NearSSTRetCheckIR
          channels: *avhrr3_n19_channels
          options:
            channels: *avhrr3_n19_channels
            use_flag: *avhrr3_n19_useflag
            obserr_demisf: [0.01,0.02,0.03,0.02,0.03]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
      #  Surface Jacobians Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n19_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorSurfJacobianRad
            channels: *avhrr3_n19_channels
            options:
              channels: *avhrr3_n19_channels
              sensor: *Sensor_ID
              obserr_demisf: [0.01, 0.02, 0.03, 0.02, 0.03]
              obserr_dtempf: [0.50, 2.00, 4.00, 2.00, 4.00]
      #  Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n19_channels
        function absolute threshold:
        - name: ObsFunction/ObsErrorBoundIR
          channels: *avhrr3_n19_channels
          options:
            channels: *avhrr3_n19_channels
            obserr_bound_latitude:
              name: ObsFunction/ObsErrorFactorLatRad
              options:
                latitude_parameters: [25.0, 0.5, 0.04, 1.0]
            obserr_bound_transmittop:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *avhrr3_n19_channels
              options:
                channels: *avhrr3_n19_channels
            obserr_bound_max: [ 3.0, 3.0, 3.0 ]
        action:
          name: reject
      #  Useflag Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *avhrr3_n19_channels
        test variables:
        - name: ObsFunction/ChannelUseflagCheckRad
          channels: *avhrr3_n19_channels
          options:
            channels: *avhrr3_n19_channels
            use_flag: *avhrr3_n19_useflag
        minvalue: 1.0e-12
        action:
          name: reject

 
####################################################
##  OBSYS-ON: CrIS-FSR-N20
####################################################
    - obs space:
        name: &Sensor_ID cris-fsr_n20
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/cris-fsr_n20.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/cris-fsr_n20.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &all_channels 19, 24, 26, 27, 28, 31, 32, 33, 37, 39, 42, 44, 47, 49, 50,
                                51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68,
                                69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86,
                                87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103,
                                104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117,
                                118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131,
                                132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145,
                                146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
                                160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173,
                                174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187,
                                188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 208,
                                211, 216, 224, 234, 236, 238, 239, 242, 246, 248, 255, 264, 266, 268,
                                275, 279, 283, 285, 291, 295, 301, 305, 311, 332, 342, 389, 400, 402,
                                404, 406, 410, 427, 439, 440, 441, 445, 449, 455, 458, 461, 464, 467,
                                470, 473, 475, 482, 486, 487, 490, 493, 496, 499, 501, 503, 505, 511,
                                513, 514, 518, 519, 520, 522, 529, 534, 563, 568, 575, 592, 594, 596,
                                598, 600, 602, 604, 611, 614, 616, 618, 620, 622, 626, 631, 638, 646,
                                648, 652, 659, 673, 675, 678, 684, 688, 694, 700, 707, 710, 713, 714,
                                718, 720, 722, 725, 728, 735, 742, 748, 753, 762, 780, 784, 798, 849,
                                860, 862, 866, 874, 882, 890, 898, 906, 907, 908, 914, 937, 972, 973,
                                978, 980, 981, 988, 995, 998, 1000, 1003, 1008, 1009, 1010, 1014, 1017,
                                1018, 1020, 1022, 1024, 1026, 1029, 1030, 1032, 1034, 1037, 1038, 1041,
                                1042, 1044, 1046, 1049, 1050, 1053, 1054, 1058, 1060, 1062, 1064, 1066,
                                1069, 1076, 1077, 1080, 1086, 1091, 1095, 1101, 1109, 1112, 1121, 1128,
                                1133, 1163, 1172, 1187, 1189, 1205, 1211, 1219, 1231, 1245, 1271, 1289,
                                1300, 1313, 1316, 1325, 1329, 1346, 1347, 1473, 1474, 1491, 1499, 1553,
                                1570, 1596, 1602, 1619, 1624, 1635, 1939, 1940, 1941, 1942, 1943, 1944,
                                1945, 1946, 1947, 1948, 1949, 1950, 1951, 1952, 1953, 1954, 1955, 1956,
                                1957, 1958, 1959, 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968,
                                1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980,
                                1981, 1982, 1983, 1984, 1985, 1986, 1987, 2119, 2140, 2143, 2147, 2153,
                                2158, 2161, 2168, 2171, 2175, 2182
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
    #     Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
    #    SurfaceWindGeoVars: uv
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
    # geovals:
    #   filename: Data/ufo/testinput_tier_1/instruments/radiance/cris-fsr_n20_geoval_2021121200.nc4
      obs bias:
        input file: &cris-fsr_n20_satbias Data/obs/cris-fsr_n20.$PYYYYYMMDDTHH0000Z.satbias.nc4
        output file: Data/vbc/cris-fsr_n20.$PYYYYYMMDDTHH0000Z.satbias.nc4
        variational bc:
          predictors:
          - name: constant
          - name: lapse_rate
            order: 2
            tlapse: &cris-fsr_n20tlap Data/obs/cris-fsr_n20.$PYYYYYMMDDTHH0000Z.tlapse.txt
          - name: lapse_rate
            tlapse: *cris-fsr_n20tlap
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *cris-fsr_n20_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/cris-fsr_n20.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      - filter: Perform Action
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        action:
          name: assign error
          error parameter vector: [ 0.8230, 0.7600, 0.7360, 0.7430, 0.8560, 1.0790, 0.8880, 0.7780, 0.6710, 0.6500,
                                    0.6430, 0.6290, 0.6290, 0.6180, 0.6380, 0.6190, 0.6100, 0.6270, 0.6010, 0.6170,
                                    0.6080, 0.4980, 0.5112, 0.4922, 0.4959, 0.4954, 0.4836, 0.5140, 0.5005, 0.4917,
                                    0.4881, 0.4656, 0.4793, 0.4638, 0.4557, 0.4666, 0.4468, 0.4534, 0.4471, 0.4448,
                                    0.4469, 0.5360, 0.4426, 0.4388, 0.5340, 0.4368, 0.4380, 0.5310, 0.4379, 0.5350,
                                    0.4404, 0.4405, 0.4409, 0.4472, 0.4555, 0.4433, 0.4437, 0.4454, 0.4448, 0.4465,
                                    0.4499, 0.4488, 0.5400, 0.4534, 0.4472, 0.4550, 0.4562, 0.4520, 0.4639, 0.5380,
                                    0.4573, 0.4604, 0.4533, 0.4692, 0.5660, 0.4457, 0.4457, 0.5154, 0.5084, 0.5280,
                                    0.5520, 0.5600, 0.5670, 0.5460, 0.4950, 0.4809, 0.4732, 0.4861, 0.4632, 0.5290,
                                    0.4748, 0.5007, 0.5711, 0.5950, 0.5469, 0.6260, 0.5410, 0.5430, 0.5330, 0.5410,
                                    0.4695, 0.5300, 0.5390, 0.5290, 0.5420, 0.4681, 0.5360, 0.5420, 0.5350, 0.5630,
                                    0.4805, 0.6470, 0.6090, 0.5530, 0.5830, 0.5760, 0.6294, 0.5885, 0.5560, 0.5780,
                                    0.5660, 0.6010, 0.5627, 0.5675, 0.5920, 0.5166, 0.5890, 0.5291, 0.5892, 0.5976,
                                    0.5834, 0.6512, 0.6748, 0.6615, 0.6003, 0.5669, 0.5587, 0.5507, 0.5871, 0.6160,
                                    0.6370, 0.6330, 0.6390, 0.6550, 0.6410, 0.6640, 0.6480, 0.6560, 0.6630, 0.6520,
                                    0.6810, 0.6620, 0.6730, 0.6720, 0.6800, 0.7350, 0.7320, 0.7150, 0.6740, 0.6870,
                                    0.7020, 0.7050, 0.7150, 0.7250, 0.7070, 0.7400, 0.7400, 0.8740, 0.7370, 0.8190,
                                    0.7600, 0.8690, 0.9000, 0.6980, 0.8230, 0.6760, 0.6820, 0.7660, 0.6800, 0.6850,
                                    0.6940, 0.6950, 0.6890, 0.7270, 0.6950, 0.6880, 0.6770, 0.7360, 0.6510, 0.6610,
                                    0.6199, 0.6223, 0.6036, 0.6003, 0.5991, 0.5980, 0.5910, 0.5764, 0.5770, 0.5593,
                                    0.5970, 0.5760, 0.5740, 0.5780, 0.5790, 0.5750, 0.5760, 0.5680, 0.5750, 0.5690,
                                    0.5590, 0.5680, 0.5401, 0.5500, 0.5575, 0.5780, 0.5635, 0.5786, 0.5807, 0.5810,
                                    0.5730, 0.5690, 0.5670, 0.5520, 0.5500, 0.5580, 0.5520, 0.5620, 0.5740, 0.5750,
                                    0.6290, 0.6820, 0.7560, 1.0500, 1.1220, 1.1402, 1.1540, 1.1310, 1.1230, 1.1590,
                                    1.1060, 1.1160, 1.0690, 1.0770, 1.1550, 1.1620, 1.1402, 0.6440, 1.2080, 1.1402,
                                    1.2950, 1.2580, 1.1402, 0.6060, 0.6030, 0.5630, 0.5920, 0.6070, 0.6110, 0.6120,
                                    0.6180, 0.6260, 0.6290, 0.5830, 0.8646, 0.6260, 0.6390, 0.5590, 0.8270, 0.6120,
                                    0.5760, 0.5800, 0.5750, 0.6880, 0.6970, 0.7430, 0.6810, 0.8320, 0.7190, 0.7850,
                                    0.8780, 0.9402, 1.0054, 1.0730, 1.1290, 1.0350, 1.0270, 0.9703, 1.1950, 0.9153,
                                    1.2660, 1.1530, 1.3480, 1.1800, 1.2690, 1.3110, 0.9914, 1.3590, 1.1660, 1.1390,
                                    1.2817, 1.3980, 1.5420, 1.2290, 1.3770, 1.2800, 1.2450, 1.1188, 1.1930, 1.2930,
                                    1.2750, 1.3310, 1.3400, 1.0990, 1.0480, 1.1240, 1.2250, 1.1830, 1.1960, 1.4000,
                                    1.3330, 1.4170, 1.3260, 1.3050, 1.0638, 1.2680, 1.2170, 1.2890, 1.3950, 1.2320,
                                    1.4350, 1.2980, 1.3280, 1.2620, 1.1990, 1.3910, 1.2330, 1.3290, 1.6640, 1.5090,
                                    1.3490, 1.4810, 1.5950, 1.4850, 1.5320, 1.5040, 1.5840, 1.6090, 1.5160, 1.4890,
                                    1.5020, 1.5440, 1.6110, 1.5390, 1.2960, 1.2880, 1.2410, 1.3200, 1.3130, 1.3010,
                                    1.8430, 1.7470, 1.7110, 1.7710, 1.9370, 1.5750, 1.5730, 1.5000, 1.4590, 1.4020,
                                    1.3630, 2.2010, 2.1270, 2.1770, 2.1570, 2.1920, 2.1460, 2.1510, 2.0710, 1.9860,
                                    1.8450, 1.6870, 1.5050, 1.3730, 1.2290, 1.1130, 1.0040, 0.9360, 0.8950, 0.8710,
                                    0.8410, 0.8210, 0.8050, 0.8000, 0.7920, 0.7970, 0.7910, 0.7830, 0.7770, 0.7850,
                                    0.7870, 0.7890, 0.7930, 0.7940, 0.7450, 0.7500, 0.7480, 0.7490, 0.7440, 0.7330,
                                    0.7330, 0.7410, 0.7460, 0.7460, 0.7380, 0.7430, 0.7450, 0.7490, 0.7500, 0.7500,
                                    0.8840, 0.9060, 0.9170, 0.9240, 0.9220, 0.9280, 0.9210, 0.9380, 0.9310, 0.9430,
                                    0.9460 ]
      # assign ObsError <---- ObsErrorData (Assigned in Yaml)
      - filter: Variable Assignment
        assignments:
        - name: ObsError/brightnessTemperature
          channels: *all_channels
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature
                channels: *all_channels
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: 1972, 1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981,
                    1982, 1983, 1984, 1985, 1986, 1987, 2119, 2140, 2143, 2147,
                    2153, 2158, 2161, 2168, 2171, 2175, 2182
        where:
        - variable:
            name: solarZenithAngle@MetaData
          maxvalue: 88.9999
        - variable:
            name: water_area_fraction@GeoVaLs
          minvalue: 1.0e-12
        action:
          name: reject
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorWavenumIR@ObsFunction
            channels: *all_channels
            options:
              channels: *all_channels
    #  Observation Range Sanity Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        minvalue: 50.00001
        maxvalue: 549.99999
        action:
          name: reject
    #  Topography Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorTopoRad@ObsFunction
            channels: *all_channels
            options:
              channels: *all_channels
              sensor: *Sensor_ID
    #  Transmittance Top Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorTransmitTopRad@ObsFunction
            channels: *all_channels
            options:
              channels: *all_channels
    #  Cloud Detection Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        test variables:
        - name: CloudDetectMinResidualIR@ObsFunction
          channels: *all_channels
          options:
            channels: *all_channels
            use_flag: &useflag [ -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
                                  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
                                  1, -1,  1,  1, -1,  1,  1, -1,  1, -1,
                                  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
                                  1,  1, -1,  1,  1,  1,  1,  1,  1, -1,
                                  1,  1,  1,  1, -1,  1,  1,  1,  1, -1,
                                 -1, -1, -1, -1,  1,  1,  1,  1,  1, -1,
                                  1,  1,  1, -1,  1, -1, -1, -1, -1, -1,
                                  1, -1, -1, -1, -1,  1, -1, -1, -1, -1,
                                  1, -1, -1, -1, -1, -1,  1,  1, -1, -1,
                                 -1, -1,  1,  1, -1,  1, -1,  1,  1,  1,
                                  1,  1,  1,  1,  1,  1,  1,  1,  1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                  1,  1,  1,  1,  1,  1,  1,  1, -1,  1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1,  1,  1,  1, -1,  1,  1,  1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1,  1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1,  1, -1, -1,  1,
                                 -1, -1,  1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1,  1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1,  1,  1, -1, -1, -1, -1, -1, -1,  1,
                                 -1, -1, -1, -1, -1, -1,  1, -1, -1, -1,
                                  1, -1, -1, -1, -1, -1, -1,  1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1,  1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1]
            use_flag_clddet: &clddet [ 31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 30,
                                       30, 30, 31, 31, 30, 31, 30, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       31, 31, 31, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 31, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 31, 30, 30, 31,
                                       30, 30, 31, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 31, 30, 30, 30, 30, 30, 30, 31,
                                       30, 30, 30, 30, 30, 30, 31, 30, 30, 30,
                                       31, 30, 30, 30, 30, 30, 30, 31, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 31, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30 ]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
    # Surface Temperature Jacobian Check over Land
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        where:
        - variable:
            name: water_area_fraction@GeoVaLs
          maxvalue: 0.99
        test variables:
        - name: brightness_temperature_jacobian_surface_temperature@ObsDiag
          channels: *all_channels
        maxvalue: 0.2
    #  NSST Retrieval Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        test variables:
        - name: NearSSTRetCheckIR@ObsFunction
          channels: *all_channels
          options:
            channels: *all_channels
            use_flag: *useflag
            obserr_demisf: [0.01,0.02,0.03,0.02,0.03]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
    #  Surface Jacobians Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorSurfJacobianRad@ObsFunction
            channels: *all_channels
            options:
              channels: *all_channels
              sensor: *Sensor_ID
              obserr_demisf: [0.01, 0.02, 0.03, 0.02, 0.03]
              obserr_dtempf: [0.50, 2.00, 4.00, 2.00, 4.00]
    #  Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        function absolute threshold:
        - name: ObsErrorBoundIR@ObsFunction
          channels: *all_channels
          options:
            channels: *all_channels
            obserr_bound_latitude:
              name: ObsErrorFactorLatRad@ObsFunction
              options:
                latitude_parameters: [25.0, 0.5, 0.04, 1.0]
            obserr_bound_transmittop:
              name: ObsErrorFactorTransmitTopRad@ObsFunction
              channels: *all_channels
              options:
                channels: *all_channels
            obserr_bound_max: [ 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
                                0.4, 2.0, 0.4, 0.4, 2.0, 0.4, 0.4, 2.0, 0.4, 2.0,
                                0.4, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 0.4, 0.4, 0.4, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 1.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 1.0, 2.0, 2.0, 1.0,
                                2.0, 2.0, 1.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0 ]
        action:
          name: reject
    #  Surface Type Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        test variables:
        - name: SurfTypeCheckRad@ObsFunction
          channels: *all_channels
          options:
            channels: *all_channels
            use_flag: *useflag
            use_flag_clddet: *clddet
        maxvalue: 1.0e-12
        defer to post: true
        action:
          name: reject
    #  Useflag Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        test variables:
        - name: ChannelUseflagCheckRad@ObsFunction
          channels: *all_channels
          options:
            channels: *all_channels
            use_flag: *useflag
        minvalue: 1.0e-12
        action:
          name: reject
#     passedBenchmark: 402   #(m_unittest)
 

####################################################
##  OBSYS-ON: CrIS-FSR-NPP
####################################################
    - obs space:
        name: &Sensor_ID cris-fsr_npp
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/cris-fsr_npp.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/cris-fsr_npp.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &all_channels 19, 24, 26, 27, 28, 31, 32, 33, 37, 39, 42, 44, 47, 49, 50,
                                51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68,
                                69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86,
                                87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103,
                                104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117,
                                118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131,
                                132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145,
                                146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
                                160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173,
                                174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187,
                                188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 208,
                                211, 216, 224, 234, 236, 238, 239, 242, 246, 248, 255, 264, 266, 268,
                                275, 279, 283, 285, 291, 295, 301, 305, 311, 332, 342, 389, 400, 402,
                                404, 406, 410, 427, 439, 440, 441, 445, 449, 455, 458, 461, 464, 467,
                                470, 473, 475, 482, 486, 487, 490, 493, 496, 499, 501, 503, 505, 511,
                                513, 514, 518, 519, 520, 522, 529, 534, 563, 568, 575, 592, 594, 596,
                                598, 600, 602, 604, 611, 614, 616, 618, 620, 622, 626, 631, 638, 646,
                                648, 652, 659, 673, 675, 678, 684, 688, 694, 700, 707, 710, 713, 714,
                                718, 720, 722, 725, 728, 735, 742, 748, 753, 762, 780, 784, 798, 849,
                                860, 862, 866, 874, 882, 890, 898, 906, 907, 908, 914, 937, 972, 973,
                                978, 980, 981, 988, 995, 998, 1000, 1003, 1008, 1009, 1010, 1014, 1017,
                                1018, 1020, 1022, 1024, 1026, 1029, 1030, 1032, 1034, 1037, 1038, 1041,
                                1042, 1044, 1046, 1049, 1050, 1053, 1054, 1058, 1060, 1062, 1064, 1066,
                                1069, 1076, 1077, 1080, 1086, 1091, 1095, 1101, 1109, 1112, 1121, 1128,
                                1133, 1163, 1172, 1187, 1189, 1205, 1211, 1219, 1231, 1245, 1271, 1289,
                                1300, 1313, 1316, 1325, 1329, 1346, 1347, 1473, 1474, 1491, 1499, 1553,
                                1570, 1596, 1602, 1619, 1624, 1635, 1939, 1940, 1941, 1942, 1943, 1944,
                                1945, 1946, 1947, 1948, 1949, 1950, 1951, 1952, 1953, 1954, 1955, 1956,
                                1957, 1958, 1959, 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968,
                                1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980,
                                1981, 1982, 1983, 1984, 1985, 1986, 1987, 2119, 2140, 2143, 2147, 2153,
                                2158, 2161, 2168, 2171, 2175, 2182
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
    #     Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
    #    SurfaceWindGeoVars: uv
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &cris-fsr_npp_satbias Data/obs/cris-fsr_npp.$PYYYYYMMDDTHH0000Z.satbias.nc4
        output file: Data/vbc/cris-fsr_npp.$PYYYYYMMDDTHH0000Z.satbias.nc4
        variational bc:
          predictors:
          - name: constant
          - name: lapse_rate
            order: 2
            tlapse: &cris-fsr_npptlap Data/obs/cris-fsr_npp.$PYYYYYMMDDTHH0000Z.tlapse.txt
          - name: lapse_rate
            tlapse: *cris-fsr_npptlap
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *cris-fsr_npp_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/cris-fsr_npp.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      - filter: Perform Action
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        action:
          name: assign error
          error parameter vector: [ 0.8230, 0.7600, 0.7360, 0.7430, 0.8560, 1.0790, 0.8880, 0.7780, 0.6710, 0.6500,
                                    0.6430, 0.6290, 0.6290, 0.6180, 0.6380, 0.6190, 0.6100, 0.6270, 0.6010, 0.6170,
                                    0.6080, 0.4980, 0.5112, 0.4922, 0.4959, 0.4954, 0.4836, 0.5140, 0.5005, 0.4917,
                                    0.4881, 0.4656, 0.4793, 0.4638, 0.4557, 0.4666, 0.4468, 0.4534, 0.4471, 0.4448,
                                    0.4469, 0.5360, 0.4426, 0.4388, 0.5340, 0.4368, 0.4380, 0.5310, 0.4379, 0.5350,
                                    0.4404, 0.4405, 0.4409, 0.4472, 0.4555, 0.4433, 0.4437, 0.4454, 0.4448, 0.4465,
                                    0.4499, 0.4488, 0.5400, 0.4534, 0.4472, 0.4550, 0.4562, 0.4520, 0.4639, 0.5380,
                                    0.4573, 0.4604, 0.4533, 0.4692, 0.5660, 0.4457, 0.4457, 0.5154, 0.5084, 0.5280,
                                    0.5520, 0.5600, 0.5670, 0.5460, 0.4950, 0.4809, 0.4732, 0.4861, 0.4632, 0.5290,
                                    0.4748, 0.5007, 0.5711, 0.5950, 0.5469, 0.6260, 0.5410, 0.5430, 0.5330, 0.5410,
                                    0.4695, 0.5300, 0.5390, 0.5290, 0.5420, 0.4681, 0.5360, 0.5420, 0.5350, 0.5630,
                                    0.4805, 0.6470, 0.6090, 0.5530, 0.5830, 0.5760, 0.6294, 0.5885, 0.5560, 0.5780,
                                    0.5660, 0.6010, 0.5627, 0.5675, 0.5920, 0.5166, 0.5890, 0.5291, 0.5892, 0.5976,
                                    0.5834, 0.6512, 0.6748, 0.6615, 0.6003, 0.5669, 0.5587, 0.5507, 0.5871, 0.6160,
                                    0.6370, 0.6330, 0.6390, 0.6550, 0.6410, 0.6640, 0.6480, 0.6560, 0.6630, 0.6520,
                                    0.6810, 0.6620, 0.6730, 0.6720, 0.6800, 0.7350, 0.7320, 0.7150, 0.6740, 0.6870,
                                    0.7020, 0.7050, 0.7150, 0.7250, 0.7070, 0.7400, 0.7400, 0.8740, 0.7370, 0.8190,
                                    0.7600, 0.8690, 0.9000, 0.6980, 0.8230, 0.6760, 0.6820, 0.7660, 0.6800, 0.6850,
                                    0.6940, 0.6950, 0.6890, 0.7270, 0.6950, 0.6880, 0.6770, 0.7360, 0.6510, 0.6610,
                                    0.6199, 0.6223, 0.6036, 0.6003, 0.5991, 0.5980, 0.5910, 0.5764, 0.5770, 0.5593,
                                    0.5970, 0.5760, 0.5740, 0.5780, 0.5790, 0.5750, 0.5760, 0.5680, 0.5750, 0.5690,
                                    0.5590, 0.5680, 0.5401, 0.5500, 0.5575, 0.5780, 0.5635, 0.5786, 0.5807, 0.5810,
                                    0.5730, 0.5690, 0.5670, 0.5520, 0.5500, 0.5580, 0.5520, 0.5620, 0.5740, 0.5750,
                                    0.6290, 0.6820, 0.7560, 1.0500, 1.1220, 1.1402, 1.1540, 1.1310, 1.1230, 1.1590,
                                    1.1060, 1.1160, 1.0690, 1.0770, 1.1550, 1.1620, 1.1402, 0.6440, 1.2080, 1.1402,
                                    1.2950, 1.2580, 1.1402, 0.6060, 0.6030, 0.5630, 0.5920, 0.6070, 0.6110, 0.6120,
                                    0.6180, 0.6260, 0.6290, 0.5830, 0.8646, 0.6260, 0.6390, 0.5590, 0.8270, 0.6120,
                                    0.5760, 0.5800, 0.5750, 0.6880, 0.6970, 0.7430, 0.6810, 0.8320, 0.7190, 0.7850,
                                    0.8780, 0.9402, 1.0054, 1.0730, 1.1290, 1.0350, 1.0270, 0.9703, 1.1950, 0.9153,
                                    1.2660, 1.1530, 1.3480, 1.1800, 1.2690, 1.3110, 0.9914, 1.3590, 1.1660, 1.1390,
                                    1.2817, 1.3980, 1.5420, 1.2290, 1.3770, 1.2800, 1.2450, 1.1188, 1.1930, 1.2930,
                                    1.2750, 1.3310, 1.3400, 1.0990, 1.0480, 1.1240, 1.2250, 1.1830, 1.1960, 1.4000,
                                    1.3330, 1.4170, 1.3260, 1.3050, 1.0638, 1.2680, 1.2170, 1.2890, 1.3950, 1.2320,
                                    1.4350, 1.2980, 1.3280, 1.2620, 1.1990, 1.3910, 1.2330, 1.3290, 1.6640, 1.5090,
                                    1.3490, 1.4810, 1.5950, 1.4850, 1.5320, 1.5040, 1.5840, 1.6090, 1.5160, 1.4890,
                                    1.5020, 1.5440, 1.6110, 1.5390, 1.2960, 1.2880, 1.2410, 1.3200, 1.3130, 1.3010,
                                    1.8430, 1.7470, 1.7110, 1.7710, 1.9370, 1.5750, 1.5730, 1.5000, 1.4590, 1.4020,
                                    1.3630, 2.2010, 2.1270, 2.1770, 2.1570, 2.1920, 2.1460, 2.1510, 2.0710, 1.9860,
                                    1.8450, 1.6870, 1.5050, 1.3730, 1.2290, 1.1130, 1.0040, 0.9360, 0.8950, 0.8710,
                                    0.8410, 0.8210, 0.8050, 0.8000, 0.7920, 0.7970, 0.7910, 0.7830, 0.7770, 0.7850,
                                    0.7870, 0.7890, 0.7930, 0.7940, 0.7450, 0.7500, 0.7480, 0.7490, 0.7440, 0.7330,
                                    0.7330, 0.7410, 0.7460, 0.7460, 0.7380, 0.7430, 0.7450, 0.7490, 0.7500, 0.7500,
                                    0.8840, 0.9060, 0.9170, 0.9240, 0.9220, 0.9280, 0.9210, 0.9380, 0.9310, 0.9430,
                                    0.9460 ]
      # assign ObsError <---- ObsErrorData (Assigned in Yaml)
      - filter: Variable Assignment
        assignments:
        - name: ObsError/brightnessTemperature
          channels: *all_channels
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature
                channels: *all_channels
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: 1972, 1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981,
                    1982, 1983, 1984, 1985, 1986, 1987, 2119, 2140, 2143, 2147,
                    2153, 2158, 2161, 2168, 2171, 2175, 2182
        where:
        - variable:
            name: solarZenithAngle@MetaData
          maxvalue: 88.9999
        - variable:
            name: water_area_fraction@GeoVaLs
          minvalue: 1.0e-12
        action:
          name: reject
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorWavenumIR@ObsFunction
            channels: *all_channels
            options:
              channels: *all_channels
    #  Observation Range Sanity Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        minvalue: 50.00001
        maxvalue: 549.99999
        action:
          name: reject
    #  Topography Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorTopoRad@ObsFunction
            channels: *all_channels
            options:
              channels: *all_channels
              sensor: *Sensor_ID
    #  Transmittance Top Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorTransmitTopRad@ObsFunction
            channels: *all_channels
            options:
              channels: *all_channels
    #  Cloud Detection Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        test variables:
        - name: CloudDetectMinResidualIR@ObsFunction
          channels: *all_channels
          options:
            channels: *all_channels
            use_flag: &useflag [ -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
                                  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
                                  1, -1,  1,  1, -1,  1,  1, -1,  1, -1,
                                  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
                                  1,  1, -1,  1,  1,  1,  1,  1,  1, -1,
                                  1,  1,  1,  1, -1,  1,  1,  1,  1, -1,
                                 -1, -1, -1, -1,  1,  1,  1,  1,  1, -1,
                                  1,  1,  1, -1,  1, -1, -1, -1, -1, -1,
                                  1, -1, -1, -1, -1,  1, -1, -1, -1, -1,
                                  1, -1, -1, -1, -1, -1,  1,  1, -1, -1,
                                 -1, -1,  1,  1, -1,  1, -1,  1,  1,  1,
                                  1,  1,  1,  1,  1,  1,  1,  1,  1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                  1,  1,  1,  1,  1,  1,  1,  1, -1,  1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1,  1,  1,  1, -1,  1,  1,  1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1,  1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1,  1, -1, -1,  1,
                                 -1, -1,  1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1,  1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1,  1,  1, -1, -1, -1, -1, -1, -1,  1,
                                 -1, -1, -1, -1, -1, -1,  1, -1, -1, -1,
                                  1, -1, -1, -1, -1, -1, -1,  1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1,  1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                 -1]
            use_flag_clddet: &clddet [ 31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 30,
                                       30, 30, 31, 31, 30, 31, 30, 31, 31, 31,
                                       31, 31, 31, 31, 31, 31, 31, 31, 31, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       31, 31, 31, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 31, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 31, 30, 30, 31,
                                       30, 30, 31, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 31, 30, 30, 30, 30, 30, 30, 31,
                                       30, 30, 30, 30, 30, 30, 31, 30, 30, 30,
                                       31, 30, 30, 30, 30, 30, 30, 31, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 31, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                                       30 ]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
    # Surface Temperature Jacobian Check over Land
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        where:
        - variable:
            name: water_area_fraction@GeoVaLs
          maxvalue: 0.99
        test variables:
        - name: brightness_temperature_jacobian_surface_temperature@ObsDiag
          channels: *all_channels
        maxvalue: 0.2
    #  NSST Retrieval Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        test variables:
        - name: NearSSTRetCheckIR@ObsFunction
          channels: *all_channels
          options:
            channels: *all_channels
            use_flag: *useflag
            obserr_demisf: [0.01,0.02,0.03,0.02,0.03]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
    #  Surface Jacobians Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorSurfJacobianRad@ObsFunction
            channels: *all_channels
            options:
              channels: *all_channels
              sensor: *Sensor_ID
              obserr_demisf: [0.01, 0.02, 0.03, 0.02, 0.03]
              obserr_dtempf: [0.50, 2.00, 4.00, 2.00, 4.00]
    #  Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        function absolute threshold:
        - name: ObsErrorBoundIR@ObsFunction
          channels: *all_channels
          options:
            channels: *all_channels
            obserr_bound_latitude:
              name: ObsErrorFactorLatRad@ObsFunction
              options:
                latitude_parameters: [25.0, 0.5, 0.04, 1.0]
            obserr_bound_transmittop:
              name: ObsErrorFactorTransmitTopRad@ObsFunction
              channels: *all_channels
              options:
                channels: *all_channels
            obserr_bound_max: [ 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,
                                0.4, 2.0, 0.4, 0.4, 2.0, 0.4, 0.4, 2.0, 0.4, 2.0,
                                0.4, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 0.4, 0.4, 0.4, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 1.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 1.0, 2.0, 2.0, 1.0,
                                2.0, 2.0, 1.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                                2.0 ]
        action:
          name: reject
    #  Surface Type Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        test variables:
        - name: SurfTypeCheckRad@ObsFunction
          channels: *all_channels
          options:
            channels: *all_channels
            use_flag: *useflag
            use_flag_clddet: *clddet
        maxvalue: 1.0e-12
        defer to post: true
        action:
          name: reject
    #  Useflag Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *all_channels
        test variables:
        - name: ChannelUseflagCheckRad@ObsFunction
          channels: *all_channels
          options:
            channels: *all_channels
            use_flag: *useflag
        minvalue: 1.0e-12
        action:
          name: reject
#     passedBenchmark: 402   #(m_unittest)
 
####################################################
##  OBSYS-ON: IASI-Metop-B
####################################################
    - obs space:
        name: &Sensor_ID iasi_metop-b
        obsdatain:
          engine:
            type: H5File
            obsfile: 'Data/obs/iasi_metop-b.$BYYYYYMMDDTHH0000Z.nc4'
        obsdataout:
          engine:
            type: H5File
            obsfile: 'Data/hofx/iasi_metop-b.$BYYYYYMMDDTHH0000Z.nc4' 
        simulated variables: [brightnessTemperature]
        channels: &iasi_metop-b_channels 16, 29, 32, 35, 38, 41, 44, 47, 49, 50, 51, 53,
                                         55, 56, 57, 59, 61, 62, 63, 66, 68, 70, 72, 74, 76, 78, 79, 81, 82, 83,
                                         84, 85, 86, 87, 89, 92, 93, 95, 97, 99, 101, 103, 104, 106, 109, 110,
                                         111, 113, 116, 119, 122, 125, 128, 131, 133, 135, 138, 141, 144, 146,
                                         148, 150, 151, 154, 157, 159, 160, 161, 163, 167, 170, 173, 176, 179,
                                         180, 185, 187, 191, 193, 197, 199, 200, 202, 203, 205, 207, 210, 212,
                                         213, 214, 217, 218, 219, 222, 224, 225, 226, 228, 230, 231, 232, 236,
                                         237, 239, 243, 246, 249, 252, 254, 259, 260, 262, 265, 267, 269, 275,
                                         279, 282, 285, 294, 296, 299, 300, 303, 306, 309, 313, 320, 323, 326,
                                         327, 329, 332, 335, 345, 347, 350, 354, 356, 360, 363, 366, 371, 372,
                                         373, 375, 377, 379, 381, 383, 386, 389, 398, 401, 404, 405, 407, 408,
                                         410, 411, 414, 416, 418, 423, 426, 428, 432, 433, 434, 439, 442, 445,
                                         450, 457, 459, 472, 477, 483, 509, 515, 546, 552, 559, 566, 571, 573,
                                         578, 584, 594, 625, 646, 662, 668, 705, 739, 756, 797, 867, 906, 921,
                                         1027, 1046, 1090, 1098, 1121, 1133, 1173, 1191, 1194, 1222, 1271, 1283,
                                         1338, 1409, 1414, 1420, 1424, 1427, 1430, 1434, 1440, 1442, 1445, 1450,
                                         1454, 1460, 1463, 1469, 1474, 1479, 1483, 1487, 1494, 1496, 1502, 1505,
                                         1509, 1510, 1513, 1518, 1521, 1526, 1529, 1532, 1536, 1537, 1541, 1545,
                                         1548, 1553, 1560, 1568, 1574, 1579, 1583, 1585, 1587, 1606, 1626, 1639,
                                         1643, 1652, 1658, 1659, 1666, 1671, 1675, 1681, 1694, 1697, 1710, 1786,
                                         1791, 1805, 1839, 1884, 1913, 1946, 1947, 1991, 2019, 2094, 2119, 2213,
                                         2239, 2271, 2289, 2321, 2333, 2346, 2349, 2352, 2359, 2367, 2374, 2398,
                                         2426, 2562, 2701, 2741, 2745, 2760, 2819, 2889, 2907, 2910, 2919, 2921,
                                         2939, 2944, 2945, 2948, 2951, 2958, 2971, 2977, 2985, 2988, 2990, 2991,
                                         2993, 3002, 3008, 3014, 3027, 3029, 3030, 3036, 3047, 3049, 3052, 3053,
                                         3055, 3058, 3064, 3069, 3087, 3093, 3098, 3105, 3107, 3110, 3116, 3127,
                                         3129, 3136, 3146, 3151, 3160, 3165, 3168, 3175, 3178, 3189, 3207, 3228,
                                         3244, 3248, 3252, 3256, 3263, 3281, 3295, 3303, 3309, 3312, 3322, 3326,
                                         3354, 3366, 3375, 3378, 3411, 3416, 3432, 3438, 3440, 3442, 3444, 3446,
                                         3448, 3450, 3452, 3454, 3458, 3467, 3476, 3484, 3491, 3497, 3499, 3504,
                                         3506, 3509, 3518, 3527, 3555, 3575, 3577, 3580, 3582, 3586, 3589, 3599,
                                         3610, 3626, 3638, 3646, 3653, 3658, 3661, 3673, 3689, 3700, 3710, 3726,
                                         3763, 3814, 3841, 3888, 4032, 4059, 4068, 4082, 4095, 4160, 4234, 4257,
                                         4411, 4498, 4520, 4552, 4567, 4608, 4646, 4698, 4808, 4849, 4920, 4939,
                                         4947, 4967, 4991, 4996, 5015, 5028, 5056, 5128, 5130, 5144, 5170, 5178,
                                         5183, 5188, 5191, 5368, 5371, 5379, 5381, 5383, 5397, 5399, 5401, 5403,
                                         5405, 5446, 5455, 5472, 5480, 5483, 5485, 5492, 5497, 5502, 5507, 5509,
                                         5517, 5528, 5558, 5697, 5714, 5749, 5766, 5785, 5798, 5799, 5801, 5817,
                                         5833, 5834, 5836, 5849, 5851, 5852, 5865, 5869, 5881, 5884, 5897, 5900,
                                         5916, 5932, 5948, 5963, 5968, 5978, 5988, 5992, 5994, 5997, 6003, 6008,
                                         6023, 6026, 6039, 6053, 6056, 6067, 6071, 6082, 6085, 6098, 6112, 6126,
                                         6135, 6140, 6149, 6154, 6158, 6161, 6168, 6174, 6182, 6187, 6205, 6209,
                                         6213, 6317, 6339, 6342, 6366, 6381, 6391, 6489, 6962, 6966, 6970, 6975,
                                         6977, 6982, 6985, 6987, 6989, 6991, 6993, 6995, 6997, 6999, 7000, 7004,
                                         7008, 7013, 7016, 7021, 7024, 7027, 7029, 7032, 7038, 7043, 7046, 7049,
                                         7069, 7072, 7076, 7081, 7084, 7089, 7099, 7209, 7222, 7231, 7235, 7247,
                                         7267, 7269, 7284, 7389, 7419, 7423, 7424, 7426, 7428, 7431, 7436, 7444,
                                         7475, 7549, 7584, 7665, 7666, 7831, 7836, 7853, 7865, 7885, 7888, 7912,
                                         7950, 7972, 7980, 7995, 8007, 8015, 8055, 8078
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &iasi_metop-b_satbias 'Data/obs/iasi_metop-b.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/iasi_metop-b.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variational bc:
          predictors:
          - name: constant
          - name: lapse_rate
            order: 2
            tlapse: &iasi_metop-b_tlapse 'Data/obs/iasi_metop-b.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *iasi_metop-b_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *iasi_metop-b_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/iasi_metop-b.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      # assign ObsError <---- ObsErrorData (Assigned in Yaml)
      - filter: Variable Assignment
        assignments:
        - name: ObsError/brightnessTemperature
          channels: *iasi_metop-b_channels
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature
                channels: *iasi_metop-b_channels
      - filter: Perform Action
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        action:
          name: assign error
          error parameter vector: [ 0.7270, 0.8100, 0.7500, 0.7900, 0.7055, 0.7400, 0.6800, 0.7200, 0.6526, 0.6500,
                                    0.6650, 0.6900, 0.6394, 0.6400, 0.6528, 0.6065, 0.6246, 0.6100, 0.6423, 0.5995,
                                    0.5900, 0.6069, 0.6000, 0.5965, 0.6400, 0.6200, 0.5890, 0.5865, 0.6500, 0.5861,
                                    0.6100, 0.5874, 0.6800, 0.6060, 0.6800, 4.3800, 3.0500, 2.3100, 1.5600, 1.3300,
                                    1.5800, 0.9300, 0.5832, 0.5587, 0.5867, 0.5800, 0.5655, 0.5522, 0.5864, 0.5475,
                                    0.5854, 0.5455, 0.5811, 0.5376, 0.5452, 0.5686, 0.5329, 0.5655, 0.5302, 0.5450,
                                    0.5628, 0.5900, 0.5262, 0.5590, 0.5264, 0.5442, 0.5100, 0.5513, 0.5224, 0.5523,
                                    0.5188, 0.5487, 0.5245, 0.5800, 0.5437, 0.5343, 0.5364, 0.6400, 0.5338, 0.7200,
                                    0.5370, 0.7500, 0.5100, 0.6500, 0.5274, 0.5290, 0.5187, 0.5228, 1.1200, 0.5222,
                                    0.5109, 0.6700, 0.5133, 0.5179, 0.5070, 0.6700, 0.5091, 0.6200, 0.5093, 0.6900,
                                    0.5048, 0.5024, 0.7800, 0.4970, 0.5337, 0.4865, 0.4915, 0.4835, 0.4869, 0.8700,
                                    0.4824, 0.4852, 0.8400, 0.8400, 0.8400, 0.5318, 0.8000, 0.4772, 0.9800, 0.4880,
                                    0.4978, 0.5157, 0.6100, 0.5213, 0.4884, 0.7900, 0.6200, 0.6600, 0.4691, 0.6500,
                                    0.4809, 0.4680, 0.6200, 0.4679, 0.6913, 0.4705, 0.4785, 0.4700, 0.4773, 0.4703,
                                    0.9800, 0.4697, 0.4662, 0.6500, 0.4670, 0.4883, 0.4684, 0.4684, 0.4947, 0.5393,
                                    0.5024, 0.4715, 0.6210, 0.6136, 0.5316, 1.7800, 0.5099, 1.1400, 0.5390, 1.7900,
                                    0.5080, 0.5723, 1.9400, 2.0100, 0.4900, 0.5647, 0.5022, 1.4700, 0.5815, 0.6782,
                                    2.1300, 0.5445, 1.5200, 0.5555, 1.9600, 2.3100, 2.3300, 2.3200, 2.3100, 0.6994,
                                    0.7006, 0.7060, 0.9785, 0.7023, 0.6991, 0.6946, 2.2800, 2.2600, 2.2600, 2.2600,
                                    0.6608, 0.6835, 0.6822, 2.2400, 2.2600, 0.6735, 2.2800, 0.6670, 0.7732, 0.6642,
                                    0.6480, 0.6629, 2.2900, 2.2900, 0.6799, 0.6230, 2.3200, 0.6030, 0.6224, 2.3200,
                                    0.6187, 2.3100, 2.3100, 2.2800, 2.2900, 2.2800, 2.2600, 1.9660, 2.2700, 2.2600,
                                    2.2500, 2.2700, 2.2400, 2.2100, 2.2400, 2.1700, 2.1800, 2.1700, 2.2100, 1.4000,
                                    2.1600, 2.2000, 2.1300, 2.1200, 2.1300, 2.1000, 2.1200, 2.1100, 2.0900, 2.0900,
                                    2.0800, 2.0900, 2.0400, 2.0400, 1.9660, 2.0100, 2.0500, 2.0300, 2.0600, 1.9800,
                                    1.9500, 1.9400, 1.9100, 1.8570, 1.7600, 1.7480, 1.8300, 2.0400, 1.7480, 1.9900,
                                    2.0750, 2.0700, 2.0200, 2.0400, 2.1000, 1.9660, 2.1800, 2.2100, 2.2400, 2.2300,
                                    2.2300, 1.9800, 2.2000, 2.1800, 2.1800, 2.2100, 2.2300, 2.2400, 2.2400, 2.2500,
                                    1.8000, 2.2400, 1.7300, 1.7300, 2.2700, 1.6700, 2.2100, 1.7200, 2.2300, 2.2300,
                                    2.2300, 2.2400, 2.2300, 2.1200, 2.1700, 1.7400, 2.0200, 1.8800, 1.6700, 1.7300,
                                    1.8300, 1.8200, 1.7300, 1.8300, 2.1900, 1.8400, 1.8900, 1.6000, 1.7100, 1.8600,
                                    1.8500, 1.8400, 1.8700, 1.9100, 1.5200, 1.9500, 1.8700, 1.8900, 1.9100, 1.9100,
                                    1.9300, 1.9000, 1.9100, 1.9000, 1.8900, 1.8900, 1.9100, 1.9000, 1.9100, 1.9100,
                                    1.9100, 1.9300, 1.9400, 1.9100, 1.9200, 1.7700, 1.9100, 1.9500, 1.1900, 1.9600,
                                    1.9800, 1.9400, 1.5500, 1.9100, 1.9200, 1.9200, 1.9700, 1.9300, 1.9900, 1.8600,
                                    1.1200, 1.9300, 1.9200, 1.9500, 1.8500, 1.8400, 1.9100, 1.1200, 1.8200, 1.8200,
                                    1.9500, 1.2400, 1.9400, 1.9600, 1.2100, 1.8300, 1.9600, 1.3600, 1.9600, 1.8200,
                                    1.9200, 1.6800, 1.9300, 1.2300, 1.9600, 1.9300, 1.8600, 1.4100, 1.1600, 1.6000,
                                    1.2500, 1.2000, 1.6500, 1.6600, 1.8700, 1.9400, 1.9600, 1.9100, 1.2500, 1.9300,
                                    1.9100, 1.7000, 0.9900, 1.8100, 1.9200, 1.9500, 1.5000, 1.4700, 1.1500, 1.5800,
                                    1.1800, 1.8200, 1.1300, 1.8300, 1.9100, 1.2600, 1.2700, 1.9100, 1.4500, 1.6000,
                                    1.2900, 1.9400, 1.9400, 1.2300, 1.9500, 1.2100, 1.9400, 1.8600, 1.9000, 1.3300,
                                    1.7500, 2.0200, 1.9800, 2.0300, 1.8300, 1.5000, 2.0400, 2.0200, 1.9000, 2.0000,
                                    2.0200, 1.9500, 1.9300, 1.9500, 1.9500, 1.9900, 2.0000, 1.9400, 1.9600, 1.8600,
                                    1.9200, 1.8800, 1.8600, 1.8400, 1.8700, 1.7700, 1.8900, 1.8900, 1.8800, 1.9400,
                                    1.8200, 1.7900, 1.8600, 2.0600, 2.3300, 1.8800, 1.8600, 1.8100, 1.8000, 1.8000,
                                    1.8600, 1.9000, 2.0000, 2.0600, 2.1000, 2.2000, 2.0000, 2.1600, 1.9800, 1.8000,
                                    1.8000, 1.8500, 1.7500, 2.0400, 2.1900, 2.1400, 2.1900, 1.8600, 2.1000, 2.1100,
                                    2.1800, 2.0300, 2.2800, 2.1900, 2.2600, 2.2600, 2.2100, 2.2100, 2.2600, 2.3300,
                                    2.2700, 2.2100, 2.1200, 2.2300, 2.2600, 2.2500, 1.8800, 2.2600, 2.2400, 2.3600,
                                    2.2900, 2.3500, 2.3000, 2.2700, 2.0800, 2.0500, 2.2700, 2.2800, 2.2700, 2.2800,
                                    1.9700, 2.2500, 2.2500, 2.2500, 2.3100, 2.2800, 2.2700, 2.1300, 2.2400, 2.2800,
                                    2.2800, 2.4100, 2.3400, 9.3200, 2.2800, 2.3800, 2.2700, 2.2700, 2.3900, 2.1100,
                                    2.0900, 2.1000, 2.0600, 2.1200, 2.0800, 2.0000, 1.9300, 2.0200, 2.5500, 1.5400,
                                    1.6400, 1.5100, 1.5500, 2.8200, 2.9200, 2.5500, 2.3700, 1.8500, 1.6000, 1.7200,
                                    1.7400, 1.7900, 1.9000, 1.9400, 2.0000, 2.0400, 2.0800, 2.1200, 2.1300, 2.1600,
                                    2.1800, 2.1800, 2.2000, 2.2000, 2.4100, 2.3900, 2.3800, 2.4000, 2.4200, 2.4100,
                                    2.4300, 2.4500, 2.4300, 2.4500, 2.4300, 2.4000, 2.4400, 2.4000, 2.4200, 2.4300,
                                    2.4500, 2.4500, 2.4500, 2.4600, 2.4500, 2.4500, 2.4300, 2.5100, 2.4800, 2.4800,
                                    2.5300, 2.4600, 2.4900, 2.5000, 2.5000, 2.5000, 2.5200, 2.5200, 2.5400, 2.5000,
                                    2.4800, 2.5000, 2.5500, 2.5000, 2.4800, 2.5000, 2.5000, 2.5200, 2.5200, 2.4800,
                                    2.5000, 2.5000, 2.5200, 2.4600, 2.5300, 9.0000 ]
      #  Wavenumber Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: 7024, 7027, 7029, 7032, 7038, 7043, 7046, 7049, 7069, 7072,
                    7076, 7081, 7084, 7089, 7099, 7209, 7222, 7231, 7235, 7247,
                    7267, 7269, 7284, 7389, 7419, 7423, 7424, 7426, 7428, 7431,
                    7436, 7444, 7475, 7549, 7584, 7665, 7666, 7831, 7836, 7853,
                    7865, 7885, 7888, 7912, 7950, 7972, 7980, 7995, 8007, 8015,
                    8055, 8078
        where:
        - variable:
            name: MetaData/solarZenithAngle
          maxvalue: 88.9999
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 1.0e-12
        action:
          name: reject
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorWavenumIR
            channels: *iasi_metop-b_channels
            options:
              channels: *iasi_metop-b_channels
      #  Observation Range Sanity Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        minvalue: 50.00001
        maxvalue: 549.99999
        action:
          name: reject
      #  Topography Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTopoRad
            channels: *iasi_metop-b_channels
            options:
              channels: *iasi_metop-b_channels
              sensor: *Sensor_ID
      #  Transmittance Top Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTransmitTopRad
            channels: *iasi_metop-b_channels
            options:
              channels: *iasi_metop-b_channels
      #  Cloud Detection Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        test variables:
        - name: ObsFunction/CloudDetectMinResidualIR
          channels: *iasi_metop-b_channels
          options:
            channels: *iasi_metop-b_channels
            use_flag: &useflag_iasi_metop-b [ 1, -1, -1, -1,  1, -1, -1, -1,  1, -1,
                          1, -1,  1, -1,  1,  1,  1, -1,  1,  1,
                         -1,  1,  1,  1, -1, -1,  1,  1, -1,  1,
                         -1,  1, -1,  1, -1, -1, -1, -1, -1, -1,
                         -1, -1,  1,  1,  1, -1,  1,  1,  1,  1,
                          1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
                          1, -1,  1,  1,  1,  1, -1,  1,  1,  1,
                          1,  1,  1, -1,  1,  1,  1, -1,  1, -1,
                          1, -1, -1, -1,  1,  1,  1,  1, -1,  1,
                          1, -1,  1,  1,  1, -1,  1, -1,  1, -1,
                          1,  1, -1,  1,  1,  1,  1,  1,  1, -1,
                          1,  1, -1, -1, -1,  1, -1,  1, -1,  1,
                          1,  1, -1,  1,  1, -1, -1, -1,  1, -1,
                          1,  1, -1,  1,  1,  1,  1,  1,  1,  1,
                         -1,  1,  1, -1,  1,  1,  1,  1,  1,  1,
                          1,  1,  1,  1,  1, -1,  1, -1,  1, -1,
                          1,  1, -1, -1,  1,  1,  1, -1,  1,  1,
                         -1,  1, -1,  1, -1, -1, -1, -1, -1,  1,
                          1,  1,  1,  1,  1,  1, -1, -1, -1, -1,
                          1,  1,  1, -1, -1,  1, -1,  1,  1,  1,
                          1,  1, -1, -1,  1,  1, -1,  1,  1, -1,
                          1, -1, -1, -1, -1, -1, -1,  1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1,  1, -1, -1, -1, -1, -1,
                         -1, -1, -1,  1, -1,  1, -1, -1,  1, -1,
                          1, -1, -1, -1, -1,  1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1]
            use_flag_clddet: &clddet_iasi_metop-b [ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 31, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 31,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 31, 1, 1, 1, 1, 1,
                                 1, 1, 1, 31, 1, 31, 1, 1, 31, 1,
                                31, 1, 1, 1, 1, 31, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
      #  NSST Retrieval Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        test variables:
        - name: ObsFunction/NearSSTRetCheckIR
          channels: *iasi_metop-b_channels
          options:
            channels: *iasi_metop-b_channels
            use_flag: *useflag_iasi_metop-b
            obserr_demisf: [0.01,0.02,0.03,0.02,0.03]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
      #  Surface Jacobians Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorSurfJacobianRad
            channels: *iasi_metop-b_channels
            options:
              channels: *iasi_metop-b_channels
              sensor: *Sensor_ID
              obserr_demisf: [0.01, 0.02, 0.03, 0.02, 0.03]
              obserr_dtempf: [0.50, 2.00, 4.00, 2.00, 4.00]
      #  Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        function absolute threshold:
        - name: ObsFunction/ObsErrorBoundIR
          channels: *iasi_metop-b_channels
          options:
            channels: *iasi_metop-b_channels
            obserr_bound_latitude:
              name: ObsFunction/ObsErrorFactorLatRad
              options:
                latitude_parameters: [25.0, 0.5, 0.04, 1.0]
            obserr_bound_transmittop:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *iasi_metop-b_channels
              options:
                channels: *iasi_metop-b_channels
            obserr_bound_max: [ 3.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 4.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 4.00, 4.00,
                                3.50, 2.50, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 0.75, 2.00,
                                0.75, 2.00, 2.00, 2.00, 0.75, 0.75, 0.75, 0.75, 2.00, 0.75,
                                0.75, 2.00, 0.75, 0.75, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.50, 2.00, 2.50, 2.50, 3.00, 2.50,
                                2.50, 2.50, 2.50, 3.50, 2.50, 2.50, 3.00, 3.50, 3.00, 4.00,
                                4.00, 0.75, 4.00, 4.00, 4.00, 4.50, 4.50, 4.50, 4.50, 4.50,
                                4.00, 4.50, 4.00, 4.00, 4.50, 2.50, 3.00, 2.50, 3.00, 2.50,
                                3.00, 2.00, 2.50, 2.50, 3.00, 3.00, 2.50, 3.00, 3.00, 3.00,
                                2.50, 2.50, 4.00, 4.50, 4.50, 5.00, 4.00, 4.00, 5.00, 5.00,
                                5.00, 5.00, 5.50, 5.50, 4.00, 5.00, 4.00, 4.50, 5.50, 5.50,
                                6.00, 4.50, 4.50, 4.00, 5.00, 5.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 1.25, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 1.25,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 1.50, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 1.40, 6.00, 1.40, 6.00, 6.00, 1.40, 6.00,
                                1.50, 6.00, 6.00, 6.00, 6.00, 1.50, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 5.50, 4.50, 6.00,
                                5.00, 5.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 5.00, 6.00,
                                6.00, 6.00, 4.00, 6.00, 6.00, 6.00, 6.00, 4.50, 6.00, 6.00,
                                4.50, 6.00, 6.00, 6.00, 6.00, 6.00, 5.00, 6.00, 6.00, 6.00,
                                5.00, 6.00, 6.00, 5.00, 6.00, 5.00, 6.00, 6.00, 6.00, 5.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00 ]
        action:
          name: reject
      #  Surface Type Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        test variables:
        - name: SurfTypeCheckRad@ObsFunction
          channels: *iasi_metop-b_channels
          options:
            channels: *iasi_metop-b_channels
            use_flag: *useflag_iasi_metop-b
            use_flag_clddet: *clddet_iasi_metop-b
        maxvalue: 1.0e-12
        defer to post: true
        action:
          name: reject
      #  Useflag Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-b_channels
        test variables:
        - name: ObsFunction/ChannelUseflagCheckRad
          channels: *iasi_metop-b_channels
          options:
            channels: *iasi_metop-b_channels
            use_flag: *useflag_iasi_metop-b
        minvalue: 1.0e-12
        action:
          name: reject


####################################################
##  OBSYS-ON: IASI-Metop-C
####################################################
    - obs space:
        name: &Sensor_ID iasi_metop-c
        obsdatain:
          engine:
            type: H5File
            obsfile: 'Data/obs/iasi_metop-c.$BYYYYYMMDDTHH0000Z.nc4'
        obsdataout:
          engine:
            type: H5File
            obsfile: 'Data/hofx/iasi_metop-c.$BYYYYYMMDDTHH0000Z.nc4' 
        simulated variables: [brightnessTemperature]
        channels: &iasi_metop-c_channels 16, 29, 32, 35, 38, 41, 44, 47, 49, 50, 51, 53,
                                         55, 56, 57, 59, 61, 62, 63, 66, 68, 70, 72, 74, 76, 78, 79, 81, 82, 83,
                                         84, 85, 86, 87, 89, 92, 93, 95, 97, 99, 101, 103, 104, 106, 109, 110,
                                         111, 113, 116, 119, 122, 125, 128, 131, 133, 135, 138, 141, 144, 146,
                                         148, 150, 151, 154, 157, 159, 160, 161, 163, 167, 170, 173, 176, 179,
                                         180, 185, 187, 191, 193, 197, 199, 200, 202, 203, 205, 207, 210, 212,
                                         213, 214, 217, 218, 219, 222, 224, 225, 226, 228, 230, 231, 232, 236,
                                         237, 239, 243, 246, 249, 252, 254, 259, 260, 262, 265, 267, 269, 275,
                                         279, 282, 285, 294, 296, 299, 300, 303, 306, 309, 313, 320, 323, 326,
                                         327, 329, 332, 335, 345, 347, 350, 354, 356, 360, 363, 366, 371, 372,
                                         373, 375, 377, 379, 381, 383, 386, 389, 398, 401, 404, 405, 407, 408,
                                         410, 411, 414, 416, 418, 423, 426, 428, 432, 433, 434, 439, 442, 445,
                                         450, 457, 459, 472, 477, 483, 509, 515, 546, 552, 559, 566, 571, 573,
                                         578, 584, 594, 625, 646, 662, 668, 705, 739, 756, 797, 867, 906, 921,
                                         1027, 1046, 1090, 1098, 1121, 1133, 1173, 1191, 1194, 1222, 1271, 1283,
                                         1338, 1409, 1414, 1420, 1424, 1427, 1430, 1434, 1440, 1442, 1445, 1450,
                                         1454, 1460, 1463, 1469, 1474, 1479, 1483, 1487, 1494, 1496, 1502, 1505,
                                         1509, 1510, 1513, 1518, 1521, 1526, 1529, 1532, 1536, 1537, 1541, 1545,
                                         1548, 1553, 1560, 1568, 1574, 1579, 1583, 1585, 1587, 1606, 1626, 1639,
                                         1643, 1652, 1658, 1659, 1666, 1671, 1675, 1681, 1694, 1697, 1710, 1786,
                                         1791, 1805, 1839, 1884, 1913, 1946, 1947, 1991, 2019, 2094, 2119, 2213,
                                         2239, 2271, 2289, 2321, 2333, 2346, 2349, 2352, 2359, 2367, 2374, 2398,
                                         2426, 2562, 2701, 2741, 2745, 2760, 2819, 2889, 2907, 2910, 2919, 2921,
                                         2939, 2944, 2945, 2948, 2951, 2958, 2971, 2977, 2985, 2988, 2990, 2991,
                                         2993, 3002, 3008, 3014, 3027, 3029, 3030, 3036, 3047, 3049, 3052, 3053,
                                         3055, 3058, 3064, 3069, 3087, 3093, 3098, 3105, 3107, 3110, 3116, 3127,
                                         3129, 3136, 3146, 3151, 3160, 3165, 3168, 3175, 3178, 3189, 3207, 3228,
                                         3244, 3248, 3252, 3256, 3263, 3281, 3295, 3303, 3309, 3312, 3322, 3326,
                                         3354, 3366, 3375, 3378, 3411, 3416, 3432, 3438, 3440, 3442, 3444, 3446,
                                         3448, 3450, 3452, 3454, 3458, 3467, 3476, 3484, 3491, 3497, 3499, 3504,
                                         3506, 3509, 3518, 3527, 3555, 3575, 3577, 3580, 3582, 3586, 3589, 3599,
                                         3610, 3626, 3638, 3646, 3653, 3658, 3661, 3673, 3689, 3700, 3710, 3726,
                                         3763, 3814, 3841, 3888, 4032, 4059, 4068, 4082, 4095, 4160, 4234, 4257,
                                         4411, 4498, 4520, 4552, 4567, 4608, 4646, 4698, 4808, 4849, 4920, 4939,
                                         4947, 4967, 4991, 4996, 5015, 5028, 5056, 5128, 5130, 5144, 5170, 5178,
                                         5183, 5188, 5191, 5368, 5371, 5379, 5381, 5383, 5397, 5399, 5401, 5403,
                                         5405, 5446, 5455, 5472, 5480, 5483, 5485, 5492, 5497, 5502, 5507, 5509,
                                         5517, 5528, 5558, 5697, 5714, 5749, 5766, 5785, 5798, 5799, 5801, 5817,
                                         5833, 5834, 5836, 5849, 5851, 5852, 5865, 5869, 5881, 5884, 5897, 5900,
                                         5916, 5932, 5948, 5963, 5968, 5978, 5988, 5992, 5994, 5997, 6003, 6008,
                                         6023, 6026, 6039, 6053, 6056, 6067, 6071, 6082, 6085, 6098, 6112, 6126,
                                         6135, 6140, 6149, 6154, 6158, 6161, 6168, 6174, 6182, 6187, 6205, 6209,
                                         6213, 6317, 6339, 6342, 6366, 6381, 6391, 6489, 6962, 6966, 6970, 6975,
                                         6977, 6982, 6985, 6987, 6989, 6991, 6993, 6995, 6997, 6999, 7000, 7004,
                                         7008, 7013, 7016, 7021, 7024, 7027, 7029, 7032, 7038, 7043, 7046, 7049,
                                         7069, 7072, 7076, 7081, 7084, 7089, 7099, 7209, 7222, 7231, 7235, 7247,
                                         7267, 7269, 7284, 7389, 7419, 7423, 7424, 7426, 7428, 7431, 7436, 7444,
                                         7475, 7549, 7584, 7665, 7666, 7831, 7836, 7853, 7865, 7885, 7888, 7912,
                                         7950, 7972, 7980, 7995, 8007, 8015, 8055, 8078
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &iasi_metop-c_satbias 'Data/obs/iasi_metop-c.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/iasi_metop-c.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variational bc:
          predictors:
          - name: constant
          - name: lapse_rate
            order: 2
            tlapse: &iasi_metop-c_tlapse 'Data/obs/iasi_metop-c.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *iasi_metop-c_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *iasi_metop-c_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/iasi_metop-c.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      # assign ObsError <---- ObsErrorData (Assigned in Yaml)
      - filter: Variable Assignment
        assignments:
        - name: ObsError/brightnessTemperature
          channels: *iasi_metop-c_channels
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature
                channels: *iasi_metop-c_channels
      - filter: Perform Action
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        action:
          name: assign error
          error parameter vector: [ 0.7270, 0.8100, 0.7500, 0.7900, 0.7055, 0.7400, 0.6800, 0.7200, 0.6526, 0.6500,
                                    0.6650, 0.6900, 0.6394, 0.6400, 0.6528, 0.6065, 0.6246, 0.6100, 0.6423, 0.5995,
                                    0.5900, 0.6069, 0.6000, 0.5965, 0.6400, 0.6200, 0.5890, 0.5865, 0.6500, 0.5861,
                                    0.6100, 0.5874, 0.6800, 0.6060, 0.6800, 4.3800, 3.0500, 2.3100, 1.5600, 1.3300,
                                    1.5800, 0.9300, 0.5832, 0.5587, 0.5867, 0.5800, 0.5655, 0.5522, 0.5864, 0.5475,
                                    0.5854, 0.5455, 0.5811, 0.5376, 0.5452, 0.5686, 0.5329, 0.5655, 0.5302, 0.5450,
                                    0.5628, 0.5900, 0.5262, 0.5590, 0.5264, 0.5442, 0.5100, 0.5513, 0.5224, 0.5523,
                                    0.5188, 0.5487, 0.5245, 0.5800, 0.5437, 0.5343, 0.5364, 0.6400, 0.5338, 0.7200,
                                    0.5370, 0.7500, 0.5100, 0.6500, 0.5274, 0.5290, 0.5187, 0.5228, 1.1200, 0.5222,
                                    0.5109, 0.6700, 0.5133, 0.5179, 0.5070, 0.6700, 0.5091, 0.6200, 0.5093, 0.6900,
                                    0.5048, 0.5024, 0.7800, 0.4970, 0.5337, 0.4865, 0.4915, 0.4835, 0.4869, 0.8700,
                                    0.4824, 0.4852, 0.8400, 0.8400, 0.8400, 0.5318, 0.8000, 0.4772, 0.9800, 0.4880,
                                    0.4978, 0.5157, 0.6100, 0.5213, 0.4884, 0.7900, 0.6200, 0.6600, 0.4691, 0.6500,
                                    0.4809, 0.4680, 0.6200, 0.4679, 0.6913, 0.4705, 0.4785, 0.4700, 0.4773, 0.4703,
                                    0.9800, 0.4697, 0.4662, 0.6500, 0.4670, 0.4883, 0.4684, 0.4684, 0.4947, 0.5393,
                                    0.5024, 0.4715, 0.6210, 0.6136, 0.5316, 1.7800, 0.5099, 1.1400, 0.5390, 1.7900,
                                    0.5080, 0.5723, 1.9400, 2.0100, 0.4900, 0.5647, 0.5022, 1.4700, 0.5815, 0.6782,
                                    2.1300, 0.5445, 1.5200, 0.5555, 1.9600, 2.3100, 2.3300, 2.3200, 2.3100, 0.6994,
                                    0.7006, 0.7060, 0.9785, 0.7023, 0.6991, 0.6946, 2.2800, 2.2600, 2.2600, 2.2600,
                                    0.6608, 0.6835, 0.6822, 2.2400, 2.2600, 0.6735, 2.2800, 0.6670, 0.7732, 0.6642,
                                    0.6480, 0.6629, 2.2900, 2.2900, 0.6799, 0.6230, 2.3200, 0.6030, 0.6224, 2.3200,
                                    0.6187, 2.3100, 2.3100, 2.2800, 2.2900, 2.2800, 2.2600, 1.9660, 2.2700, 2.2600,
                                    2.2500, 2.2700, 2.2400, 2.2100, 2.2400, 2.1700, 2.1800, 2.1700, 2.2100, 1.4000,
                                    2.1600, 2.2000, 2.1300, 2.1200, 2.1300, 2.1000, 2.1200, 2.1100, 2.0900, 2.0900,
                                    2.0800, 2.0900, 2.0400, 2.0400, 1.9660, 2.0100, 2.0500, 2.0300, 2.0600, 1.9800,
                                    1.9500, 1.9400, 1.9100, 1.8570, 1.7600, 1.7480, 1.8300, 2.0400, 1.7480, 1.9900,
                                    2.0750, 2.0700, 2.0200, 2.0400, 2.1000, 1.9660, 2.1800, 2.2100, 2.2400, 2.2300,
                                    2.2300, 1.9800, 2.2000, 2.1800, 2.1800, 2.2100, 2.2300, 2.2400, 2.2400, 2.2500,
                                    1.8000, 2.2400, 1.7300, 1.7300, 2.2700, 1.6700, 2.2100, 1.7200, 2.2300, 2.2300,
                                    2.2300, 2.2400, 2.2300, 2.1200, 2.1700, 1.7400, 2.0200, 1.8800, 1.6700, 1.7300,
                                    1.8300, 1.8200, 1.7300, 1.8300, 2.1900, 1.8400, 1.8900, 1.6000, 1.7100, 1.8600,
                                    1.8500, 1.8400, 1.8700, 1.9100, 1.5200, 1.9500, 1.8700, 1.8900, 1.9100, 1.9100,
                                    1.9300, 1.9000, 1.9100, 1.9000, 1.8900, 1.8900, 1.9100, 1.9000, 1.9100, 1.9100,
                                    1.9100, 1.9300, 1.9400, 1.9100, 1.9200, 1.7700, 1.9100, 1.9500, 1.1900, 1.9600,
                                    1.9800, 1.9400, 1.5500, 1.9100, 1.9200, 1.9200, 1.9700, 1.9300, 1.9900, 1.8600,
                                    1.1200, 1.9300, 1.9200, 1.9500, 1.8500, 1.8400, 1.9100, 1.1200, 1.8200, 1.8200,
                                    1.9500, 1.2400, 1.9400, 1.9600, 1.2100, 1.8300, 1.9600, 1.3600, 1.9600, 1.8200,
                                    1.9200, 1.6800, 1.9300, 1.2300, 1.9600, 1.9300, 1.8600, 1.4100, 1.1600, 1.6000,
                                    1.2500, 1.2000, 1.6500, 1.6600, 1.8700, 1.9400, 1.9600, 1.9100, 1.2500, 1.9300,
                                    1.9100, 1.7000, 0.9900, 1.8100, 1.9200, 1.9500, 1.5000, 1.4700, 1.1500, 1.5800,
                                    1.1800, 1.8200, 1.1300, 1.8300, 1.9100, 1.2600, 1.2700, 1.9100, 1.4500, 1.6000,
                                    1.2900, 1.9400, 1.9400, 1.2300, 1.9500, 1.2100, 1.9400, 1.8600, 1.9000, 1.3300,
                                    1.7500, 2.0200, 1.9800, 2.0300, 1.8300, 1.5000, 2.0400, 2.0200, 1.9000, 2.0000,
                                    2.0200, 1.9500, 1.9300, 1.9500, 1.9500, 1.9900, 2.0000, 1.9400, 1.9600, 1.8600,
                                    1.9200, 1.8800, 1.8600, 1.8400, 1.8700, 1.7700, 1.8900, 1.8900, 1.8800, 1.9400,
                                    1.8200, 1.7900, 1.8600, 2.0600, 2.3300, 1.8800, 1.8600, 1.8100, 1.8000, 1.8000,
                                    1.8600, 1.9000, 2.0000, 2.0600, 2.1000, 2.2000, 2.0000, 2.1600, 1.9800, 1.8000,
                                    1.8000, 1.8500, 1.7500, 2.0400, 2.1900, 2.1400, 2.1900, 1.8600, 2.1000, 2.1100,
                                    2.1800, 2.0300, 2.2800, 2.1900, 2.2600, 2.2600, 2.2100, 2.2100, 2.2600, 2.3300,
                                    2.2700, 2.2100, 2.1200, 2.2300, 2.2600, 2.2500, 1.8800, 2.2600, 2.2400, 2.3600,
                                    2.2900, 2.3500, 2.3000, 2.2700, 2.0800, 2.0500, 2.2700, 2.2800, 2.2700, 2.2800,
                                    1.9700, 2.2500, 2.2500, 2.2500, 2.3100, 2.2800, 2.2700, 2.1300, 2.2400, 2.2800,
                                    2.2800, 2.4100, 2.3400, 9.3200, 2.2800, 2.3800, 2.2700, 2.2700, 2.3900, 2.1100,
                                    2.0900, 2.1000, 2.0600, 2.1200, 2.0800, 2.0000, 1.9300, 2.0200, 2.5500, 1.5400,
                                    1.6400, 1.5100, 1.5500, 2.8200, 2.9200, 2.5500, 2.3700, 1.8500, 1.6000, 1.7200,
                                    1.7400, 1.7900, 1.9000, 1.9400, 2.0000, 2.0400, 2.0800, 2.1200, 2.1300, 2.1600,
                                    2.1800, 2.1800, 2.2000, 2.2000, 2.4100, 2.3900, 2.3800, 2.4000, 2.4200, 2.4100,
                                    2.4300, 2.4500, 2.4300, 2.4500, 2.4300, 2.4000, 2.4400, 2.4000, 2.4200, 2.4300,
                                    2.4500, 2.4500, 2.4500, 2.4600, 2.4500, 2.4500, 2.4300, 2.5100, 2.4800, 2.4800,
                                    2.5300, 2.4600, 2.4900, 2.5000, 2.5000, 2.5000, 2.5200, 2.5200, 2.5400, 2.5000,
                                    2.4800, 2.5000, 2.5500, 2.5000, 2.4800, 2.5000, 2.5000, 2.5200, 2.5200, 2.4800,
                                    2.5000, 2.5000, 2.5200, 2.4600, 2.5300, 9.0000 ]
      #  Wavenumber Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: 7024, 7027, 7029, 7032, 7038, 7043, 7046, 7049, 7069, 7072,
                    7076, 7081, 7084, 7089, 7099, 7209, 7222, 7231, 7235, 7247,
                    7267, 7269, 7284, 7389, 7419, 7423, 7424, 7426, 7428, 7431,
                    7436, 7444, 7475, 7549, 7584, 7665, 7666, 7831, 7836, 7853,
                    7865, 7885, 7888, 7912, 7950, 7972, 7980, 7995, 8007, 8015,
                    8055, 8078
        where:
        - variable:
            name: MetaData/solarZenithAngle
          maxvalue: 88.9999
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 1.0e-12
        action:
          name: reject
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorWavenumIR
            channels: *iasi_metop-c_channels
            options:
              channels: *iasi_metop-c_channels
      #  Observation Range Sanity Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        minvalue: 50.00001
        maxvalue: 549.99999
        action:
          name: reject
      #  Topography Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTopoRad
            channels: *iasi_metop-c_channels
            options:
              channels: *iasi_metop-c_channels
              sensor: *Sensor_ID
      #  Transmittance Top Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTransmitTopRad
            channels: *iasi_metop-c_channels
            options:
              channels: *iasi_metop-c_channels
      #  Cloud Detection Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        test variables:
        - name: ObsFunction/CloudDetectMinResidualIR
          channels: *iasi_metop-c_channels
          options:
            channels: *iasi_metop-c_channels
            use_flag: &useflag_iasi_metop-c [ 1, -1, -1, -1,  1, -1, -1, -1,  1, -1,
                          1, -1,  1, -1,  1,  1,  1, -1,  1,  1,
                         -1,  1,  1,  1, -1, -1,  1,  1, -1,  1,
                         -1,  1, -1,  1, -1, -1, -1, -1, -1, -1,
                         -1, -1,  1,  1,  1, -1,  1,  1,  1,  1,
                          1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
                          1, -1,  1,  1,  1,  1, -1,  1,  1,  1,
                          1,  1,  1, -1,  1,  1,  1, -1,  1, -1,
                          1, -1, -1, -1,  1,  1,  1,  1, -1,  1,
                          1, -1,  1,  1,  1, -1,  1, -1,  1, -1,
                          1,  1, -1,  1,  1,  1,  1,  1,  1, -1,
                          1,  1, -1, -1, -1,  1, -1,  1, -1,  1,
                          1,  1, -1,  1,  1, -1, -1, -1,  1, -1,
                          1,  1, -1,  1,  1,  1,  1,  1,  1,  1,
                         -1,  1,  1, -1,  1,  1,  1,  1,  1,  1,
                          1,  1,  1,  1,  1, -1,  1, -1,  1, -1,
                          1,  1, -1, -1,  1,  1,  1, -1,  1,  1,
                         -1,  1, -1,  1, -1, -1, -1, -1, -1,  1,
                          1,  1,  1,  1,  1,  1, -1, -1, -1, -1,
                          1,  1,  1, -1, -1,  1, -1,  1,  1,  1,
                          1,  1, -1, -1,  1,  1, -1,  1,  1, -1,
                          1, -1, -1, -1, -1, -1, -1,  1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1,  1, -1, -1, -1, -1, -1,
                         -1, -1, -1,  1, -1,  1, -1, -1,  1, -1,
                          1, -1, -1, -1, -1,  1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                         -1, -1, -1, -1, -1, -1]
            use_flag_clddet: &clddet_iasi_metop-c [ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 31, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 31,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 31, 1, 1, 1, 1, 1,
                                 1, 1, 1, 31, 1, 31, 1, 1, 31, 1,
                                31, 1, 1, 1, 1, 31, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                                 1, 1, 1, 1, 1, 1]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
      #  NSST Retrieval Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        test variables:
        - name: ObsFunction/NearSSTRetCheckIR
          channels: *iasi_metop-c_channels
          options:
            channels: *iasi_metop-c_channels
            use_flag: *useflag_iasi_metop-c
            obserr_demisf: [0.01,0.02,0.03,0.02,0.03]
            obserr_dtempf: [0.50,2.00,4.00,2.00,4.00]
        maxvalue: 1.0e-12
        action:
          name: reject
      #  Surface Jacobians Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorSurfJacobianRad
            channels: *iasi_metop-c_channels
            options:
              channels: *iasi_metop-c_channels
              sensor: *Sensor_ID
              obserr_demisf: [0.01, 0.02, 0.03, 0.02, 0.03]
              obserr_dtempf: [0.50, 2.00, 4.00, 2.00, 4.00]
      #  Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        function absolute threshold:
        - name: ObsFunction/ObsErrorBoundIR
          channels: *iasi_metop-c_channels
          options:
            channels: *iasi_metop-c_channels
            obserr_bound_latitude:
              name: ObsFunction/ObsErrorFactorLatRad
              options:
                latitude_parameters: [25.0, 0.5, 0.04, 1.0]
            obserr_bound_transmittop:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *iasi_metop-c_channels
              options:
                channels: *iasi_metop-c_channels
            obserr_bound_max: [ 3.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 4.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 4.00, 4.00,
                                3.50, 2.50, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00, 0.75, 2.00,
                                0.75, 2.00, 2.00, 2.00, 0.75, 0.75, 0.75, 0.75, 2.00, 0.75,
                                0.75, 2.00, 0.75, 0.75, 2.00, 2.00, 2.00, 2.00, 2.00, 2.00,
                                2.00, 2.00, 2.00, 2.00, 2.50, 2.00, 2.50, 2.50, 3.00, 2.50,
                                2.50, 2.50, 2.50, 3.50, 2.50, 2.50, 3.00, 3.50, 3.00, 4.00,
                                4.00, 0.75, 4.00, 4.00, 4.00, 4.50, 4.50, 4.50, 4.50, 4.50,
                                4.00, 4.50, 4.00, 4.00, 4.50, 2.50, 3.00, 2.50, 3.00, 2.50,
                                3.00, 2.00, 2.50, 2.50, 3.00, 3.00, 2.50, 3.00, 3.00, 3.00,
                                2.50, 2.50, 4.00, 4.50, 4.50, 5.00, 4.00, 4.00, 5.00, 5.00,
                                5.00, 5.00, 5.50, 5.50, 4.00, 5.00, 4.00, 4.50, 5.50, 5.50,
                                6.00, 4.50, 4.50, 4.00, 5.00, 5.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 1.25, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 1.25,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 1.50, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 1.40, 6.00, 1.40, 6.00, 6.00, 1.40, 6.00,
                                1.50, 6.00, 6.00, 6.00, 6.00, 1.50, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 5.50, 4.50, 6.00,
                                5.00, 5.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 5.00, 6.00,
                                6.00, 6.00, 4.00, 6.00, 6.00, 6.00, 6.00, 4.50, 6.00, 6.00,
                                4.50, 6.00, 6.00, 6.00, 6.00, 6.00, 5.00, 6.00, 6.00, 6.00,
                                5.00, 6.00, 6.00, 5.00, 6.00, 5.00, 6.00, 6.00, 6.00, 5.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00, 6.00,
                                6.00, 6.00, 6.00, 6.00, 6.00, 6.00 ]
        action:
          name: reject
      #  Surface Type Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        test variables:
        - name: SurfTypeCheckRad@ObsFunction
          channels: *iasi_metop-c_channels
          options:
            channels: *iasi_metop-c_channels
            use_flag: *useflag_iasi_metop-c
            use_flag_clddet: *clddet_iasi_metop-c
        maxvalue: 1.0e-12
        defer to post: true
        action:
          name: reject
      #  Useflag Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *iasi_metop-c_channels
        test variables:
        - name: ObsFunction/ChannelUseflagCheckRad
          channels: *iasi_metop-c_channels
          options:
            channels: *iasi_metop-c_channels
            use_flag: *useflag_iasi_metop-c
        minvalue: 1.0e-12
        action:
          name: reject

####################################################
##  OBSYS-ON: MHS-Metop-B
####################################################
    - obs space:
        name: &Sensor_ID mhs_metop-b
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/mhs_metop-b.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/mhs_metop-b.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &mhs_metop-b_channels 1-5
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        Clouds: [Water, Ice, Rain, Snow]
        Cloud_Fraction: 1.0
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
          Clouds: [Water]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &mhs_metop-b_satbias 'Data/obs/mhs_metop-b.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/mhs_metop-b.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variational bc:
          predictors:
          - name: constant
          - name: lapse_rate
            order: 2
            tlapse: &mhs_metop-b_tlapse 'Data/obs/mhs_metop-b.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *mhs_metop-b_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *mhs_metop-b_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/mhs_metop-b.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        minvalue: 50.0
        maxvalue: 550.0
      - filter: Domain Check
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        where:
        - variable:
            name: MetaData/sensorScanPosition
          minvalue: 10
          maxvalue: 81
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: 1-3
        where:
        - variable:
            name: MetaData/latitude
          minvalue: -25.0
          maxvalue: -10.0
        - variable:
            name: MetaData/longitude
          minvalue: 260.0
          maxvalue: 300.0
        action:
          name: reject
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        where:
        - variable:
            name: GeoVaLs/surface_snow_area_fraction
          minvalue: 0.01
      # ice surface
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        where:
        - variable:
            name: GeoVaLs/ice_area_fraction
          minvalue: 0.01
      # mixed surface
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          maxvalue: 0.99
        - variable:
            name: GeoVaLs/land_area_fraction
          maxvalue: 0.99
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 0.99
        - variable:
            name: GeoVaLs/average_surface_temperature_within_field_of_view
          maxvalue: 275
#     - filter: BlackList
#       filter variables:
#       - name: brightnessTemperature
#         channels: *mhs_metop-b_channels
#       where:
#       - variable:
#           name: GeoVaLs/water_area_fraction
#         maxvalue: 0.99
#       action:
#         name: assign error
#         error function:
#           name: ObsFunction/ObsErrorModelRamp
#           channels: *mhs_metop-b_channels
#           options:
#             channels: *mhs_metop-b_channels
#             xvar:
#               name: ObsFunction/CLWRetSymmetricMW
#               options:
#                 clwret_ch89v: 1
#                 clwret_ch166v: 2
#                 clwret_types: [ObsValue, HofX]
#                 bias_application: HofX
#                 test_bias: ObsBiasData
#             x0:    [ 0.050,  0.050,  0.050,
#                      0.050,  0.050]
#             x1:    [ 25.00,  25.00,  25.00,
#                      25.00,  25.00]
#             err0:  [300.00, 300.00,  2.500,
#                      2.000,  2.000]
#             err1:  [700.00,  700.00, 30.00,
#                      50.00,  60.00]
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 0.99
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelRamp
            channels: *mhs_metop-b_channels
            options:
              channels: *mhs_metop-b_channels
              xvar:
                name: ObsFunction/CLWRetSymmetricMW
                options:
                  clwret_ch89v: 1
                  clwret_ch166v: 2
                  clwret_types: [ObsValue, HofX]
                  bias_application: HofX
                  test_bias: ObsBiasData
              x0:    [ 0.050,  0.050,  0.050,
                       0.050,  0.050]
              x1:    [ 25.00,  25.00,  25.00,
                       25.00,  25.00]
              err0:  [300.00, 300.00,  2.500,
                       2.000,  2.000]
              err1:  [350.00,  350.00, 15.00,
                       25.00,  30.00]
      #Topography check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTopoRad
            channels: *mhs_metop-b_channels
            options:
              sensor: *Sensor_ID
              channels: *mhs_metop-b_channels
      #Transmittnace Top Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTransmitTopRad
            channels: *mhs_metop-b_channels
            options:
              channels: *mhs_metop-b_channels
      #Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          maxvalue: 0.99
        function absolute threshold:
        - name: ObsFunction/ObsErrorBoundMW
          channels: *mhs_metop-b_channels
          options:
            sensor: *Sensor_ID
            channels: *mhs_metop-b_channels
            threshold: 2.0
            obserr_bound_latitude:
              name: ObsFunction/ObsErrorFactorLatRad
              options:
                latitude_parameters: [0.0, 1.0, 0.0, 1.0]
            obserr_bound_transmittop:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *mhs_metop-b_channels
              options:
                channels: *mhs_metop-b_channels
            obserr_bound_topo:
              name: ObsFunction/ObsErrorFactorTopoRad
              channels: *mhs_metop-b_channels
              options:
                channels: *mhs_metop-b_channels
                sensor: *Sensor_ID
            obserr_function:
              name: ObsFunction/ObsErrorModelRamp
              channels: *mhs_metop-b_channels
              options:
                channels: *mhs_metop-b_channels
                xvar:
                  name: ObsFunction/CLWRetSymmetricMW
                  options:
                    clwret_ch89v: 1
                    clwret_ch166v: 2
                    clwret_types: [ObsValue, HofX]
                    bias_application: HofX
                x0:    [ 0.050,  0.050,  0.050,
                         0.050,  0.050]
                x1:    [ 25.00,  25.00,  25.00,
                         25.00,  25.00]
                err0:  [300.00, 300.00,  2.500,
                         2.000,  2.000]
                err1:  [700.00,  700.00, 30.00,
                         50.00,  60.00]
            obserr_bound_max: [5.0, 5.0, 10.0, 10.0, 10.0]
        action:
          name: reject
      #Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-b_channels
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 0.99
        function absolute threshold:
        - name: ObsFunction/ObsErrorBoundMW
          channels: *mhs_metop-b_channels
          options:
            sensor: *Sensor_ID
            channels: *mhs_metop-b_channels
            threshold: 2.0
            obserr_bound_latitude:
              name: ObsFunction/ObsErrorFactorLatRad
              options:
                latitude_parameters: [0.0, 1.0, 0.0, 1.0]
            obserr_bound_transmittop:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *mhs_metop-b_channels
              options:
                channels: *mhs_metop-b_channels
            obserr_bound_topo:
              name: ObsFunction/ObsErrorFactorTopoRad
              channels: *mhs_metop-b_channels
              options:
                channels: *mhs_metop-b_channels
                sensor: *Sensor_ID
            obserr_function:
              name: ObsFunction/ObsErrorModelRamp
              channels: *mhs_metop-b_channels
              options:
                channels: *mhs_metop-b_channels
                xvar:
                  name: ObsFunction/CLWRetSymmetricMW
                  options:
                    clwret_ch89v: 1
                    clwret_ch166v: 2
                    clwret_types: [ObsValue, HofX]
                    bias_application: HofX
                x0:    [ 0.050,  0.050,  0.050,
                         0.050,  0.050]
                x1:    [ 25.00,  25.00,  25.00,
                         25.00,  25.00]
                err0:  [300.00, 300.00,  2.500,
                         2.000,  2.000]
                err1:  [350.00,  350.00, 15.00,
                         25.00,  30.00]
            obserr_bound_max: [5.0, 5.0, 10.0, 10.0, 10.0]
        action:
          name: reject
     # Assign obs error
#     - filter: Perform Action
#       filter variables:
#       - name: brightnessTemperature
#         channels: *mhs_metop-b_channels
#       action:
#         name: assign error
#         error parameter vector: 
#                     [300.000,  300.000,  2.500, 
#                        2.000,  2.000]


####################################################
##  OBSYS-ON: MHS-Metop-C
####################################################
    - obs space:
        name: &Sensor_ID mhs_metop-c
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/mhs_metop-c.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/mhs_metop-c.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &mhs_metop-c_channels 1-5
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        Clouds: [Water, Ice, Rain, Snow]
        Cloud_Fraction: 1.0
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
          Clouds: [Water]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &mhs_metop-c_satbias 'Data/obs/mhs_metop-c.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        output file: 'Data/vbc/mhs_metop-c.$PYYYYYMMDDTHH0000Z.satbias.nc4'
        variational bc:
          predictors:
          - name: constant
          - name: lapse_rate
            order: 2
            tlapse: &mhs_metop-c_tlapse 'Data/obs/mhs_metop-c.$PYYYYYMMDDTHH0000Z.tlapse.txt'
          - name: lapse_rate
            tlapse: *mhs_metop-c_tlapse
          - name: emissivity
          - name: scan_angle
            order: 4
          - name: scan_angle
            order: 3
          - name: scan_angle
            order: 2
          - name: scan_angle
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *mhs_metop-c_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/mhs_metop-c.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs filters:
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        minvalue: 50.0
        maxvalue: 550.0
      - filter: Domain Check
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        where:
        - variable:
            name: MetaData/sensorScanPosition
          minvalue: 10
          maxvalue: 81
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: 1-3
        where:
        - variable:
            name: MetaData/latitude
          minvalue: -25.0
          maxvalue: -10.0
        - variable:
            name: MetaData/longitude
          minvalue: 260.0
          maxvalue: 300.0
        action:
          name: reject
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        where:
        - variable:
            name: GeoVaLs/surface_snow_area_fraction
          minvalue: 0.01
      # ice surface
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        where:
        - variable:
            name: GeoVaLs/ice_area_fraction
          minvalue: 0.01
      # mixed surface
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          maxvalue: 0.99
        - variable:
            name: GeoVaLs/land_area_fraction
          maxvalue: 0.99
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 0.99
        - variable:
            name: GeoVaLs/average_surface_temperature_within_field_of_view
          maxvalue: 275
#     - filter: BlackList
#       filter variables:
#       - name: brightnessTemperature
#         channels: *mhs_metop-c_channels
#       where:
#       - variable:
#           name: GeoVaLs/water_area_fraction
#         maxvalue: 0.99
#       action:
#         name: assign error
#         error function:
#           name: ObsFunction/ObsErrorModelRamp
#           channels: *mhs_metop-c_channels
#           options:
#             channels: *mhs_metop-c_channels
#             xvar:
#               name: ObsFunction/CLWRetSymmetricMW
#               options:
#                 clwret_ch89v: 1
#                 clwret_ch166v: 2
#                 clwret_types: [ObsValue, HofX]
#                 bias_application: HofX
#                 test_bias: ObsBiasData
#             x0:    [ 0.050,  0.050,  0.050,
#                      0.050,  0.050]
#             x1:    [ 25.00,  25.00,  25.00,
#                      25.00,  25.00]
#             err0:  [300.00, 300.00,  2.500,
#                      2.000,  2.000]
#             err1:  [700.00,  700.00, 30.00,
#                      50.00,  60.00]
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 0.99
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelRamp
            channels: *mhs_metop-c_channels
            options:
              channels: *mhs_metop-c_channels
              xvar:
                name: ObsFunction/CLWRetSymmetricMW
                options:
                  clwret_ch89v: 1
                  clwret_ch166v: 2
                  clwret_types: [ObsValue, HofX]
                  bias_application: HofX
                  test_bias: ObsBiasData
              x0:    [ 0.050,  0.050,  0.050,
                       0.050,  0.050]
              x1:    [ 25.00,  25.00,  25.00,
                       25.00,  25.00]
              err0:  [300.00, 300.00,  2.500,
                       2.000,  2.000]
              err1:  [350.00,  350.00, 15.00,
                       25.00,  30.00]
      #Topography check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTopoRad
            channels: *mhs_metop-c_channels
            options:
              sensor: *Sensor_ID
              channels: *mhs_metop-c_channels
      #Transmittnace Top Check
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorTransmitTopRad
            channels: *mhs_metop-c_channels
            options:
              channels: *mhs_metop-c_channels
      #Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          maxvalue: 0.99
        function absolute threshold:
        - name: ObsFunction/ObsErrorBoundMW
          channels: *mhs_metop-c_channels
          options:
            sensor: *Sensor_ID
            channels: *mhs_metop-c_channels
            threshold: 2.0
            obserr_bound_latitude:
              name: ObsFunction/ObsErrorFactorLatRad
              options:
                latitude_parameters: [0.0, 1.0, 0.0, 1.0]
            obserr_bound_transmittop:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *mhs_metop-c_channels
              options:
                channels: *mhs_metop-c_channels
            obserr_bound_topo:
              name: ObsFunction/ObsErrorFactorTopoRad
              channels: *mhs_metop-c_channels
              options:
                channels: *mhs_metop-c_channels
                sensor: *Sensor_ID
            obserr_function:
              name: ObsFunction/ObsErrorModelRamp
              channels: *mhs_metop-c_channels
              options:
                channels: *mhs_metop-c_channels
                xvar:
                  name: ObsFunction/CLWRetSymmetricMW
                  options:
                    clwret_ch89v: 1
                    clwret_ch166v: 2
                    clwret_types: [ObsValue, HofX]
                    bias_application: HofX
                x0:    [ 0.050,  0.050,  0.050,
                         0.050,  0.050]
                x1:    [ 25.00,  25.00,  25.00,
                         25.00,  25.00]
                err0:  [300.00, 300.00,  2.500,
                         2.000,  2.000]
                err1:  [700.00,  700.00, 30.00,
                         50.00,  60.00]
            obserr_bound_max: [5.0, 5.0, 10.0, 10.0, 10.0]
        action:
          name: reject
      #Gross check
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *mhs_metop-c_channels
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          minvalue: 0.99
        function absolute threshold:
        - name: ObsFunction/ObsErrorBoundMW
          channels: *mhs_metop-c_channels
          options:
            sensor: *Sensor_ID
            channels: *mhs_metop-c_channels
            threshold: 2.0
            obserr_bound_latitude:
              name: ObsFunction/ObsErrorFactorLatRad
              options:
                latitude_parameters: [0.0, 1.0, 0.0, 1.0]
            obserr_bound_transmittop:
              name: ObsFunction/ObsErrorFactorTransmitTopRad
              channels: *mhs_metop-c_channels
              options:
                channels: *mhs_metop-c_channels
            obserr_bound_topo:
              name: ObsFunction/ObsErrorFactorTopoRad
              channels: *mhs_metop-c_channels
              options:
                channels: *mhs_metop-c_channels
                sensor: *Sensor_ID
            obserr_function:
              name: ObsFunction/ObsErrorModelRamp
              channels: *mhs_metop-c_channels
              options:
                channels: *mhs_metop-c_channels
                xvar:
                  name: ObsFunction/CLWRetSymmetricMW
                  options:
                    clwret_ch89v: 1
                    clwret_ch166v: 2
                    clwret_types: [ObsValue, HofX]
                    bias_application: HofX
                x0:    [ 0.050,  0.050,  0.050,
                         0.050,  0.050]
                x1:    [ 25.00,  25.00,  25.00,
                         25.00,  25.00]
                err0:  [300.00, 300.00,  2.500,
                         2.000,  2.000]
                err1:  [350.00,  350.00, 15.00,
                         25.00,  30.00]
            obserr_bound_max: [5.0, 5.0, 10.0, 10.0, 10.0]
        action:
          name: reject
     # Assign obs error
#     - filter: Perform Action
#       filter variables:
#       - name: brightnessTemperature
#         channels: *mhs_metop-c_channels
#       action:
#         name: assign error
#         error parameter vector: 
#                     [300.000,  300.000,  2.500, 
#                        2.000,  2.000]

####################################################
##  OBSYS-OFF: MHS-N19
####################################################
 
####################################################
##  OBSYS-OFF: OMI-AURA
####################################################
#   - obs space:
#       name: omi_aura
#       obsdatain:
#         engine:
#           type: H5File
#           obsfile: Data/obs/omi_aura.$BYYYYYMMDDTHH0000Z.nc4
#       obsdataout:
#         engine:
#           type: H5File
#           obsfile: Data/hofx/omi_aura.$BYYYYYMMDDTHH0000Z.nc4
#       simulated variables: [ozoneTotal]
#     obs operator:
#       name: AtmVertInterpLay
#       observation alias file: /gpfsm/dnb05/projects/p139/rtodling/JEDI/j48rt3/../fvwork.36827/jedi.20211201.060000/swell/swell-geosadas/configuration/jedi/interfaces/geos_atmosphere/observations/obsop_name_map.yaml
#       geovals: [mole_fraction_of_ozone_in_air]
#       geovals: [mole_fraction_of_ozone_in_air]
#       coefficients: [0.007886131] # convert from ppmv to DU
#       nlevels: [1]
#     obs filters:
#     - filter: Perform Action
#       filter variables:
#       - name: ozoneTotal
#       action:
#         name: assign error
#         error parameter: 6.0
#      # range sanity check
#     - filter: Bounds Check
#       filter variables:
#       - name: ozoneTotal
#       minvalue: 0
#       maxvalue: 1000
#       action:
#         name: reject
#     # Reject SZA > 84
#     - filter: Bounds Check
#       filter variables:
#       - name: ozoneTotal
#       test variables:
#       - name: MetaData/solarZenithAngle
#       maxvalue: 84.
#       action:
#         name: reject
##    # Reject rows 25+ (somewhat stringent but thats what we do in GEOS)
##    - filter: Bounds Check
##      filter variables:
##      - name: ozoneTotal
##      test variables:
##      - name: MetaData/scanPosition
##      minvalue: 3
##      maxvalue: 24
##      action:
##        name: reject     
##    # Gross check
##    - filter: Background Check
##      filter variables:
##      - name: ozoneTotal
##      threshold: 5.0
##      action:
##        name: reject
 

####################################################
##  OBSYS-OFF: OMPS-NPP
####################################################
#   - obs space:
#       name: ompsnm_npp
#       obsdatain:
#         engine:
#           type: H5File
#           obsfile: Data/obs/ompsnm_npp.$BYYYYYMMDDTHH0000Z.nc4
#       obsdataout:
#         engine:
#           type: H5File
#           obsfile: Data/hofx/ompsnm_npp.$BYYYYYMMDDTHH0000Z.nc4
#       simulated variables: [ozoneTotal]
#     obs operator:
#       name: AtmVertInterpLay
#       observation alias file: /gpfsm/dnb05/projects/p139/rtodling/JEDI/j48rt3/../fvwork.36827/jedi.20211201.060000/swell/swell-geosadas/configuration/jedi/interfaces/geos_atmosphere/observations/obsop_name_map.yaml
#       geovals: [mole_fraction_of_ozone_in_air]
#       coefficients: [0.007886131] # convert from ppmv to DU
#       nlevels: [1]
#     obs filters:
#     - filter: Perform Action
#       filter variables:
#       - name: ozoneTotal
#       action:
#         name: assign error
#         error parameter: 6.0
#     # range sanity check
#     - filter: Bounds Check
#       filter variables:
#       - name: ozoneTotal
#       minvalue: 0
#       maxvalue: 1000
#       action:
#         name: reject
     # Reject SZA > 84
##    - filter: Bounds Check
##      filter variables:
##      - name: ozoneTotal
##      test variables:
##      - name: MetaData/solarZenithAngle
##      maxvalue: 84.
##      action:
##        name: reject
##    # Gross check
##    - filter: Background Check
##      filter variables:
##      - name: ozoneTotal
##      threshold: 5.0
##      action:
##        name: reject  

####################################################
##  OBSYS-OFF: PIBAL
####################################################
 
####################################################
##  OBSYS-ON: satwind
####################################################
    - obs space:
        name: satwind
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/satwind.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/satwind.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [windEastward, windNorthward]
      obs operator:
        name: VertInterp
        observation alias file: Config/obsop_name_map.yaml
        apply near surface wind scaling: true
      obs filters:
      #
      # Reject all obs with PreQC mark already set above 3
      - filter: PreQC
        maxvalue: 3
        action:
          name: reject
      
      - filter: Perform Action
        filter variables:
        - name: windEastward
        where:
        - variable: PreUseFlag/windEastward
          is_in: 100
        action:
          name: reject
      
      - filter: Perform Action
        filter variables:
        - name: windNorthward
        where:
        - variable: PreUseFlag/windNorthward
          is_in: 100
        action:
          name: reject
      #
      # Assign the initial observation error, based on height/pressure add back
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [100000, 95000, 80000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
              errors: [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]
      
      #   #Blacklist Obstypes that aren't used in GSI
      - filter: BlackList
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 240, 241, 248, 249, 251, 255, 256, 260
      
      
      # Assign the initial observation error, based on height/pressure kx = 244
      # reject pressure levels = [110000, 105000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
              errors: [5.9, 5.9, 5.9, 5.9, 5.45, 5, 5, 5, 5.075, 5.175, 5.3, 5.675, 6.05, 6.25, 6.625, 7, 7, 7, 7]
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 244
      
        # Assign the initial observation error, based on height/pressure
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]   #Pressure (Pa)
              errors: [3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.9, 3.9, 4.0, 4.0, 4.1, 5, 6, 6.3, 6.6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7]
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 245, 246
      
      # Assign the initial observation error, based on height/pressure
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]   #Pressure (Pa)
              errors: [3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.9, 3.9, 4.0, 4.0, 4.1, 5, 6, 6.3, 6.6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7]
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 242, 243, 247, 252, 253
      
      # Assign the initial observation error, based on height/pressure
      # kx = 254
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]   #Pressure (Pa)
              errors: [3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.9, 3.9, 4.0, 4.5, 6.1, 6.0, 6.5, 7.3, 7.6, 7, 7.5, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7]
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 254
      
      # Assign the initial observation error, based on height/pressure
      # kx = 250
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]   #Pressure (Pa)
              errors: [3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.9, 3.9, 4.0, 4.0, 4.1, 5.0, 7, 7.3, 7.6, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8]
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 250
      
      # Assign the initial observation error, based on height/pressure kx = 257
      # reject [110000, 105000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
              errors: [5.9, 5.9, 5.9, 5.9, 5.9, 5.9, 5.9, 5.9, 5.675, 5.45, 5.525, 5.8, 6.275, 6.575, 6.825, 7.05, 7.05, 7.05, 7.05]
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 257
      
      # Assign the initial observation error, based on height/pressure kx = 258
      # reject = [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
              errors: [6.05, 5.625, 5.275, 5.375, 5.925, 6.475, 6.775, 7.05, 7.05, 7.05, 7.05]
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 258
      
      # Assign the initial observation error, based on height/pressure kx = 257
      # reject [110000, 105000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
      - filter: Perform Action
        filter variables:
        - name: windEastward
        - name: windNorthward
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
              errors: [6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6, 5.5, 5.5, 5.575, 6.025, 6.4, 6.775, 7.15, 7.15, 7.15, 7.15]
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 259

      - filter: Difference Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        reference: GeoVaLs/surface_pressure
        value: MetaData/pressure
        maxvalue: -11000
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 247
        - variable:
            name: MetaData/surfaceQualifier
          minvalue: 1

      - filter: Difference Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        reference: GeoVaLs/surface_pressure
        value: MetaData/pressure
        maxvalue: -20000
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 244, 257, 258, 259, 260
        - variable:
            name: MetaData/surfaceQualifier
          minvalue: 1
      
      # GOES WV (non-cloudy; itype=247) reject when difference of wind direction is more than 50 degrees.
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        test variables:
        - name: ObsFunction/WindDirAngleDiff
        maxvalue: 50.0
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 247
        action:
          name: reject
      
      # AVHRR (244), MODIS (257,258,259), VIIRS (260), GOES (247) use a LNVD check.
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        test variables:
        - name: ObsFunction/SatWindsLNVDCheck
        maxvalue: 3
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 244, 247, 257-260
        action:
          name: reject
      
      - filter: BlackList
        filter variables:
        - name: windEastward
        where:
          - variable:
              name: ObsType/windEastward
            is_in: 240-260
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: windEastward
              inflation factor: 4
              adjusted_error_name: GsiAdjustObsError
              geovar_sfc_geomz: surface_geometric_height
      
      - filter: BlackList
        filter variables:
        - name: windNorthward
        where:
          - variable:
              name: ObsType/windNorthward
            is_in: 240-260
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: windNorthward
              inflation factor: 4
              adjusted_error_name: GsiAdjustObsError
              geovar_sfc_geomz: surface_geometric_height
      
      # Gross Check
      - filter: Background Check
        filter variables:
        - name: windEastward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            error_min: [  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,
                          1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4]
            error_max: [  6.1,  6.1, 15.0, 15.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0,
                          20.0, 20.0, 20.0, 20.0, 20.0, 20.1, 20.1, 20.1, 20.1, 20.1]
            cgross:    [  2.5,  2.5,  2.5,  1.5,  2.5,  2.5,  2.5,  2.5,  2.5,  2.5,
                          2.5,  1.3,  2.5,  1.5,  1.5,  2.5,  2.5,  2.5,  2.5,  2.5]
            wndtype:  [  240,  241,  242,  243,  244,  245,  246,  247,  248,  249,
                          250,  251,  252,  253,  254,  256,  257,  258,  259,  260]
            variable: windEastward
        action:
          name: reject
      
      - filter: Background Check
        filter variables:
        - name: windNorthward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            cgross:     [  2.5,  2.5,  2.5,  1.5,  2.5,  2.5,  2.5,  2.5,  2.5,  2.5,
                            2.5,  1.3,  2.5,  1.5,  1.5,  2.5,  2.5,  2.5,  2.5,  2.5]
            error_min:  [  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,
                            1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4]
            error_max:  [  6.1,  6.1, 15.0, 15.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0,
                          20.0, 20.0, 20.0, 20.0, 20.0, 20.1, 20.1, 20.1, 20.1, 20.1]
            wndtype:  [  240,  241,  242,  243,  244,  245,  246,  247,  248,  249,
                          250,  251,  252,  253,  254,  256,  257,  258,  259,  260]
            variable: windNorthward
        action:
          name: reject
      
      - filter: BlackList
        filter variables:
        - name: windEastward
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: true
              variable: windEastward
        where:
        - variable:
            name: ObsType/windEastward
          is_in:  240-260
        defer to post: true
      
      - filter: BlackList
        filter variables:
        - name: windNorthward
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: true
              variable: windNorthward
        where:
        - variable:
            name: ObsType/windNorthward
          is_in:  240-260
        defer to post: true
      
####################################################
##  OBSYS-ON: Scatwind
####################################################
    - obs space:
        name: Scatwind
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/scatwind.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/scatwind.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [windEastward, windNorthward]
      obs operator:
        name: Composite
        components:
        - name: VertInterp
          variables:
          - name: windEastward
          - name: windNorthward
          apply near surface wind scaling: true
      linear obs operator:
        name: Composite
        components:
        - name: VertInterp
          variables:
          - name: windEastward
          - name: windNorthward
      obs error:
        covariance model: diagonal
      obs filters:
#     - filter: PreQC
#       maxvalue: 4
#     - filter: Perform Action
#       filter variables: [windEastward]
#       action:
#         name: assign error
#         error function:
#           name: GsiFinalObsError/windEastward
#     - filter: Perform Action
#       filter variables: [windNorthward]
#       action:
#         name: assign error
#         error function:
#           name: GsiFinalObsError/windNorthward
 
      #
      # Reject all obs with PreQC mark already set above 3
      #- filter: PreQC
      #  maxvalue: 3
      #  action:
      #    name: reject
      #
      # Assign the initial observation error, based on height/pressure
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        minvalue: -135
        maxvalue: 135
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000,
                        60000,  55000,  50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000,
                        10000,   7500,   5000,  4000,  3000,  2000,  1000]   #Pressure (Pa)
              errors: [2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                        2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0,
                        2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0]
      #
      - filter: Perform Action
        filter variables:
        - name: windEastward
        where:
        - variable: PreUseFlag/windEastward
          is_in: 100
        action:
          name: reject
      #
      - filter: Perform Action
        filter variables:
        - name: windNorthward
        where:
        - variable: PreUseFlag/windNorthward
          is_in: 100
        action:
          name: reject
      #
      #wgu
      - filter: BlackList
        filter variables:
        - name: windEastward
        where:
          - variable:
              name: ObsType/windEastward
            is_in: 290
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: windEastward
              inflation factor: 4.0
              adjusted_error_name: GsiAdjustObsError
              geovar_sfc_geomz: surface_geometric_height
      #
      - filter: BlackList
        filter variables:
        - name: windNorthward
        where:
          - variable:
              name: ObsType/windNorthward
            is_in: 290
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: windNorthward
              inflation factor: 4.0
              adjusted_error_name: GsiAdjustObsError
              geovar_sfc_geomz: surface_geometric_height
      #
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        test variables:
        - name: ObsFunction/ScatWindsAmbiguityCheck
        maxvalue: 1.e-12
        where:
        - variable:
            name: ObsType/windEastward
          is_in: 290
        action:
          name: reject
      
      # Bounds checks. Filter U obs if |v_O-F| > 5, and V obs if |u_O-F| > 5.
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        test variables:
        - name: ObsFunction/Arithmetic
          options:
            variables:
            - name: ObsValue/windEastward
            - name: HofX/windEastward
            coefs: [1.0, -1.0]
        minvalue: -5.0
        maxvalue: 5.0
      #
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        test variables:
        - name: ObsFunction/Arithmetic
          options:
            variables:
            - name: ObsValue/windNorthward
            - name: HofX/windNorthward
            coefs: [1.0, -1.0]
        minvalue: -5.0
        maxvalue: 5.0
      #
      # Gross Check
      - filter: Background Check
        filter variables:
        - name: windEastward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            wndtype: [ 290 ]
            cgross:     [ 5.0 ]
            error_min:  [ 1.4 ]
            error_max:  [ 6.1 ]
            variable: windEastward
        action:
          name: reject
        defer to post: true
      #
      - filter: Background Check
        filter variables:
        - name: windNorthward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            wndtype: [ 290 ]
            cgross:     [ 5.0 ]
            error_min:  [ 1.4 ]
            error_max:  [ 6.1 ]
            variable: windNorthward
        action:
          name: reject
        defer to post: true


####################################################
##  OBSYS-ON: SFC Land
####################################################
    - obs space:
        name: Surface Land Stations
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/sfc.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/sfc.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [windEastward, windNorthward, virtualTemperature, airTemperature,
                              specificHumidity, stationPressure]
      
      obs operator:
        name: Composite
        components:
      
         # Wind fields are handled using wind reduction factor applied to the lowest level.
         - name: Product
           geovals to scale hofx by: wind_reduction_factor_at_10m
           variables:
           - name: windEastward
           - name: windNorthward
      
         # Temperatures use vertical interpolation
         - name: VertInterp
           observation alias file: Config/obsop_name_map.yaml
           apply near surface wind scaling: true
           variables:
           - name: airTemperature
           - name: virtualTemperature
      
         # Surface pressure is handled using the correction scheme
         - name: SfcPCorrected
           variables:
           - name: stationPressure
           da_psfc_scheme: GSI
           geovar_geomz: geopotential_height
           geovar_sfc_geomz: surface_geometric_height
           station_altitude: height
      
         # Specific humidity is using the lowest model level (identity)
         - name: Identity
           observation alias file: Config/obsop_name_map.yaml
           variables:
           - name: specificHumidity

      linear obs operator:
        name: Identity
      obs error:
        covariance model: diagonal
      
      obs filters:
      
      # ------------------
      # stationPressure (surface pressure)
      # Observation Range Sanity Check
      - filter: Bounds Check
        filter variables:
        - name: stationPressure
        minvalue: 49999
        action:
          name: reject
      # PreUseFlag is assigned in reading programs in GSI.
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        where:
        - variable: PreUseFlag/stationPressure
          # PreUseFlag should =< ijter ( # of outloop(0,1,2) + 1) in GSI
          minvalue: 1
        action:
          name: reject
      # PrepBUFR check to be supplemented later
      - filter: RejectList
        where:
        - variable:
            name: PreQC/stationPressure
          is_in: 4-15
      # error assignments
      # Original error interpolated from the error table
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        where:
        - variable: ObsType/stationPressure
          is_in: [181]
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: ObsValue/stationPressure
              xvals: [70000, 65000, 60000, 55000]
              errors: [100,    120,   120, 1.0e+11]
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        where:
        - variable: ObsType/stationPressure
          is_in: [187]
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: ObsValue/stationPressure
              xvals: [80000, 75000, 70000, 65000]
              errors: [100,    130,   160, 1.0e+11]
      # Ajusted error after reading prep_bufr
      - filter: Perform Action
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: PreQC/stationPressure
          is_in: [3]
      # error inflation based on Ps correction
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorSfcPressure
            options:
              geovar_geomz: geopotential_height
              geovar_sfc_geomz: surface_geometric_height
              station_altitude: height
      # assign TempObsErrorData/stationPressure <--- ObsErrorData before changing its Min and Max
      - filter: Variable Assignment
        assignments:
        - name: TempObsErrorData/stationPressure
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/stationPressure
        defer to post: true
      # set ObsErrorData 100 Pa if it < 100 Pa.
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: assign error
          error parameter: 100
        where:
        - variable:
            name: TempObsErrorData/stationPressure
          maxvalue: 100
        - variable:
            name: TempObsErrorData/stationPressure
          is_defined:
        defer to post: true
      # set ObsErrorData 300 Pa if it > 300 Pa.
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: assign error
          error parameter: 300
        where:
        - variable:
            name: TempObsErrorData/stationPressure
          minvalue: 300
        - variable:
            name: TempObsErrorData/stationPressure
          is_defined:
        defer to post: true
      
      # Background check
      # background check for obstype 187:
      - filter: Background Check
        filter variables:
        - name: stationPressure
        threshold: 4.0
        action:
          name: reject
        where:
        - variable: PreQC/stationPressure
          is_not_in: [3]
        - variable: ObsType/stationPressure
          is_in: 187
        defer to post: true
      # threshold 4.0 * 0.7 = 2.8 if PreQC=3
      - filter: Background Check
        filter variables:
        - name: stationPressure
        threshold: 2.8
        action:
          name: reject
        where:
        - variable: PreQC/stationPressure
          is_in: [3]
        - variable: ObsType/stationPressure
          is_in: 187
        defer to post: true
      # background check for obstype 181:
      # threshold 3.6 if PreQC /= 3
      - filter: Background Check
        filter variables:
        - name: stationPressure
        threshold: 3.6
        action:
          name: reject
        where:
        - variable: PreQC/stationPressure
          is_not_in: [3]
        - variable: ObsType/stationPressure
          is_in: [181]
        defer to post: true
      # threshold 3.6 * 0.7 = 2.52 if PreQC=3
      - filter: Background Check
        filter variables:
        - name: stationPressure
        threshold: 2.52
        action:
          name: reject
        where:
        - variable: PreQC/stationPressure
          is_in: [3]
        - variable: ObsType/stationPressure
          is_in: [181]
        defer to post: true
      # Re-assign error ObsErrorData/stationPressure <--- TempObsErrorData/stationPressure
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: assign error
          error function: TempObsErrorData/stationPressure
        where:
        - variable:
            name: TempObsErrorData/stationPressure
          is_defined:
        defer to post: true
      # Duplicate factor
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: false
              variable: stationPressure
        defer to post: true
      
      ## specificHumidity. Both types 181 & 187 are rejected.
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: ObsType/specificHumidity
          is_in: 181,187
        action:
          name: reject
      
      ## airTemperature. Both types 181 & 187 are rejected.
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        where:
        - variable: ObsType/airTemperature
          is_in: 181,187
        action:
          name: reject
      
      ## virtualTemperature. Both types 181 & 187 are rejected.
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        where:
        - variable: ObsType/virtualTemperature
          is_in: 181,187
        action:
          name: reject
      
      ## windEastward. Both types 281 & 287 are rejected.
      - filter: Perform Action
        filter variables:
        - name: windEastward
        where:
        - variable: ObsType/windEastward
          is_in: 281,287
        action:
          name: reject
      
      ## windNorthward. Both types 281 & 287 are rejected.
      - filter: Perform Action
        filter variables:
        - name: windNorthward
        where:
        - variable: ObsType/windNorthward
          is_in: 281,287
        action:
          name: reject

####################################################
##  OBSYS-ON: SFC Ocean
####################################################
    - obs space:
        name: Surface Marine Stations
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/sfcship.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/sfcship.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [windEastward, windNorthward, virtualTemperature, airTemperature,
                              specificHumidity, stationPressure]
      
      obs operator:
        name: Composite
        components:
      
         - name: VertInterp
           observation alias file: Config/obsop_name_map.yaml
           apply near surface wind scaling: true
           variables:
           - name: airTemperature
           - name: virtualTemperature
      
         - name: Product
           observation alias file: Config/obsop_name_map.yaml
           geovals to scale hofx by: wind_reduction_factor_at_10m
           variables:
           - name: windEastward
           - name: windNorthward
      
         # Surface pressure is handled using the correction scheme
         - name: SfcPCorrected
           variables:
           - name: stationPressure
           da_psfc_scheme: GSI
           geovar_geomz: geopotential_height
           geovar_sfc_geomz: surface_geometric_height
           station_altitude: height
      
         # Specific humidity is using the lowest model level (identity)
         - name: Identity
           variables:
           - name: specificHumidity

      linear obs operator:
        name: Identity
      obs error:
        covariance model: diagonal
      
      obs filters:
      
      # ------------------
      # stationPressure (surface pressure)
      # ------------------
      # PreUseFlag is assigned in reading programs in GSI.
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        where:
        - variable: PreUseFlag/stationPressure
          # PreUseFlag should =< ijter ( # of outloop(0,1,2) + 1) in GSI
          minvalue: 1
        action:
          name: reject
      # PrepBUFR check to be supplemented later
      - filter: RejectList
        where:
        - variable:
            name: PreQC/stationPressure
          is_in: 4-15
      # error assignments
      # Original error interpolated from the error table
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        where:
        - variable: ObsType/stationPressure
          is_in: [180]
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: ObsValue/stationPressure
              xvals: [ 80000, 75000, 70000, 65000, 60000, 55000]
              errors: [100,   100,   110,   120,   120,   1.0e+11]
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        where:
        - variable: ObsType/stationPressure
          is_in: [183]
        action:
          name: assign error
          error parameter: 1.0e+11
      # GSI says this adjustment is for buoys type(180) & subtype (0) in setupps.f90
      # Note, types of drifting buoys are re-set to 199/299 in read_prepbufr.f90 when id_drifter=TRUE.
      - filter: Perform Action
        action:
          name: inflate error
          inflation factor: 0.7
        where:
        - variable: ObsType/stationPressure
          is_in: [180]
        - variable: ObsSubType/stationPressure
          is_in: [0]
      # Ajusted error after reading prep_bufr
      - filter: Perform Action
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: PreQC/stationPressure
          is_in: [3]
      # error inflation based on Ps correction
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorSfcPressure
            options:
              geovar_geomz: geopotential_height
              geovar_sfc_geomz: surface_geometric_height
              station_altitude: height
      # assign TempObsErrorData/stationPressure <--- ObsErrorData before changing its Min and Max
      - filter: Variable Assignment
        assignments:
        - name: TempObsErrorData/stationPressure
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/stationPressure
        defer to post: true
      # set ObsErrorData 100 Pa if it < 100 Pa.
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: assign error
          error parameter: 100
        where:
        - variable:
            name: TempObsErrorData/stationPressure
          maxvalue: 100
        - variable:
            name: TempObsErrorData/stationPressure
          is_defined:
        defer to post: true
      # set ObsErrorData 300 Pa if it > 300 Pa.
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: assign error
          error parameter: 300
        where:
        - variable:
            name: TempObsErrorData/stationPressure
          minvalue: 300
        - variable:
            name: TempObsErrorData/stationPressure
          is_defined:
        defer to post: true
      # Background  check
      # background check for obstype 180,183:
      # threshold 4.0 if PreQC /= 3
      - filter: Background Check
        filter variables:
        - name: stationPressure
        threshold: 4.0
        action:
          name: reject
        where:
        - variable: PreQC/stationPressure
          is_not_in: [3]
        - variable: ObsType/stationPressure
          is_in: 180,183
        defer to post: true
      # threshold * 0.7 if PreQC=3
      - filter: Background Check
        filter variables:
        - name: stationPressure
        threshold: 2.8
        action:
          name: reject
        where:
        - variable: PreQC/stationPressure
          is_in: [3]
        - variable: ObsType/stationPressure
          is_in: 180,183
        defer to post: true
      # Re-assign error ObsErrorData/stationPressure <--- TempObsErrorData/stationPressure
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: assign error
          error function: TempObsErrorData/stationPressure
        where:
        - variable:
            name: TempObsErrorData/stationPressure
          is_defined:
        defer to post: true
      # # Duplicate factor
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: false
              variable: stationPressure
        defer to post: true
      
      # ------------------
      # airTemperature
      # ------------------
      # Error assignments
      ## All airTemperature data with ObsType=183 are passive in GSI.
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        where:
        - variable: ObsType/airTemperature
          is_in: [183]
        action:
          name: assign error
          error parameter: 1.0e+11
      ## Reject airTemperature with ObsType=183
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        where:
        - variable: ObsType/airTemperature
          is_in: [183]
        action:
          name: reject
      ## airTemperature data with ObsType=180
      # initial error
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        where:
        - variable: ObsType/airTemperature
          is_in: [180]
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [ 80000,75000, 70000, 65000]
              errors: [ 1.75, 1.95,  2.25,   1.0]
      # Ajusted error after initial assignment
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorConventional
            options:
              test QCflag: PreQC
              test QCthreshold: 3
              inflate variables: [airTemperature]
              pressure: MetaData/pressure
              distance threshold: -1.
        defer to post: true
      # inflate error, x1.2 for PreQC = 3,7
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: PreQC/airTemperature
          is_in: [3 7]
        defer to post: true
      # inflate error, x1.2  at pressure < 10000 Pa.
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: MetaData/pressure
          minvalue: 0
          maxvalue: 9999
        defer to post: true
      ## a tempporary solution: Replace error by GsiAdjustObsError
      ## overwite above error assignments and inflation.
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error function: GsiAdjustObsError/airTemperature
        where:
        - variable:
            name: GsiAdjustObsError/airTemperature
          is_defined:
        defer to post: true
      # error inflation based on pressure check
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: airTemperature
              inflation factor: 8.0
              geovar_sfc_geomz: surface_geometric_height
        defer to post: true
      # assign TempObsErrorData/airTemperature  <--- ObsErrorData before changing its Min and Max
      - filter: Variable Assignment
        assignments:
        - name: TempObsErrorData/airTemperature
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/airTemperature
        defer to post: true
      # set ObsErrorData 1.3 K if it < 1.3 K
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error parameter: 1.3
        where:
        - variable:
            name: TempObsErrorData/airTemperature
          maxvalue: 1.3
        - variable:
            name: TempObsErrorData/airTemperature
          is_defined:
        defer to post: true
      # set ObsErrorData 5.6 K if it > 5.6 K.
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error parameter: 5.6
        where:
        - variable:
            name: TempObsErrorData/airTemperature
          minvalue: 5.6
        - variable:
            name: TempObsErrorData/airTemperature
          is_defined:
        defer to post: true
      
      # Screen data by PreUseFlag
      # PreUseFlag is assigned in reading programs in GSI.
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        where:
        - variable: PreUseFlag/airTemperature
          # PreUseFlag should =< ijter ( # of outloop(0,1,2) + 1) in GSI
          minvalue: 1
        action:
          name: reject
      # Background  check
      # ratio threshold 7.0 if PreQC /= 3
      - filter: Background Check
        filter variables:
        - name: airTemperature
        threshold: 7.0
        action:
          name: reject
        where:
        - variable: PreQC/airTemperature
          is_not_in: [3]
        defer to post: true
      # ratio threshold * 0.7 if PreQC=3
      - filter: Background Check
        filter variables:
        - name: airTemperature
        threshold: 4.9
        action:
          name: reject
        where:
        - variable: PreQC/airTemperature
          is_in: [3]
        defer to post: true
      # Re-assign error ObsErrorData/aireTemperature <--- TempObsErrorData/aireTemperature
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error function: TempObsErrorData/airTemperature
        where:
        - variable:
            name: TempObsErrorData/airTemperature
          is_defined:
        defer to post: true
      ## Duplicate factor
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: true
              variable: airTemperature
        defer to post: true
      
      # ------------------
      # virtualTemperature
      # ------------------
      ## All virtualTemperature data with ObsType=183 are passive in GSI.
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        where:
        - variable: ObsType/virtualTemperature
          is_in: [183]
        action:
          name: assign error
          error parameter: 1.0e+11
      ## Reject virtualTemperature with ObsType=183
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        where:
        - variable: ObsType/virtualTemperature
          is_in: [183]
        action:
          name: reject
      ## virtualTemperature data with ObsType=180
      # Error assignments
      # initial error
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        where:
        - variable: ObsType/virtualTemperature
          is_in: [180]
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [ 80000,75000, 70000, 65000]
              errors: [ 1.75, 1.95,  2.25,   1.0]
      # Ajusted error after initial assignment
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorConventional
            options:
              test QCflag: PreQC
              test QCthreshold: 3
              inflate variables: [virtualTemperature]
              pressure: MetaData/pressure
              distance threshold: -1.
        defer to post: true
      # inflate error, x1.2 for PreQC = 3,7
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: PreQC/virtualTemperature
          is_in: [3 7]
        defer to post: true
      # inflate error, x1.2  at pressure < 10000 Pa.
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: MetaData/pressure
          minvalue: 0
          maxvalue: 9999
        defer to post: true
      ## a tempporary solution: Replace error by GsiAdjustObsError
      ## overwite above error assignments and inflation.
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: assign error
          error function: GsiAdjustObsError/virtualTemperature
        where:
        - variable:
            name: GsiAdjustObsError/virtualTemperature
          is_defined:
        defer to post: true
      # error inflation based on pressure check
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: virtualTemperature
              inflation factor: 8.0
              geovar_sfc_geomz: surface_geometric_height
        defer to post: true
      
      # assign TempObsErrorData/virtualTemperature  <--- ObsErrorData before changing its Min and Max
      - filter: Variable Assignment
        assignments:
        - name: TempObsErrorData/virtualTemperature
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/virtualTemperature
        defer to post: true
      # set ObsErrorData 1.3 K if it < 1.3 K
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: assign error
          error parameter: 1.3
        where:
        - variable:
            name: TempObsErrorData/virtualTemperature
          maxvalue: 1.3
        - variable:
            name: TempObsErrorData/virtualTemperature
          is_defined:
        defer to post: true
      # set ObsErrorData 5.6 K if it > 5.6 K.
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: assign error
          error parameter: 5.6
        where:
        - variable:
            name: TempObsErrorData/virtualTemperature
          minvalue: 5.6
        - variable:
            name: TempObsErrorData/virtualTemperature
          is_defined:
        defer to post: true
      # Screen data by PreUseFlag
      # PreUseFlag is assigned in reading programs in GSI.
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        where:
        - variable: PreUseFlag/virtualTemperature
          # PreUseFlag should =< ijter ( # of outloop(0,1,2) + 1) in GSI
          minvalue: 1
        action:
          name: reject
      # Background  check
      # ratio threshold 7.0 if PreQC /= 3
      - filter: Background Check
        filter variables:
        - name: virtualTemperature
        threshold: 7.0
        action:
          name: reject
        where:
        - variable: PreQC/virtualTemperature
          is_not_in: [3]
        defer to post: true
      # ratio threshold * 0.7 if PreQC=3
      - filter: Background Check
        filter variables:
        - name: virtualTemperature
        threshold: 4.9
        action:
          name: reject
        where:
        - variable: PreQC/virtualTemperature
          is_in: [3]
        defer to post: true
      # Re-assign error ObsErrorData/aireTemperature <--- TempObsErrorData/aireTemperature
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: assign error
          error function: TempObsErrorData/virtualTemperature
        where:
        - variable:
            name: TempObsErrorData/virtualTemperature
          is_defined:
        defer to post: true
      ## Duplicate factor
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: true
              variable: virtualTemperature
        defer to post: true
      
      
      # ------------------
      # specificHumidity
      # ------------------
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: PreUseFlag/specificHumidity
         # PreUseFlag should =< ijter (1,2,or 3) in GSI
          minvalue: 1
        action:
          name: reject
      
      # All specificHumidity data with ObsType=183 are passive in GSI.
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: ObsType/specificHumidity
          is_in: [183]
        action:
          name: assign error
          error parameter: 1.0e+11
      
      # Reject specificHumidity with ObsType=183
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: ObsType/specificHumidity
          is_in: [183]
        action:
          name: reject
      
      # Ships data (kx=180)
      # Modify error
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: ObsType/specificHumidity
          is_in: [180]
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorSatSpecHumidity
            options:
              variable: specificHumidity
              input_error_name: GsiInputObsError
      
      # Pressure check
      - filter: BlackList
        filter variables:
        - name: specificHumidity
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: specificHumidity
              inflation factor: 8
              adjusted_error_name: GsiAdjustObsError
              geovar_sfc_geomz: surface_geometric_height
      
      # Background  check
      # ratio threshold 8.0 PreQC /= 3
      - filter: Background Check
        filter variables:
        - name: specificHumidity
        threshold: 8.0
        action:
          name: reject
        where:
        - variable: PreQC/specificHumidity
          is_not_in: [3]
        defer to post: true
      #   #ratio threshold * 0.7 if PreQC=3
      - filter: Background Check
        filter variables:
        - name: specificHumidity
        threshold: 5.6
        action:
          name: reject
        where:
        - variable: PreQC/specificHumidity
          is_in: [3]
        defer to post: true
      
      # Duplicate factor
      - filter: BlackList
        filter variables:
        - name: specificHumidity
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: true
              variable: specificHumidity
        defer to post: true
      
      # ------------------
      # Winds
      # ------------------
      
      - filter: Perform Action
        filter variables:
        - name: windEastward
        where:
        - variable: ObsType/windEastward
          is_in: [284]
        action:
          name: assign error
          error parameter: 1.0e+11
      
      - filter: Perform Action
        filter variables:
        - name: windEastward
        where:
        - variable: ObsType/windEastward
          is_in: [284]
        action:
          name: reject
      
      - filter: Perform Action #280
        filter variables:
        - name: windEastward
        - name: windNorthward
        where:
        - variable: ObsType/windEastward
          is_in: [280]
        action:
          name: assign error
          error parameter: 2.5
      
      - filter: Perform Action #282
        filter variables:
        - name: windEastward
        - name: windNorthward
        where:
        - variable: ObsType/windEastward
          is_in: [282]
        action:
          name: assign error
          error parameter: 2.2
      
      - filter: Perform Action
        filter variables:
        - name: windEastward
        where:
        - variable: PreUseFlag/windEastward
         # PreUseFlag should =< ijter (1,2,or 3) in GSI
          minvalue: 1
        action:
          name: reject
      
      - filter: Perform Action
        filter variables:
        - name: windNorthward
        where:
        - variable: PreUseFlag/windNorthward
         # PreUseFlag should =< ijter (1,2,or 3) in GSI
          minvalue: 1
        action:
          name: reject
      
      # Pressure check
      - filter: BlackList
        filter variables:
        - name: windEastward
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: windEastward
              inflation factor: 4.0
              adjusted_error_name: GsiAdjustObsError
              geovar_sfc_geomz: surface_geometric_height
      
      # Pressure check
      - filter: BlackList
        filter variables:
        - name: windNorthward
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: windNorthward
              inflation factor: 4.0
              adjusted_error_name: GsiAdjustObsError
              geovar_sfc_geomz: surface_geometric_height
      
      # Background  check
      # ratio threshold 6.0 if PreQC /= 3
      - filter: Background Check
        filter variables:
        - name: windEastward
        threshold: 6.0
        action:
          name: reject
        where:
        - variable: PreQC/windEastward
          is_not_in: [3]
        defer to post: true
      # ratio threshold * 0.7 if PreQC=3
      - filter: Background Check
        filter variables:
        - name: windEastward
        threshold: 4.2
        action:
          name: reject
        where:
        - variable: PreQC/windEastward
          is_in: [3]
        defer to post: true
      
      # Background  check
      # ratio threshold 6.0 if PreQC /= 3
      - filter: Background Check
        filter variables:
        - name: windNorthward
        threshold: 6.0
        action:
          name: reject
        where:
        - variable: PreQC/windNorthward
          is_not_in: [3]
        defer to post: true
      # ratio threshold * 0.7 if PreQC=3
      - filter: Background Check
        filter variables:
        - name: windNorthward
        threshold: 4.2
        action:
          name: reject
        where:
        - variable: PreQC/windNorthward
          is_in: [3]
        defer to post: true
      
      #wgu
      # Gross Check
      - filter: Background Check
        filter variables:
        - name: windEastward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            satwndtype: [  280, 282, 284 ]
            error_min: [ 1.4, 1.4, 1.4 ]
            error_max: [ 6.1, 6.1, 6.1 ]
            cgross:    [ 6.0, 6.0, 6.0 ]
            wndtype:  [ 280, 282, 284 ]
            variable: windEastward
        action:
          name: reject
        defer to post: true
      
      #wgu
      # Gross Check
      - filter: Background Check
        filter variables:
        - name: windNorthward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            satwndtype: [  280, 282, 284 ]
            error_min: [ 1.4, 1.4, 1.4 ]
            error_max: [ 6.1, 6.1, 6.1 ]
            cgross:    [ 6.0, 6.0, 6.0 ]
            wndtype:  [ 280, 282, 284 ]
            variable: windNorthward
        action:
          name: reject
        defer to post: true
      
      # Duplicate factor
      - filter: BlackList
        filter variables:
        - name: windEastward
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: true
              variable: windEastward
        defer to post: true
      
      # Duplicate factor
      - filter: BlackList
        filter variables:
        - name: windNorthward
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: true
              variable: windNorthward
        defer to post: true
      

 
####################################################
##  OBSYS-ON: Radiosonde
####################################################
    - obs space:
        name: Radiosondes
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/sondes.$BYYYYYMMDDTHH0000Z.nc4
          obsgrouping:
            group variables: ["stationIdentification", "releaseTime"]
            sort variable: "pressure"
            sort order: "descending"
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/sondes.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [windEastward, windNorthward, virtualTemperature, airTemperature,
                              specificHumidity, stationPressure]
      
      obs operator:
        name: Composite
        components:
        - name: VertInterp
          apply near surface wind scaling: true
          variables:
          - name: airTemperature
          - name: virtualTemperature
          - name: specificHumidity
          - name: windEastward
          - name: windNorthward
        - name: SfcPCorrected
          variables:
          - name: stationPressure
          da_psfc_scheme: GSI
          geovar_geomz: geopotential_height
          geovar_sfc_geomz: surface_geometric_height
          station_altitude: height
      linear obs operator:
        name: Identity
      obs error:
        covariance model: diagonal

      obs filters:
      
      ## Surface pressure
      ## ----------------
      # PreUseFlag is assigned in reading programs in GSI.
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        where:
        - variable: PreUseFlag/stationPressure
          # PreUseFlag should =< ijter ( # of outloop(0,1,2) + 1) in GSI
          minvalue: 1
        action:
          name: reject
      # PrepBUFR check to be supplemented later
      - filter: RejectList
        where:
        - variable:
            name: PreQC/stationPressure
          is_in: 4-15
      # Error assignments
      # Original error interpolated from the error table
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: ObsValue/stationPressure
              xvals: [60000, 55000]
              errors: [100, 1.0e+11]
      # Ajusted error after reading prep_bufr
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: PreQC/stationPressure
          is_in: [3]
      # error inflation based on Ps correction
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorSfcPressure
            options:
              geovar_geomz: geopotential_height
              geovar_sfc_geomz: surface_geometric_height
              station_altitude: height
      
      # Note: Obs Erorr should between [min ~ max] for gross error checks.
      # However, duplicate factors are applied to those obs erros which are not reset between [min~max].
      # assign TempObsErrorData/stationPressure <--- ObsErrorData before changing its Min and Max
      - filter: Variable Assignment
        assignments:
        - name: TempObsErrorData/stationPressure
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/stationPressure
        defer to post: true
      # set ObsErrorData 100 Pa if it < 100 Pa.
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: assign error
          error parameter: 100
        where:
        - variable:
            name: TempObsErrorData/stationPressure
          maxvalue: 100
        - variable:
            name: TempObsErrorData/stationPressure
          is_defined:
        defer to post: true
      # set ObsErrorData 300 Pa if it > 300 Pa.
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: assign error
          error parameter: 300
        where:
        - variable:
            name: TempObsErrorData/stationPressure
          minvalue: 300
        - variable:
            name: TempObsErrorData/stationPressure
          is_defined:
        defer to post: true
      
      # Background  check
      - filter: Background Check
        filter variables:
        - name: stationPressure
        threshold: 4.0
        action:
          name: reject
        where:
        - variable: PreQC/stationPressure
          is_not_in: [3]
        defer to post: true
      # threshold * 0.7 if PreQC=3
      - filter: Background Check
        filter variables:
        - name: stationPressure
        threshold: 2.8
        action:
          name: reject
        where:
        - variable: PreQC/stationPressure
          is_in: [3]
        defer to post: true
      # Re-assign error ObsErrorData/stationPressure <--- TempObsErrorData/stationPressure
      # after gross error check.
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: assign error
          error function: TempObsErrorData/stationPressure
        where:
        - variable:
            name: TempObsErrorData/stationPressure
          is_defined:
        defer to post: true
      # Duplicate factor
      - filter: Perform Action
        filter variables:
        - name: stationPressure
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: false
              variable: stationPressure
        defer to post: true
      
      # Specific humidity
      # -----------------
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: PreUseFlag/specificHumidity
          # PreUseFlag should =< ijter (1,2,or 3) in GSI
          minvalue: 1
        action:
          name: reject
      
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        where:
        - variable: ObsType/specificHumidity
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorSatSpecHumidity
            options:
              variable: specificHumidity
              input_error_name: GsiInputObsError
      
      # Pressure check
      - filter: BlackList
        filter variables:
        - name: specificHumidity
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorPressureCheck@ObsFunction
            options:
              variable: specificHumidity
              inflation factor: 8.0
              adjusted_error_name: GsiAdjustObsError
              geovar_sfc_geomz: surface_geometric_height
        defer to post: true
      # assign TempObsErrorData/stationPressure <--- ObsErrorData
      - filter: Variable Assignment
        assignments:
        - name: TempObsErrorData/specificHumidity
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/specificHumidity
        defer to post: true
      
      # Duplicate factor
      - filter: Perform Action
        filter variables:
        - name: specificHumidity
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: true
              variable: specificHumidity
        defer to post: true
      
      # Air temperature
      # ---------------
      # Error assignments
      # initial error
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [ 105000, 100000, 95000, 90000, 85000, 70000, 65000, 60000,
                       40000, 35000, 30000, 25000, 20000, 5000, 4000, 3000, 2000, 1000]
              errors: [1.3,    1.1,    0.9,   0.7,   0.6,   0.6,   0.55,  0.5,
                        0.5,   0.55,  0.65,  1.1,   1.2,   1.2,  1.4,  1.6,  1.85, 2.0]
      # Ajusted error after initial assignment
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorConventional
            options:
              test QCflag: PreQC
              test QCthreshold: 3
              inflate variables: [airTemperature]
              pressure: MetaData/pressure
              distance threshold: -1.
        defer to post: true
      # inflate error, x1.2 for PreQC = 3,7
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: PreQC/airTemperature
          is_in: [3 7]
        defer to post: true
      # inflate error, x1.2  at pressure < 10000 Pa.
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: MetaData/pressure
          minvalue: 0
          maxvalue: 9999
        defer to post: true
      ## a tempporary solution: Replace error by GsiAdjustObsError
      ## overwite above error assignments and inflation.
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error function: GsiAdjustObsError/airTemperature
        where:
        - variable:
            name: GsiAdjustObsError/airTemperature
          is_defined:
        defer to post: true
      ## error inflation based on pressure check
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: airTemperature
              inflation factor: 8.0
              geovar_sfc_geomz: surface_geometric_height
        defer to post: true
      # assign TempObsErrorData/airTemperature  <--- ObsErrorData before changing its Min and Max
      - filter: Variable Assignment
        assignments:
        - name: TempObsErrorData/airTemperature
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/airTemperature
        defer to post: true
      # set ObsErrorData 1.3 K if it < 1.3 K
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error parameter: 1.3
        where:
        - variable:
            name: TempObsErrorData/airTemperature
          maxvalue: 1.3
        - variable:
            name: TempObsErrorData/airTemperature
          is_defined:
        defer to post: true
      # set ObsErrorData 5.6 K if it > 5.6 K.
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error parameter: 5.6
        where:
        - variable:
            name: TempObsErrorData/airTemperature
          minvalue: 5.6
        - variable:
            name: TempObsErrorData/airTemperature
          is_defined:
        defer to post: true
      # Screen data by PreUseFlag
      # PreUseFlag is assigned in reading programs in GSI.
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        where:
        - variable: PreUseFlag/airTemperature
          # PreUseFlag should =< ijter ( # of outloop(0,1,2) + 1) in GSI
          minvalue: 1
        action:
          name: reject
      # Background  check
      # ratio threshold 8.0 if PreQC /= 3
      - filter: Background Check
        filter variables:
        - name: airTemperature
        threshold: 8.0
        action:
          name: reject
        where:
        - variable: PreQC/airTemperature
          is_not_in: [3]
        defer to post: true
      # ratio threshold 8.0 * 0.7 = 5.6 if PreQC = 3
      - filter: Background Check
        filter variables:
        - name: airTemperature
        threshold: 5.6
        action:
          name: reject
        where:
        - variable: PreQC/airTemperature
          is_in: [3]
        defer to post: true
      # Re-assign error ObsErrorData/aireTemperature <--- TempObsErrorData/aireTemperature
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: assign error
          error function: TempObsErrorData/airTemperature
        where:
        - variable:
            name: TempObsErrorData/airTemperature
          is_defined:
        defer to post: true
      ## Duplicate factor
      - filter: Perform Action
        filter variables:
        - name: airTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: true
              variable: airTemperature
        defer to post: true
      
      # Virtual Temperature
      # -------------------
      # Error assignments
      # initial error
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: assign error
          error function:
            name: ObsFunction/ObsErrorModelStepwiseLinear
            options:
              xvar:
                name: MetaData/pressure
              xvals: [ 105000, 100000, 95000, 90000, 85000, 70000, 65000, 60000,
                       40000, 35000, 30000, 25000, 20000, 5000, 4000, 3000, 2000, 1000]
              errors: [1.3,    1.1,    0.9,   0.7,   0.6,   0.6,   0.55,  0.5,
                        0.5,   0.55,  0.65,  1.1,   1.2,   1.2,  1.4,  1.6,  1.85, 2.0]
      # Ajusted error after initial assignment
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorConventional
            options:
              test QCflag: PreQC
              test QCthreshold: 3
              inflate variables: [virtualTemperature]
              pressure: MetaData/pressure
              distance threshold: -1.
        defer to post: true
      # inflate error, x1.2 for PreQC = 3,7
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: PreQC/virtualTemperature
          is_in: [3 7]
        defer to post: true
      # inflate error, x1.2  at pressure < 10000 Pa.
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: inflate error
          inflation factor: 1.2
        where:
        - variable: MetaData/pressure
          minvalue: 0
          maxvalue: 9999
        defer to post: true
      ## a tempporary solution: Replace error by GsiAdjustObsError
      ## overwite above error assignments and inflation.
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: assign error
          error function: GsiAdjustObsError/virtualTemperature
        where:
        - variable:
            name: GsiAdjustObsError/virtualTemperature
          is_defined:
        defer to post: true
      ## error inflation based on pressure check
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: virtualTemperature
              inflation factor: 8.0
              geovar_sfc_geomz: surface_geometric_height
        defer to post: true
      
      # assign TempObsErrorData/virtualTemperature  <--- ObsErrorData before changing its Min and Max
      - filter: Variable Assignment
        assignments:
        - name: TempObsErrorData/virtualTemperature
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/virtualTemperature
        defer to post: true
      # set ObsErrorData 1.3 K if it < 1.3 K
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: assign error
          error parameter: 1.3
        where:
        - variable:
            name: TempObsErrorData/virtualTemperature
          maxvalue: 1.3
        - variable:
            name: TempObsErrorData/virtualTemperature
          is_defined:
        defer to post: true
      # set ObsErrorData 5.6 K if it > 5.6 K.
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: assign error
          error parameter: 5.6
        where:
        - variable:
            name: TempObsErrorData/virtualTemperature
          minvalue: 5.6
        - variable:
            name: TempObsErrorData/virtualTemperature
          is_defined:
        defer to post: true
      
      # Screen data by PreUseFlag
      # PreUseFlag is assigned in reading programs in GSI.
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        where:
        - variable: PreUseFlag/virtualTemperature
          # PreUseFlag should =< ijter ( # of outloop(0,1,2) + 1) in GSI
          minvalue: 1
        action:
          name: reject
      # Background  check
      # ratio threshold 8.0
      - filter: Background Check
        filter variables:
        - name: virtualTemperature
        threshold: 8.0
        action:
          name: reject
        where:
        - variable: PreQC/virtualTemperature
          is_not_in: [3]
        defer to post: true
      # ratio threshold * 0.7 if PreQC=3
      - filter: Background Check
        filter variables:
        - name: virtualTemperature
        threshold: 5.6
        action:
          name: reject
        where:
        - variable: PreQC/virtualTemperature
          is_in: [3]
        defer to post: true
      # Re-assign error ObsErrorData/aireTemperature <--- TempObsErrorData/aireTemperature
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: assign error
          error function: TempObsErrorData/virtualTemperature
        where:
        - variable:
            name: TempObsErrorData/virtualTemperature
          is_defined:
        defer to post: true
      ## Duplicate factor
      - filter: Perform Action
        filter variables:
        - name: virtualTemperature
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorDuplicateCheck
            options:
              use_air_pressure: true
              variable: virtualTemperature
        defer to post: true
      
      # Eastward and northward wind
      # ---------------------------
      # Assign the initial observation error, based on height/pressure
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        - name: windNorthward
        minvalue: -135
        maxvalue: 135
        action:
          name: assign error
          error function:
            name: ObsErrorModelStepwiseLinear@ObsFunction
            options:
              xvar:
                name: MetaData/pressure
              xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000,
                       60000,  55000,  50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000,
                       10000,   7500,   5000,  4000,  3000,  2000,  1000,   500,   400,   300,
                         200,    100,      0 ]   #Pressure (Pa)
              errors: [1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.6, 1.7, 1.8,
                       1.9, 2.0, 2.1, 2.2, 2.2, 2.3, 2.3, 2.4, 2.4, 2.4,
                       2.4, 2.4, 2.4, 2.4, 2.5, 2.7, 2.9, 3.1, 3.3, 3.5,
                       3.7, 3.9, 4.1]
      
      - filter: Perform Action
        filter variables:
        - name: windEastward
        where:
        - variable: PreUseFlag/windEastward
          is_in: 100
        action:
          name: reject
      
      - filter: Perform Action
        filter variables:
        - name: windNorthward
        where:
        - variable: PreUseFlag/windNorthward
          is_in: 100
        action:
          name: reject
      ## a tempporary solution: Replace error by GsiAdjustObsError
      ## overwite above error assignments.
      - filter: Perform Action
        filter variables:
        - name: windEastward
        action:
          name: assign error
          error function: GsiAdjustObsError/windEastward
        where:
        - variable:
            name: GsiAdjustObsError/windEastward
          is_defined:
      - filter: Perform Action
        filter variables:
        - name: windNorthward
        action:
          name: assign error
          error function: GsiAdjustObsError/windNorthward
        where:
        - variable:
            name: GsiAdjustObsError/windNorthward
          is_defined:
      - filter: Perform Action
        filter variables:
        - name: windEastward
        where:
          - variable:
              name: ObsType/windEastward
            is_in: 220,221
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: windEastward
              inflation factor: 4.0
              adjusted_error_name: GsiAdjustObsError
              geovar_sfc_geomz: surface_geometric_height
      
      - filter: Perform Action
        filter variables:
        - name: windNorthward
        where:
          - variable:
              name: ObsType/windNorthward
            is_in: 220,221
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorPressureCheck
            options:
              variable: windNorthward
              inflation factor: 4.0
              adjusted_error_name: GsiAdjustObsError
              geovar_sfc_geomz: surface_geometric_height
      
      # Gross Check
      - filter: Background Check
        filter variables:
        - name: windEastward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            wndtype:    [ 220, 221 ]
            cgross:     [ 8.0, 8.0 ]
            error_min:  [ 1.4, 1.4 ]
            error_max:  [ 6.1, 6.1 ]
            variable: windEastward
        action:
          name: reject
      # Gross Check
      - filter: Background Check
        filter variables:
        - name: windNorthward
        function absolute threshold:
        - name: ObsFunction/WindsSPDBCheck
          options:
            wndtype:    [ 220, 221 ]
            cgross:     [ 8.0, 8.0 ]
            error_min:  [ 1.4, 1.4 ]
            error_max:  [ 6.1, 6.1 ]
            variable: windNorthward
        action:
          name: reject
      
      - filter: Bounds Check
        filter variables:
        - name: windEastward
        test variables:
        - name: ObsErrorData/windEastward
        maxvalue: 100.0
        action:
          name: reject
        defer to post: true
      
      # assign TempObsErrorData/stationPressure <--- ObsErrorData
      - filter: Variable Assignment
        assignments:
        - name: TempObsErrorData/windEastward
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/windEastward
        defer to post: true
      # assign TempObsErrorData/stationPressure <--- ObsErrorData
      - filter: Variable Assignment
        assignments:
        - name: TempObsErrorData/windNorthward
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/windNorthward
        defer to post: true
      
      - filter: Bounds Check
        filter variables:
        - name: windNorthward
        test variables:
        - name: ObsErrorData/windNorthward
        maxvalue: 100.0
        action:
          name: reject
        defer to post: true
      
      - filter: BlackList
        filter variables:
        - name: windEastward
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorDuplicateCheck@ObsFunction
            options:
              use_air_pressure: true
              variable: windEastward
        where:
          - variable:
              name: ObsType/windEastward
            is_in: 220
        defer to post: true
      - filter: BlackList
        filter variables:
        - name: windNorthward
        action:
          name: inflate error
          inflation variable:
            name: ObsErrorFactorDuplicateCheck@ObsFunction
            options:
              use_air_pressure: true
              variable: windNorthward
        where:
          - variable:
              name: ObsType/windNorthward
            is_in: 220
        defer to post: true



####################################################
##  OBSYS-ON: SSMIS-F17
####################################################
    - obs space:
        name: &Sensor_ID ssmis_f17
        obsdatain:
          engine:
            type: H5File
            obsfile: Data/obs/ssmis_f17.$BYYYYYMMDDTHH0000Z.nc4
        obsdataout:
          engine:
            type: H5File
            obsfile: Data/hofx/ssmis_f17.$BYYYYYMMDDTHH0000Z.nc4
        simulated variables: [brightnessTemperature]
        channels: &ssmis_f17_channels 1-24
      obs operator:
        name: CRTM
        Absorbers: [H2O,O3,CO2]
        linear obs operator:
#         Absorbers: [H2O,O3,CO2]
          Absorbers: [H2O,O3]
        obs options:
          Sensor_ID: *Sensor_ID
          EndianType: little_endian
          CoefficientPath: '/discover/nobackup/projects/gmao/dadev/rtodling/JEDI/j48rt3/fvInput/gsi/etc/fix_ncep20221018/REL-2.4.0-jcsda/CRTM_Coeffs/Little_Endian/'
      obs bias:
        input file: &ssmis_f17_satbias Data/obs/ssmis_f17.$PYYYYYMMDDTHH0000Z.satbias.nc4
        output file: Data/vbc/ssmis_f17.$PYYYYYMMDDTHH0000Z.satbias.nc4
        variational bc:
          predictors:
          - name: constant
          - name: cloud_liquid_water
            sensor: SSMIS
            ch19h: 12
            ch19v: 13
            ch22v: 14
            ch37h: 15
            ch37v: 16
            ch91v: 17
            ch91h: 18
          - name: cosine_of_latitude_times_orbit_node
          - name: sine_of_latitude
          - name: lapse_rate
            order: 2
            tlapse: &ssmis_f17_tlapse Data/obs/ssmis_f17.$PYYYYYMMDDTHH0000Z.tlapse.txt
          - name: lapse_rate
            tlapse: *ssmis_f17_tlapse
          - name: emissivity
          - name: scan_angle
            var_name: sensorScanPosition
            order: 4
          - name: scan_angle
            var_name: sensorScanPosition
            order: 3
          - name: scan_angle
            var_name: sensorScanPosition
            order: 2
          - name: scan_angle
            var_name: sensorScanPosition
        covariance:
          minimal required obs number: 20
          variance range: [1.0e-6, 10.0]
          step size: 1.0e-4
          largest analysis variance: 10000.0
          prior:
            input file: *ssmis_f17_satbias
            inflation:
              ratio: 1.1
              ratio for small dataset: 2.0
          output file: Data/ana/ssmis_n17.$PYYYYYMMDDTHH0000Z.satbias_cov.nc4
      obs prior filters:
      # Step 1: Initial Observation Error Assignment
      - filter: Perform Action
        filter variables:
        - name: brightnessTemperature
          channels: *ssmis_f17_channels
        action:
          name: assign error
          error parameter vector: [ 1.50, 0.50, 0.50, 0.50, 0.50, 1.00, 1.00, 3.00, 3.00, 3.00,
                                    3.00, 2.40, 1.27, 1.44, 3.00, 1.34, 1.74, 3.75, 3.00, 3.00,
                                    2.00, 6.40, 1.00, 1.00]
      obs post filters:
      # step 2: Gross check(qcmod)
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *ssmis_f17_channels
        absolute threshold: 3.5
        remove bias correction: true
        where:
          - variable:
              name: GeoVaLs/water_area_fraction
            minvalue: 0.99
        action:
          name: reject
      
      # Step 3: Reject all channels if surface height is greater than 2km
      - filter: RejectList
        filter variables:
        - name: brightnessTemperature
          channels: *ssmis_f17_channels
        where:
        - variable:
            name: GeoVaLs/surface_geopotential_height
          minvalue: 2000.0
          min_exclusive: true
        - variable:
            name: GeoVaLs/water_area_fraction
          maxvalue: 0.99
          max_exclusive: true
      
      # Step 4: Reject data over mixed surface type
      - filter: RejectList
        filter variables:
        - name: brightnessTemperature
          channels: 1-3,8-18
        where:
        - variable:
            name: GeoVaLs/land_area_fraction
          maxvalue: 0.99
          max_exclusive: true
        - variable:
            name: GeoVaLs/water_area_fraction
          maxvalue: 0.99
          max_exclusive: true
        - variable:
            name: GeoVaLs/ice_area_fraction
          maxvalue: 0.99
          max_exclusive: true
        - variable:
            name: GeoVaLs/surface_snow_area_fraction
          maxvalue: 0.99
          max_exclusive: true
      
      # Step 5: Channel 2 O-F check over non-water dominant area
      - filter: Difference Check
        filter variables:
        - name: brightnessTemperature
          channels: 1-2, 12-16
        reference: ObsValue/brightnessTemperature_2
        value: HofX/brightnessTemperature_2
        minvalue: -1.5
        maxvalue: 1.5
        where:
        - variable:
            name: GeoVaLs/water_area_fraction
          maxvalue: 0.99
          max_exclusive: true
      
      # Step 6: Gross check over non-water dominant area
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature
          channels: *ssmis_f17_channels
        absolute threshold: 3.5
        remove bias correction: true
        where:
          - variable:
              name: GeoVaLs/water_area_fraction
            maxvalue: 0.99
            max_exclusive: true
        action:
          name: reject
      
      # Step 7: Scattering check for channels 9-11 using channels 8 and 17
      - filter: Difference Check
        filter variables:
        - name: brightnessTemperature
          channels: 9
        reference: ObsValue/brightnessTemperature_9
        value:
          name: ObsFunction/Arithmetic
          options:
            variables:
            - name: HofX/brightnessTemperature_17
            - name: ObsBiasData/brightnessTemperature_17
            - name: HofX/brightnessTemperature_8
            - name: ObsBiasData/brightnessTemperature_8
            coefs: [-0.485934, 0.485934, 0.473806, -0.473806]
            intercept: 271.252327
        maxvalue: 2
      
      - filter: Difference Check
        filter variables:
        - name: brightnessTemperature
          channels: 10
        reference: ObsValue/brightnessTemperature_10
        value:
          name: ObsFunction/Arithmetic
          options:
            variables:
            - name: HofX/brightnessTemperature_17
            - name: ObsBiasData/brightnessTemperature_17
            - name: HofX/brightnessTemperature_8
            - name: ObsBiasData/brightnessTemperature_8
            coefs: [-0.413688, 0.413688, 0.361549, -0.361549]
            intercept: 272.280341
        maxvalue: 2
      
      - filter: Difference Check
        filter variables:
        - name: brightnessTemperature
          channels: 11
        reference: ObsValue/brightnessTemperature_11
        value:
          name: ObsFunction/Arithmetic
          options:
            variables:
            - name: HofX/brightnessTemperature_17
            - name: ObsBiasData/brightnessTemperature_17
            - name: HofX/brightnessTemperature_8
            - name: ObsBiasData/brightnessTemperature_8
            coefs: [-0.400882, 0.400882, 0.270510, -0.270510]
            intercept: 278.824902
        maxvalue: 2
      
      # Step 8: NSST retrieval check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *ssmis_f17_channels
        test variables:
        - name: ObsFunction/NearSSTRetCheckIR
          channels: *ssmis_f17_channels
          options:
            channels: *ssmis_f17_channels
            use_flag: &useflag_ssmis_f17 [ -1,  -1, -1, -1,  1,  1,  1, -1, -1, -1,
                        -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
                        -1,  -1,  1,  1]
        maxvalue: 1.0e-12
        action:
          name: reject
      
      # Step 9: Error inflation based on surface jacobian
      - filter: BlackList
        filter variables:
        - name: brightnessTemperature
          channels: *ssmis_f17_channels
        action:
          name: inflate error
          inflation variable:
            name: ObsFunction/ObsErrorFactorSurfJacobianRad
            channels: *ssmis_f17_channels
            options:
              channels: *ssmis_f17_channels
              sensor: *Sensor_ID
              obserr_demisf: [0.010, 0.010, 0.010, 0.010, 0.010]
              obserr_dtempf: [0.500, 0.500, 0.500, 0.500, 0.500]
      
      # Step 10: Final gross check
      # Channel 1
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor1
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_1
              coefs: [ 2.25 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_1
        threshold: DerivedMetaData/errorInflationFactor1
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 2
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor2
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_2
              coefs: [ 0.75 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_2
        threshold: DerivedMetaData/errorInflationFactor2
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 3
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor3
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_3
              coefs: [ 0.75 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_3
        threshold: DerivedMetaData/errorInflationFactor3
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 4
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor4
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_4
              coefs: [ 0.75 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_4
        threshold: DerivedMetaData/errorInflationFactor4
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 5
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor5
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_5
              coefs: [ 0.75 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_5
        threshold: DerivedMetaData/errorInflationFactor5
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 6
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor6
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_6
              coefs: [ 1.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_6
        threshold: DerivedMetaData/errorInflationFactor6
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 7
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor7
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_7
              coefs: [ 1.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_7
        threshold: DerivedMetaData/errorInflationFactor7
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 8
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor8
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_8
              coefs: [ 4.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_8
        threshold: DerivedMetaData/errorInflationFactor8
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 9
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor9
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_9
              coefs: [ 4.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_9
        threshold: DerivedMetaData/errorInflationFactor9
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 10
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor10
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_10
              coefs: [ 4.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_10
        threshold: DerivedMetaData/errorInflationFactor10
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 11
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor11
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_11
              coefs: [ 4.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_11
        threshold: DerivedMetaData/errorInflationFactor11
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 12
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor12
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_12
              coefs: [ 3.60 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_12
        threshold: DerivedMetaData/errorInflationFactor12
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 13
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor13
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_13
              coefs: [ 1.905 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_13
        threshold: DerivedMetaData/errorInflationFactor13
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 14
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor14
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_14
              coefs: [ 2.16 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_14
        threshold: DerivedMetaData/errorInflationFactor14
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 15
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor15
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_15
              coefs: [ 4.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_15
        threshold: DerivedMetaData/errorInflationFactor15
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 16
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor16
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_16
              coefs: [ 2.01 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_16
        threshold: DerivedMetaData/errorInflationFactor16
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 17
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor17
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_17
              coefs: [ 2.61 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_17
        threshold: DerivedMetaData/errorInflationFactor17
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 18
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor18
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_18
              coefs: [ 5.625 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_18
        threshold: DerivedMetaData/errorInflationFactor18
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 19
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor19
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_19
              coefs: [ 4.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_19
        threshold: DerivedMetaData/errorInflationFactor19
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 20
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor20
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_20
              coefs: [ 4.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_20
        threshold: DerivedMetaData/errorInflationFactor20
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 21
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor21
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_21
              coefs: [ 3.00 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_21
        threshold: DerivedMetaData/errorInflationFactor21
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 22
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor22
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_22
              coefs: [ 9.60 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_22
        threshold: DerivedMetaData/errorInflationFactor22
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 23
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor23
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_23
              coefs: [ 1.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_23
        threshold: DerivedMetaData/errorInflationFactor23
        absolute threshold: 6.0
        action:
          name: reject
      
      # Channel 24
      - filter: Variable Assignment
        assignments:
        - name: DerivedMetaData/errorInflationFactor24
          type: float
          function:
            name: ObsFunction/Arithmetic
            options:
              variables:
              - name: ObsErrorData/brightnessTemperature_24
              coefs: [ 1.50 ]
              exponents: [ -1 ]
      
      - filter: Background Check
        filter variables:
        - name: brightnessTemperature_24
        threshold: DerivedMetaData/errorInflationFactor24
        absolute threshold: 6.0
        action:
          name: reject
      
      #  Useflag Check
      - filter: Bounds Check
        filter variables:
        - name: brightnessTemperature
          channels: *ssmis_f17_channels
        test variables:
        - name: ObsFunction/ChannelUseflagCheckRad
          channels: *ssmis_f17_channels
          options:
            channels: *ssmis_f17_channels
            use_flag: *useflag_ssmis_f17
        minvalue: 1.0e-12
        action:
          name: reject
      


final:
  diagnostics:
    departures: oman
output:
  filetype: cube sphere history
  provider: geos
  datapath: Data/ana
  filename: $EXPID.jedi_ana.ceta.%yyyy%mm%dd_%hh%MMz.nc4
  first: PT0H
  frequency: PT1H
variational:
  minimizer:
    algorithm: DRIPCG
#   algorithm: DRPCG
  iterations:
  - ninner: 100
#   gradient norm reduction: 1e-3
    gradient norm reduction: 1e-6
#   test: on
    geometry:
      akbk: Data/fv3files/akbk72.nc4
      layout: [6,6]
      npx: 181
      npy: 181
      npz: 72
      field metadata override: Data/fieldmetadata/geos.yaml
    diagnostics:
      departures: ombg
    online diagnostics:
      write increment: true
      increment:
        filetype: cube sphere history
        provider: geos
        datapath: Data/inc
        filename: $EXPID.jedi_inc-iter1.ceta.%yyyy%mm%dd_%hh%MMz.nc4
# - ninner: 3
##  gradient norm reduction: 1e-10
#   gradient norm reduction: 1e-3
#   test: on
#   geometry:
#     akbk: Data/fv3files/akbk72.nc4
#     layout: [6,6]
#     npx: 181
#     npy: 181
#     npz: 72
#     field metadata override: Data/fieldmetadata/geos.yaml
#   diagnostics:
#     departures: ombg
#   online diagnostics:
#     write increment: true
#     increment:
#       filetype: cube sphere history
#       provider: geos
#       datapath: Data/analysis/Feb23
#       filename: 3dvar_sondes_geos.inc-iter2.%yyyy%mm%dd_%hh%MM%ssz.nc

#test:
#  reference filename: output/3dvar_sondes_geos.ref
#  float relative tolerance: 1.0e-1
#  integer tolerance: 3
#  test output filename: output/3dvar_sondes_geos.test.out
